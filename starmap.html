<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sol Sector Starmap</title>
    <script type="importmap">
      {
        "imports": {
          "three": "./js/vendor/three/build/three.module.js",
          "three/addons/": "./js/vendor/three/examples/jsm/"
        }
      }
    </script>
    <link rel="stylesheet" href="css/starmap.css" />
  </head>
  <body>
    <div id="container"></div>

    <!-- Game HUD Overlay -->
    <div id="game-hud">
      <div class="hud-section hud-finances">
        <div class="hud-row">
          <span class="hud-label">Credits:</span>
          <span id="hud-credits" class="hud-value">0</span>
        </div>
        <div class="hud-row">
          <span class="hud-label">Debt:</span>
          <span id="hud-debt" class="hud-value">0</span>
        </div>
      </div>

      <div class="hud-section hud-time">
        <div class="hud-row">
          <span class="hud-label">Days:</span>
          <span id="hud-days" class="hud-value">0</span>
        </div>
      </div>

      <div class="hud-section hud-ship">
        <div class="hud-row">
          <span class="hud-label">Fuel:</span>
          <div class="condition-bar-container fuel-bar-container">
            <div id="fuel-bar" class="condition-bar fuel-bar"></div>
            <span id="hud-fuel-text" class="condition-text fuel-text"
              >100%</span
            >
          </div>
        </div>
        <div class="hud-row">
          <span class="hud-label">Hull:</span>
          <div class="condition-bar-container hull-bar-container">
            <div id="hull-bar" class="condition-bar hull-bar"></div>
            <span id="hud-hull-text" class="condition-text">100%</span>
          </div>
        </div>
        <div class="hud-row">
          <span class="hud-label">Engine:</span>
          <div class="condition-bar-container engine-bar-container">
            <div id="engine-bar" class="condition-bar engine-bar"></div>
            <span id="hud-engine-text" class="condition-text">100%</span>
          </div>
        </div>
        <div class="hud-row">
          <span class="hud-label">Life Support:</span>
          <div class="condition-bar-container life-support-bar-container">
            <div
              id="life-support-bar"
              class="condition-bar life-support-bar"
            ></div>
            <span id="hud-life-support-text" class="condition-text">100%</span>
          </div>
        </div>
        <div class="hud-row">
          <span class="hud-label">Cargo:</span>
          <span id="hud-cargo" class="hud-value">0/50</span>
        </div>
      </div>

      <div class="hud-section hud-location">
        <div class="hud-row">
          <span class="hud-label">System:</span>
          <span id="hud-system" class="hud-value">Sol</span>
        </div>
        <div class="hud-row">
          <span class="hud-label">Distance from Sol:</span>
          <span id="hud-distance" class="hud-value">0.0 LY</span>
        </div>
      </div>

      <div class="hud-section hud-quick-access">
        <div class="hud-quick-access-label">Quick Access:</div>
        <div class="hud-quick-access-buttons">
          <button class="quick-access-btn" id="quick-station-btn">
            Station
          </button>
          <button class="quick-access-btn" id="quick-system-info-btn">
            System Info
          </button>
        </div>
      </div>
    </div>

    <!-- System Info Panel (existing) -->
    <div id="hud">
      <button class="close-btn" id="hud-close-btn">×</button>
      <h2 id="hud-name">System Name</h2>
      <div class="info-row">
        <span class="label">Coordinates:</span>
        <span id="hud-coords">0, 0, 0</span>
      </div>
      <div class="info-row">
        <span class="label">Spectral Class:</span>
        <span id="hud-spectral">G2</span>
      </div>
      <div class="info-row">
        <span class="label">Wormholes:</span>
        <span id="hud-wormholes">0</span>
      </div>
      <div class="info-row">
        <span class="label">Status:</span>
        <span id="hud-reachable">Reachable</span>
      </div>
      <div id="jump-info" class="jump-info">
        <div class="info-row">
          <span class="label">Distance:</span>
          <span id="jump-distance">0.0 LY</span>
        </div>
        <div class="info-row">
          <span class="label">Fuel Cost:</span>
          <span id="jump-fuel-cost">0%</span>
        </div>
        <div class="info-row">
          <span class="label">Jump Time:</span>
          <span id="jump-time">0 days</span>
        </div>
        <!-- Jump Validation Message -->
        <div id="jump-validation-message" class="validation-message"></div>
      </div>
      <div id="connected-systems" class="connected-systems">
        <div class="connected-header">Connected Systems:</div>
        <div id="connected-list" class="connected-list">
          <!-- Populated dynamically -->
        </div>
      </div>
      <div class="hud-actions">
        <button class="action-btn" id="jump-btn">Jump to System</button>
        <button class="action-btn secondary" id="dock-btn">
          Dock at Station
        </button>
      </div>
    </div>

    <!-- Station Interface -->
    <div id="station-interface">
      <button class="close-btn" id="station-close-btn">×</button>
      <h2 id="station-name">Station Name</h2>
      <div class="station-info">
        <div class="info-row">
          <span class="label">System:</span>
          <span id="station-system-name">Sol</span>
        </div>
        <div class="info-row">
          <span class="label">Distance from Sol:</span>
          <span id="station-distance">0.0 LY</span>
        </div>
      </div>
      <div class="station-actions">
        <button class="station-btn" id="trade-btn">Trade</button>
        <button class="station-btn" id="refuel-btn">Refuel</button>
        <button class="station-btn" id="repairs-btn">Repairs</button>
        <button class="station-btn" id="info-broker-btn">Info Broker</button>
        <button class="station-btn" id="upgrades-btn">Upgrades</button>
        <button class="station-btn" id="cargo-manifest-btn">
          Cargo Manifest
        </button>
        <button class="station-btn" id="ship-status-btn">Ship Status</button>
        <button class="station-btn" id="undock-btn">Undock</button>
      </div>
    </div>

    <!-- Trade Panel -->
    <div id="trade-panel">
      <button class="close-btn" id="trade-close-btn">×</button>
      <h2>Trade - <span id="trade-system-name">Sol</span></h2>

      <div class="trade-content">
        <!-- Market Goods Section -->
        <div class="trade-section">
          <h3>Market Goods</h3>
          <div id="market-goods" class="goods-list">
            <!-- Dynamically populated with goods -->
          </div>
        </div>

        <!-- Cargo Section -->
        <div class="trade-section">
          <h3>Your Cargo</h3>
          <div class="cargo-capacity-display">
            <span class="capacity-label">Capacity:</span>
            <span id="trade-cargo-used">0</span> /
            <span id="trade-cargo-capacity">50</span>
            <span class="capacity-remaining"
              >(<span id="trade-cargo-remaining">50</span> remaining)</span
            >
          </div>
          <div id="cargo-stacks" class="cargo-list">
            <!-- Dynamically populated with cargo stacks -->
          </div>
        </div>

        <!-- Hidden Cargo Section (only visible when Smuggler's Panels installed) -->
        <div
          id="hidden-cargo-section"
          class="trade-section hidden-cargo-section hidden"
        >
          <div class="hidden-cargo-header">
            <h3>Hidden Cargo</h3>
            <button
              id="toggle-hidden-cargo-btn"
              class="toggle-hidden-cargo-btn"
            >
              Hide
            </button>
          </div>
          <div id="hidden-cargo-content" class="hidden-cargo-content">
            <div class="cargo-capacity-display">
              <span class="capacity-label">Hidden Capacity:</span>
              <span id="hidden-cargo-used">0</span> /
              <span id="hidden-cargo-capacity">10</span>
              <span class="capacity-units">units</span>
            </div>
            <div id="hidden-cargo-stacks" class="cargo-list">
              <!-- Dynamically populated with hidden cargo stacks -->
            </div>
          </div>
        </div>
      </div>

      <div class="trade-actions">
        <button class="station-btn" id="trade-back-btn">Back to Station</button>
      </div>
    </div>

    <!-- Refuel Panel -->
    <div id="refuel-panel">
      <button class="close-btn" id="refuel-close-btn">×</button>
      <h2>Refuel - <span id="refuel-system-name">Sol</span></h2>

      <div class="refuel-content">
        <!-- Current Status Section -->
        <div class="refuel-section">
          <h3>Current Status</h3>
          <div class="refuel-status">
            <div class="info-row">
              <span class="label">Current Fuel:</span>
              <span id="refuel-current-fuel" class="value">100%</span>
            </div>
            <div class="info-row">
              <span class="label">Fuel Price:</span>
              <span id="refuel-price-per-percent" class="value">2 cr/%</span>
            </div>
          </div>
        </div>

        <!-- Refuel Controls Section -->
        <div class="refuel-section">
          <h3>Refuel Amount</h3>
          <div class="refuel-controls">
            <div class="refuel-input-group">
              <label for="refuel-amount-input">Amount (%):</label>
              <input
                type="number"
                id="refuel-amount-input"
                min="1"
                max="100"
                value="10"
              />
            </div>
            <div class="refuel-buttons">
              <button class="refuel-preset-btn" data-amount="10">+10%</button>
              <button class="refuel-preset-btn" data-amount="25">+25%</button>
              <button class="refuel-preset-btn" data-amount="50">+50%</button>
              <button class="refuel-preset-btn" id="refuel-max-btn">Max</button>
            </div>
          </div>
        </div>

        <!-- Cost Display Section -->
        <div class="refuel-section">
          <div class="refuel-cost-display">
            <div class="cost-row">
              <span class="cost-label">Total Cost:</span>
              <span id="refuel-total-cost" class="cost-value">20 cr</span>
            </div>
          </div>
        </div>

        <!-- Validation Message -->
        <div id="refuel-validation-message" class="validation-message"></div>
      </div>

      <div class="refuel-actions">
        <button class="station-btn" id="refuel-confirm-btn">
          Confirm Refuel
        </button>
        <button class="station-btn secondary" id="refuel-back-btn">
          Back to Station
        </button>
      </div>
    </div>

    <!-- Repair Panel -->
    <div id="repair-panel">
      <button class="close-btn" id="repair-close-btn">×</button>
      <h2>Repairs - <span id="repair-system-name">Sol</span></h2>

      <div class="repair-content">
        <!-- Ship Condition Status Section -->
        <div class="repair-section">
          <h3>Ship Condition</h3>
          <div class="condition-status">
            <!-- Hull Condition -->
            <div class="condition-item">
              <div class="condition-header">
                <span class="condition-label">Hull Integrity:</span>
                <span id="repair-hull-percent" class="condition-value"
                  >100%</span
                >
              </div>
              <div class="condition-bar-container">
                <div id="repair-hull-bar" class="condition-bar hull-bar"></div>
              </div>
            </div>

            <!-- Engine Condition -->
            <div class="condition-item">
              <div class="condition-header">
                <span class="condition-label">Engine:</span>
                <span id="repair-engine-percent" class="condition-value"
                  >100%</span
                >
              </div>
              <div class="condition-bar-container">
                <div
                  id="repair-engine-bar"
                  class="condition-bar engine-bar"
                ></div>
              </div>
            </div>

            <!-- Life Support Condition -->
            <div class="condition-item">
              <div class="condition-header">
                <span class="condition-label">Life Support:</span>
                <span id="repair-life-support-percent" class="condition-value"
                  >100%</span
                >
              </div>
              <div class="condition-bar-container">
                <div
                  id="repair-life-support-bar"
                  class="condition-bar life-support-bar"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Repair Options Section -->
        <div class="repair-section">
          <h3>Repair Options</h3>
          <div class="repair-options">
            <!-- Hull Repairs -->
            <div class="repair-system-group">
              <h4>Hull Integrity</h4>
              <div class="repair-buttons">
                <button class="repair-btn" data-system="hull" data-amount="10">
                  +10% (₡50)
                </button>
                <button class="repair-btn" data-system="hull" data-amount="25">
                  +25% (₡125)
                </button>
                <button class="repair-btn" data-system="hull" data-amount="50">
                  +50% (₡250)
                </button>
                <button
                  class="repair-btn"
                  data-system="hull"
                  data-amount="full"
                >
                  Full (₡0)
                </button>
              </div>
            </div>

            <!-- Engine Repairs -->
            <div class="repair-system-group">
              <h4>Engine</h4>
              <div class="repair-buttons">
                <button
                  class="repair-btn"
                  data-system="engine"
                  data-amount="10"
                >
                  +10% (₡50)
                </button>
                <button
                  class="repair-btn"
                  data-system="engine"
                  data-amount="25"
                >
                  +25% (₡125)
                </button>
                <button
                  class="repair-btn"
                  data-system="engine"
                  data-amount="50"
                >
                  +50% (₡250)
                </button>
                <button
                  class="repair-btn"
                  data-system="engine"
                  data-amount="full"
                >
                  Full (₡0)
                </button>
              </div>
            </div>

            <!-- Life Support Repairs -->
            <div class="repair-system-group">
              <h4>Life Support</h4>
              <div class="repair-buttons">
                <button
                  class="repair-btn"
                  data-system="lifeSupport"
                  data-amount="10"
                >
                  +10% (₡50)
                </button>
                <button
                  class="repair-btn"
                  data-system="lifeSupport"
                  data-amount="25"
                >
                  +25% (₡125)
                </button>
                <button
                  class="repair-btn"
                  data-system="lifeSupport"
                  data-amount="50"
                >
                  +50% (₡250)
                </button>
                <button
                  class="repair-btn"
                  data-system="lifeSupport"
                  data-amount="full"
                >
                  Full (₡0)
                </button>
              </div>
            </div>

            <!-- Repair All Option -->
            <div class="repair-all-section">
              <button class="repair-all-btn" id="repair-all-btn">
                Repair All to Full (₡0)
              </button>
            </div>
          </div>
        </div>

        <!-- Validation Message -->
        <div id="repair-validation-message" class="validation-message"></div>
      </div>

      <div class="repair-actions">
        <button class="station-btn secondary" id="repair-back-btn">
          Back to Station
        </button>
      </div>
    </div>

    <!-- Information Broker Panel -->
    <div id="info-broker-panel">
      <button class="close-btn" id="info-broker-close-btn">×</button>
      <h2>
        Information Broker - <span id="info-broker-system-name">Sol</span>
      </h2>

      <!-- Tab Navigation -->
      <div class="info-broker-tabs">
        <button class="info-broker-tab active" id="purchase-tab">
          Purchase Intel
        </button>
        <button class="info-broker-tab" id="market-data-tab">
          Market Data
        </button>
      </div>

      <div class="info-broker-content">
        <!-- Purchase Intel Tab -->
        <div id="purchase-intel-content" class="tab-content active">
          <!-- Market Rumor Section -->
          <div class="info-broker-section">
            <h3>Market Rumors</h3>
            <div class="rumor-container">
              <p class="rumor-description">
                Get a hint about current market conditions across the sector.
              </p>
              <div class="rumor-actions">
                <button class="info-broker-btn" id="buy-rumor-btn">
                  Buy Rumor (₡25)
                </button>
              </div>
              <div id="rumor-text" class="rumor-text"></div>
            </div>
          </div>

          <!-- System Intelligence Section -->
          <div class="info-broker-section">
            <h3>System Intelligence</h3>
            <div class="intelligence-description">
              <p>
                Purchase current market prices for systems you haven't visited
                recently.
              </p>
            </div>
            <div id="intelligence-list" class="intelligence-list">
              <!-- Dynamically populated with system intelligence options -->
            </div>
          </div>
        </div>

        <!-- Market Data Tab -->
        <div id="market-data-content" class="tab-content">
          <div class="info-broker-section">
            <h3>Known Market Prices</h3>
            <div class="market-data-description">
              <p>
                View commodity prices for systems you've visited or purchased
                intelligence for.
              </p>
            </div>
            <div id="market-data-list" class="market-data-list">
              <!-- Dynamically populated with known market data -->
            </div>
          </div>
        </div>

        <!-- Validation Message -->
        <div
          id="info-broker-validation-message"
          class="validation-message"
        ></div>
      </div>

      <div class="info-broker-actions">
        <button class="station-btn secondary" id="info-broker-back-btn">
          Back to Station
        </button>
      </div>
    </div>

    <!-- Error Notification Area -->
    <div id="notification-area"></div>

    <!-- Confirmation Modal -->
    <div id="modal-overlay" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-content">
          <p id="modal-message" class="modal-message"></p>
          <div class="modal-actions">
            <button id="modal-cancel" class="modal-cancel">Cancel</button>
            <button id="modal-confirm" class="modal-confirm">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Notification Modal -->
    <div id="event-modal-overlay" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-content">
          <h3 id="event-modal-title" class="event-modal-title"></h3>
          <p id="event-modal-description" class="event-modal-description"></p>
          <p id="event-modal-duration" class="event-modal-duration"></p>
          <div class="modal-actions">
            <button id="event-modal-dismiss" class="modal-confirm">
              Dismiss
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ship Naming Dialog -->
    <div id="ship-naming-overlay" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-content">
          <h3 class="modal-title">Name Your Ship</h3>
          <p class="modal-description">
            Every ship has a story. What's yours called?
          </p>

          <div class="ship-naming-input-group">
            <input
              type="text"
              id="ship-name-input"
              class="ship-name-input"
              placeholder="Enter ship name..."
              maxlength="50"
            />
          </div>

          <div class="ship-name-suggestions">
            <p class="suggestions-label">Suggestions:</p>
            <div id="ship-name-suggestions-list" class="suggestions-list">
              <!-- Suggestions will be populated by JavaScript -->
            </div>
          </div>

          <div class="modal-actions">
            <button id="ship-name-confirm" class="modal-confirm">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Upgrades Interface -->
    <div id="upgrades-panel">
      <button class="close-btn" id="upgrades-close-btn">×</button>
      <h2>Ship Upgrades</h2>

      <div class="upgrades-content">
        <!-- Credit Balance Display -->
        <div class="upgrades-credits">
          <span class="credits-label">Available Credits:</span>
          <span id="upgrades-credits-value" class="credits-value">0</span>
        </div>

        <!-- Available Upgrades Section -->
        <div class="upgrades-section">
          <h3>Available Upgrades</h3>
          <div id="available-upgrades-list" class="upgrades-list">
            <!-- Dynamically populated with available upgrades -->
          </div>
        </div>

        <!-- Installed Upgrades Section -->
        <div class="upgrades-section">
          <h3>Installed Upgrades</h3>
          <div id="installed-upgrades-list" class="upgrades-list">
            <!-- Dynamically populated with installed upgrades -->
          </div>
        </div>
      </div>

      <div class="upgrades-actions">
        <button class="station-btn secondary" id="upgrades-back-btn">
          Back to Station
        </button>
      </div>
    </div>

    <!-- Upgrade Confirmation Dialog -->
    <div id="upgrade-confirmation-overlay" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-content">
          <h3 id="upgrade-confirmation-title" class="modal-title"></h3>

          <div class="upgrade-confirmation-details">
            <div class="upgrade-confirmation-section">
              <h4>Effects:</h4>
              <div
                id="upgrade-confirmation-effects"
                class="upgrade-effects-list"
              >
                <!-- Effects will be populated by JavaScript -->
              </div>
            </div>

            <div class="upgrade-confirmation-section">
              <h4>Cost:</h4>
              <div class="upgrade-cost-display">
                <div class="cost-row">
                  <span class="cost-label">Current Credits:</span>
                  <span id="upgrade-current-credits" class="cost-value">0</span>
                </div>
                <div class="cost-row">
                  <span class="cost-label">Upgrade Cost:</span>
                  <span id="upgrade-cost" class="cost-value">0</span>
                </div>
                <div class="cost-row total-row">
                  <span class="cost-label">Credits After:</span>
                  <span id="upgrade-credits-after" class="cost-value">0</span>
                </div>
              </div>
            </div>

            <div class="upgrade-warning">
              ⚠ This upgrade is PERMANENT and cannot be removed
            </div>
          </div>

          <div class="modal-actions">
            <button id="upgrade-cancel-btn" class="modal-cancel">Cancel</button>
            <button id="upgrade-confirm-btn" class="modal-confirm">
              Confirm Purchase
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Cargo Manifest Panel -->
    <div id="cargo-manifest-panel">
      <button class="close-btn" id="cargo-manifest-close-btn">×</button>
      <h2>CARGO MANIFEST - <span id="cargo-manifest-ship-name"></span></h2>

      <div class="cargo-manifest-content">
        <!-- Capacity Display -->
        <div class="cargo-manifest-section">
          <div class="cargo-capacity-display">
            <span class="capacity-label">Capacity:</span>
            <span id="cargo-manifest-used">0</span> /
            <span id="cargo-manifest-capacity">50</span>
            <span class="capacity-units">units</span>
          </div>
        </div>

        <!-- Cargo List -->
        <div class="cargo-manifest-section">
          <h3>Cargo</h3>
          <div id="cargo-manifest-list" class="cargo-manifest-list">
            <!-- Dynamically populated with cargo items -->
          </div>
        </div>

        <!-- Total Value Display -->
        <div class="cargo-manifest-section">
          <div class="cargo-manifest-total">
            <span class="total-label">Total Cargo Value:</span>
            <span id="cargo-manifest-total-value" class="total-value">₡0</span>
          </div>
        </div>
      </div>

      <div class="cargo-manifest-actions">
        <button class="station-btn secondary" id="cargo-manifest-back-btn">
          Back
        </button>
      </div>
    </div>

    <!-- Initial Game Menu -->
    <div id="game-menu">
      <div class="menu-content">
        <h1 class="menu-title">Tramp Freighter Blues</h1>
        <div class="menu-subtitle">Sol Sector Trading Simulation</div>

        <div class="menu-buttons">
          <button class="menu-btn" id="continue-btn">Continue Game</button>
          <button class="menu-btn" id="new-game-btn">New Game</button>
        </div>

        <div class="menu-footer">
          <div class="menu-version">v1.0.0</div>
        </div>
      </div>
    </div>

    <!-- Control Buttons -->
    <div id="controls">
      <button class="control-btn" id="zoom-in-btn">Zoom In</button>
      <button class="control-btn" id="zoom-out-btn">Zoom Out</button>
      <button class="control-btn active" id="rotation-btn">
        Toggle Rotation
      </button>
      <button class="control-btn active" id="boundary-btn">
        Toggle Boundary
      </button>
    </div>

    <!-- Application Code -->
    <script type="module" src="js/starmap.js"></script>
  </body>
</html>
