{"version":3,"file":"index-DqnAwc3H.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/components/ErrorBoundary.jsx","../../src/App.jsx","../../src/context/GameContext.jsx","../../src/game/constants.js","../../src/game/game-trading.js","../../src/game/utils/seeded-random.js","../../src/game/game-events.js","../../src/game/game-information-broker.js","../../src/game/state/save-load.js","../../src/game/state/state-validators.js","../../src/game/state/game-state-manager.js","../../src/game/data/star-data.js","../../src/game/data/wormhole-data.js","../../src/game/game-navigation.js","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import React from 'react';\n\n/**\n * Error Boundary component to catch and handle React errors gracefully.\n *\n * Catches errors in child components and displays a fallback UI instead of\n * crashing the entire application. Logs error details for debugging.\n *\n * React Migration Spec: Requirements 36.1, 36.2, 36.3, 36.4, 36.5\n */\nexport class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    };\n  }\n\n  /**\n   * Update state when an error is caught.\n   *\n   * React Migration Spec: Requirements 36.1, 36.2\n   *\n   * @param {Error} error - The error that was thrown\n   * @returns {Object} New state with error information\n   */\n  static getDerivedStateFromError(error) {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  /**\n   * Log error details when an error is caught.\n   *\n   * React Migration Spec: Requirements 36.3\n   *\n   * @param {Error} error - The error that was thrown\n   * @param {Object} errorInfo - React error info with component stack\n   */\n  componentDidCatch(error, errorInfo) {\n    console.error('Error caught by ErrorBoundary:', error, errorInfo);\n    this.setState({ errorInfo });\n  }\n\n  /**\n   * Handle reload button click.\n   */\n  handleReload = () => {\n    window.location.reload();\n  };\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div\n          className=\"error-boundary\"\n          style={{\n            padding: '40px',\n            fontFamily: 'sans-serif',\n            maxWidth: '600px',\n            margin: '0 auto',\n            backgroundColor: '#1a1a1a',\n            color: '#fff',\n            borderRadius: '8px',\n            marginTop: '40px',\n          }}\n        >\n          <h2 style={{ color: '#ff6b6b', marginBottom: '20px' }}>\n            Something went wrong\n          </h2>\n          <p style={{ marginBottom: '20px' }}>\n            An error occurred in the application. You can try reloading the\n            page to recover.\n          </p>\n          {this.state.error && (\n            <div\n              style={{\n                backgroundColor: '#2a2a2a',\n                padding: '15px',\n                borderRadius: '4px',\n                marginBottom: '20px',\n                fontFamily: 'monospace',\n                fontSize: '14px',\n                color: '#ff6b6b',\n                overflowX: 'auto',\n              }}\n            >\n              <strong>Error:</strong> {this.state.error.toString()}\n              {this.state.errorInfo && (\n                <details style={{ marginTop: '10px' }}>\n                  <summary style={{ cursor: 'pointer', color: '#aaa' }}>\n                    Component Stack\n                  </summary>\n                  <pre\n                    style={{\n                      marginTop: '10px',\n                      fontSize: '12px',\n                      color: '#ccc',\n                    }}\n                  >\n                    {this.state.errorInfo.componentStack}\n                  </pre>\n                </details>\n              )}\n            </div>\n          )}\n          <button\n            onClick={this.handleReload}\n            style={{\n              padding: '10px 20px',\n              fontSize: '16px',\n              cursor: 'pointer',\n              backgroundColor: '#4a9eff',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '4px',\n            }}\n          >\n            Reload Application\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","import { useState } from 'react';\nimport { ErrorBoundary } from './components/ErrorBoundary';\n\n/**\n * View modes for the application.\n *\n * ORBIT: Player is in orbit around a system, viewing the starmap\n * STATION: Player is docked at a station, viewing the station menu\n * PANEL: Player has opened a specific panel from the station menu\n *\n * React Migration Spec: Requirements 9.1, 9.2, 9.3, 9.4, 9.5\n */\nconst VIEW_MODES = {\n  ORBIT: 'ORBIT',\n  STATION: 'STATION',\n  PANEL: 'PANEL',\n};\n\n/**\n * Root application component.\n *\n * Manages view mode state and conditionally renders:\n * - StarMapCanvas (always visible, z-index 0)\n * - HUD (always visible)\n * - StationMenu (when docked)\n * - PanelContainer (when panel is open)\n *\n * React Migration Spec: Requirements 9.1, 9.2, 9.3, 9.4, 9.5, 25.1, 25.2, 25.3, 25.4, 25.5\n */\nexport default function App() {\n  const [viewMode, setViewMode] = useState(VIEW_MODES.ORBIT);\n  const [activePanel, setActivePanel] = useState(null);\n\n  /**\n   * Handle docking at a station.\n   * Transitions from ORBIT to STATION view mode.\n   *\n   * React Migration Spec: Requirements 9.3, 25.3\n   */\n  const handleDock = () => {\n    setViewMode(VIEW_MODES.STATION);\n  };\n\n  /**\n   * Handle undocking from a station.\n   * Transitions from STATION to ORBIT view mode.\n   *\n   * React Migration Spec: Requirements 9.2, 25.1, 25.2\n   */\n  const handleUndock = () => {\n    setViewMode(VIEW_MODES.ORBIT);\n    setActivePanel(null);\n  };\n\n  /**\n   * Handle opening a panel from the station menu.\n   * Transitions from STATION to PANEL view mode.\n   *\n   * React Migration Spec: Requirements 9.4, 25.4\n   *\n   * @param {string} panelName - Name of the panel to open\n   */\n  const handleOpenPanel = (panelName) => {\n    setActivePanel(panelName);\n    setViewMode(VIEW_MODES.PANEL);\n  };\n\n  /**\n   * Handle closing a panel.\n   * Transitions from PANEL back to STATION view mode.\n   *\n   * React Migration Spec: Requirements 9.3, 25.3\n   */\n  const handleClosePanel = () => {\n    setViewMode(VIEW_MODES.STATION);\n    setActivePanel(null);\n  };\n\n  return (\n    <ErrorBoundary>\n      <div className=\"app-container\">\n        {/* Starmap is always rendered (z-index 0) */}\n        {/* TODO: Implement StarMapCanvas in task 6 */}\n        <div\n          className=\"starmap-placeholder\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: '100%',\n            height: '100%',\n            zIndex: 0,\n            backgroundColor: '#000',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#fff',\n          }}\n        >\n          <p>StarMapCanvas will be implemented in task 6</p>\n        </div>\n\n        {/* HUD is always rendered */}\n        {/* TODO: Implement HUD in task 8 */}\n        <div\n          className=\"hud-placeholder\"\n          style={{\n            position: 'absolute',\n            top: '20px',\n            left: '20px',\n            zIndex: 10,\n            color: '#fff',\n            backgroundColor: 'rgba(0, 0, 0, 0.7)',\n            padding: '10px',\n            borderRadius: '4px',\n          }}\n        >\n          <p>HUD will be implemented in task 8</p>\n          <p>View Mode: {viewMode}</p>\n          <button onClick={handleDock}>Dock (Test)</button>\n        </div>\n\n        {/* Station menu displayed when docked */}\n        {viewMode === VIEW_MODES.STATION && (\n          <div\n            className=\"station-menu-placeholder\"\n            style={{\n              position: 'absolute',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)',\n              zIndex: 20,\n              backgroundColor: '#222',\n              color: '#fff',\n              padding: '20px',\n              borderRadius: '8px',\n              minWidth: '300px',\n            }}\n          >\n            <h2>Station Menu</h2>\n            <p>StationMenu will be implemented in task 9</p>\n            <button onClick={() => handleOpenPanel('trade')}>\n              Open Trade Panel (Test)\n            </button>\n            <br />\n            <button onClick={handleUndock} style={{ marginTop: '10px' }}>\n              Undock\n            </button>\n          </div>\n        )}\n\n        {/* Panel container displayed when a panel is open */}\n        {viewMode === VIEW_MODES.PANEL && (\n          <div\n            className=\"panel-container-placeholder\"\n            style={{\n              position: 'absolute',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)',\n              zIndex: 20,\n              backgroundColor: '#333',\n              color: '#fff',\n              padding: '20px',\n              borderRadius: '8px',\n              minWidth: '400px',\n            }}\n          >\n            <h2>Panel: {activePanel}</h2>\n            <p>PanelContainer will be implemented in task 9</p>\n            <button onClick={handleClosePanel}>Close Panel</button>\n          </div>\n        )}\n      </div>\n    </ErrorBoundary>\n  );\n}\n","import { createContext, useContext } from 'react';\n\n/**\n * React Context for providing GameStateManager instance to all components.\n *\n * This is the foundation of the Bridge Pattern that connects the imperative\n * GameStateManager to React's declarative component model.\n *\n * React Migration Spec: Requirements 5.1, 13.1, 13.2, 13.3, 13.4, 13.5\n */\nconst GameContext = createContext(null);\n\n/**\n * Provider component that makes GameStateManager available to all child components.\n *\n * Handles initialization states:\n * - null gameStateManager: Shows loading state\n * - valid gameStateManager: Renders children with context\n *\n * @param {Object} props\n * @param {GameStateManager} props.gameStateManager - Initialized GameStateManager instance\n * @param {React.ReactNode} props.children - Child components\n */\nexport function GameProvider({ gameStateManager, children }) {\n  // Handle null/undefined gameStateManager\n  if (!gameStateManager) {\n    return (\n      <div className=\"game-loading\">\n        <p>Loading game...</p>\n      </div>\n    );\n  }\n\n  return (\n    <GameContext.Provider value={gameStateManager}>\n      {children}\n    </GameContext.Provider>\n  );\n}\n\n/**\n * Custom hook to access GameStateManager from context.\n *\n * Throws error if used outside GameProvider to catch integration bugs early.\n *\n * @returns {GameStateManager} The GameStateManager instance\n * @throws {Error} If used outside GameProvider\n */\nexport function useGameState() {\n  const context = useContext(GameContext);\n\n  if (!context) {\n    throw new Error('useGameState must be used within GameProvider');\n  }\n\n  return context;\n}\n","/**\n * Game Constants - Centralized game data and configuration\n *\n * This module contains all static game data that should remain consistent\n * across the entire application. Import from here rather than duplicating.\n */\n\n/**\n * System IDs for key locations\n */\nexport const SOL_SYSTEM_ID = 0;\nexport const ALPHA_CENTAURI_SYSTEM_ID = 1;\n\n/**\n * List of all tradeable commodity types\n *\n * Centralized list ensures consistency across trading, UI, and testing.\n * Order matters for display purposes (basic goods → advanced goods).\n */\nexport const COMMODITY_TYPES = [\n  'grain',\n  'ore',\n  'tritium',\n  'parts',\n  'medicine',\n  'electronics',\n];\n\n/**\n * Base commodity prices in credits (before spectral modifiers)\n */\nexport const BASE_PRICES = {\n  grain: 10,\n  ore: 15,\n  tritium: 50,\n  parts: 30,\n  medicine: 40,\n  electronics: 35,\n};\n\n/**\n * Spectral class color mapping for star visualization\n * Colors represent actual stellar temperatures (blue = hot, red = cool)\n */\nexport const SPECTRAL_COLORS = {\n  O: 0x9bb0ff, // Blue (hottest)\n  B: 0xaabfff, // Blue-white\n  A: 0xcad7ff, // White\n  F: 0xf8f7ff, // Yellow-white\n  G: 0xfff4ea, // Yellow (like Sol)\n  K: 0xffd2a1, // Orange\n  M: 0xffcc6f, // Red-orange (coolest)\n  L: 0xff6b6b, // Brown dwarf (red)\n  T: 0xcc5555, // Brown dwarf (darker red)\n  D: 0xffffff, // White dwarf (white)\n};\n\n/**\n * Intelligence Broker Configuration\n *\n * The information broker sells market intelligence based on how recently\n * the player visited a system. Pricing reflects information freshness.\n * The broker's data is not always accurate - prices may be manipulated\n * to show false profit opportunities, reflecting the unreliable nature\n * of black market intelligence.\n */\nexport const INTELLIGENCE_CONFIG = {\n  PRICES: {\n    RECENT_VISIT: 50, // System visited within RECENT_THRESHOLD days\n    NEVER_VISITED: 100, // System never visited\n    STALE_VISIT: 75, // System visited more than RECENT_THRESHOLD days ago\n    RUMOR: 25, // Market rumor/hint\n  },\n  RECENT_THRESHOLD: 30, // Days before price knowledge is considered stale\n  MAX_AGE: 100, // Days before purchased intelligence is automatically deleted\n  RELIABILITY: {\n    MANIPULATION_CHANCE: 0.1, // Probability that a commodity price will be manipulated\n    MIN_MANIPULATION_MULTIPLIER: 0.7, // Lower multiplier = appears cheaper to buy\n    MAX_MANIPULATION_MULTIPLIER: 0.85, // Upper multiplier for manipulated prices\n  },\n};\n\n/**\n * Fuel Pricing Configuration\n *\n * Pricing tiers reflect supply chain logistics:\n * - Core systems (Sol, Alpha Centauri): Abundant fuel infrastructure\n * - Inner systems (<4.5 LY, non-core): Close to Sol infrastructure\n * - Mid-range systems (4.5-10 LY): Moderate supply chains\n * - Outer systems (≥10 LY): Remote, expensive logistics\n */\nexport const FUEL_PRICING_CONFIG = {\n  CORE_SYSTEMS: {\n    IDS: [SOL_SYSTEM_ID, ALPHA_CENTAURI_SYSTEM_ID],\n    PRICE_PER_PERCENT: 2,\n  },\n  INNER_SYSTEMS: {\n    DISTANCE_THRESHOLD: 4.5, // Systems < 4.5 LY (excluding core)\n    PRICE_PER_PERCENT: 3,\n  },\n  MID_RANGE_SYSTEMS: {\n    DISTANCE_THRESHOLD: 10.0, // Systems >= 4.5 and < 10 LY\n    PRICE_PER_PERCENT: 3,\n  },\n  OUTER_SYSTEMS: {\n    PRICE_PER_PERCENT: 5,\n  },\n};\n\n/**\n * Navigation Configuration\n *\n * Configuration for navigation calculations including coordinate scaling\n * and fuel capacity validation.\n */\nexport const NAVIGATION_CONFIG = {\n  // Coordinate scale factor for converting map units to light-years\n  // The starmap coordinates are stored in arbitrary map units.\n  // The catalog includes stars out to 20 light-years from Sol.\n  // The farthest star (Wolf 1481) has a radius of ~279.319 map units.\n  // Therefore: 1 map unit ≈ 20 / 279.319 ≈ 0.0716027 light-years\n  LY_PER_UNIT: 20 / 279.3190870671033,\n\n  // Floating-point epsilon for fuel capacity checks\n  // Allows for minor floating-point arithmetic errors when validating\n  // refuel amounts against the 100% capacity limit\n  FUEL_CAPACITY_EPSILON: 0.01,\n};\n\n/**\n * Calculate distance from Sol to a star system\n * Uses the standard Euclidean distance formula with coordinate scaling\n *\n * Coordinates are stored in map units. Multiply by LY_PER_UNIT to get light-years.\n * This is a fundamental game mechanic used for fuel pricing, navigation, and future features.\n *\n * @param {Object} system - Star system with x, y, z coordinates\n * @returns {number} Distance in light years\n */\nexport function calculateDistanceFromSol(system) {\n  const r = Math.hypot(system.x, system.y, system.z);\n  return r * NAVIGATION_CONFIG.LY_PER_UNIT;\n}\n\n/**\n * Ship Configuration\n *\n * Configuration for ship properties, degradation, condition management,\n * quirks, and upgrades.\n */\nexport const SHIP_CONFIG = {\n  DEFAULT_NAME: 'Serendipity',\n  NAME_SUGGESTIONS: [\n    'Serendipity',\n    'Lucky Break',\n    'Second Chance',\n    'Wanderer',\n    'Free Spirit',\n    \"Horizon's Edge\",\n    'Stardust Runner',\n    'Cosmic Drifter',\n  ],\n  FUEL_CAPACITY: 100,\n  CARGO_CAPACITY: 100,\n  DEGRADATION: {\n    HULL_PER_JUMP: 2, // Percentage points lost per jump\n    ENGINE_PER_JUMP: 1, // Percentage points lost per jump\n    LIFE_SUPPORT_PER_DAY: 0.5, // Percentage points lost per day traveled\n  },\n  CONDITION_BOUNDS: {\n    MIN: 0,\n    MAX: 100,\n  },\n  CONDITION_WARNING_THRESHOLDS: {\n    HULL: 50,\n    ENGINE: 30,\n    LIFE_SUPPORT: 20,\n  },\n  ENGINE_CONDITION_PENALTIES: {\n    THRESHOLD: 60, // Percentage below which penalties apply\n    FUEL_PENALTY_MULTIPLIER: 1.2, // 20% increase in fuel consumption\n    TIME_PENALTY_DAYS: 1, // Additional days added to jump time\n  },\n  QUIRKS: {\n    sticky_seal: {\n      name: 'Sticky Cargo Seal',\n      description: 'The main cargo hatch sticks. Every. Single. Time.',\n      effects: {\n        loadingTime: 1.1, // +10% slower (future use)\n        theftRisk: 0.95, // -5% theft risk (future use)\n      },\n      flavor: \"You've learned to kick it in just the right spot.\",\n    },\n    hot_thruster: {\n      name: 'Hot Thruster',\n      description: 'Port thruster runs hot. Burns extra fuel but responsive.',\n      effects: {\n        fuelConsumption: 1.05, // +5% fuel use\n      },\n      flavor: \"The engineers say it's 'within tolerances.' Barely.\",\n    },\n    sensitive_sensors: {\n      name: 'Sensitive Sensors',\n      description:\n        'Sensor array picks up everything. Including false positives.',\n      effects: {\n        salvageDetection: 1.15, // +15% salvage (future use)\n        falseAlarms: 1.1, // +10% false alarms (future use)\n      },\n      flavor: \"You've learned to tell the difference. Mostly.\",\n    },\n    cramped_quarters: {\n      name: 'Cramped Quarters',\n      description: 'Living space is... cozy. Very cozy.',\n      effects: {\n        lifeSupportDrain: 0.9, // -10% drain\n      },\n      flavor: \"At least you don't have to share.\",\n    },\n    lucky_ship: {\n      name: 'Lucky Ship',\n      description: 'This ship has a history of beating the odds.',\n      effects: {\n        negateEventChance: 0.05, // 5% to negate bad events (future use)\n      },\n      flavor: 'Knock on hull plating.',\n    },\n    fuel_sipper: {\n      name: 'Fuel Sipper',\n      description: 'Efficient drive core. Previous owner was meticulous.',\n      effects: {\n        fuelConsumption: 0.85, // -15% fuel use\n      },\n      flavor: 'One of the few things that actually works better than spec.',\n    },\n    leaky_seals: {\n      name: 'Leaky Seals',\n      description: \"Hull seals aren't quite right. Slow degradation.\",\n      effects: {\n        hullDegradation: 1.5, // +50% hull damage\n      },\n      flavor: \"You can hear the whistle when you're in the cargo bay.\",\n    },\n    smooth_talker: {\n      name: \"Smooth Talker's Ride\",\n      description: 'Previous owner had a reputation. It rubs off.',\n      effects: {\n        npcRepGain: 1.05, // +5% reputation gains (future use)\n      },\n      flavor: 'People remember this ship. Usually fondly.',\n    },\n  },\n  UPGRADES: {\n    extended_tank: {\n      name: 'Extended Fuel Tank',\n      cost: 3000,\n      description: 'Increases fuel capacity by 50%',\n      effects: {\n        fuelCapacity: 150, // Up from 100\n      },\n      tradeoff: 'Larger tank is more vulnerable to weapons fire.',\n    },\n    reinforced_hull: {\n      name: 'Reinforced Hull Plating',\n      cost: 5000,\n      description: 'Reduces hull degradation by 50%',\n      effects: {\n        hullDegradation: 0.5, // Half degradation\n        cargoCapacity: 45, // Down from 50\n      },\n      tradeoff: 'Extra plating takes up cargo space.',\n    },\n    efficient_drive: {\n      name: 'Efficient Drive System',\n      cost: 4000,\n      description: 'Reduces fuel consumption by 20%',\n      effects: {\n        fuelConsumption: 0.8, // -20% fuel use\n      },\n      tradeoff: 'Optimized for efficiency, not speed.',\n    },\n    expanded_hold: {\n      name: 'Expanded Cargo Hold',\n      cost: 6000,\n      description: 'Increases cargo capacity by 50%',\n      effects: {\n        cargoCapacity: 75, // Up from 50\n      },\n      tradeoff: 'Heavier ship is less maneuverable.',\n    },\n    smuggler_panels: {\n      name: \"Smuggler's Panels\",\n      cost: 4500,\n      description: 'Hidden cargo compartment (10 units)',\n      effects: {\n        hiddenCargoCapacity: 10,\n      },\n      tradeoff: 'If discovered, reputation loss with authorities.',\n    },\n    advanced_sensors: {\n      name: 'Advanced Sensor Array',\n      cost: 3500,\n      description: 'See economic events one jump ahead',\n      effects: {\n        eventVisibility: 1, // Can see events in connected systems\n      },\n      tradeoff: 'None',\n    },\n    medical_bay: {\n      name: 'Medical Bay',\n      cost: 2500,\n      description: 'Slower life support degradation',\n      effects: {\n        lifeSupportDrain: 0.7, // -30% drain\n        cargoCapacity: 45, // Down from 50\n      },\n      tradeoff: 'Takes up cargo space.',\n    },\n  },\n};\n\n/**\n * Deterministic Economy Configuration\n *\n * Centralized configuration for the deterministic economy system.\n * Prices are determined by three factors:\n * 1. Technology Level Gradient: Static price differentials based on distance from Sol\n * 2. Temporal Drift: Smooth sine-wave price oscillations over time\n * 3. Local Market Saturation: Player-driven supply/demand impacts that decay over time\n *\n * This replaces the random price fluctuation model with a predictable, simulation-based economy.\n */\nexport const ECONOMY_CONFIG = {\n  MAX_COORD_DISTANCE: 21, // Calibrated for Sol Sector map (<21 LY radius)\n\n  MAX_TECH_LEVEL: 10.0, // Sol and core systems\n  MIN_TECH_LEVEL: 1.0, // Frontier systems at 21+ LY\n\n  MARKET_CAPACITY: 1000, // Units traded before extreme price impact\n\n  DAILY_RECOVERY_FACTOR: 0.9, // Market conditions decay 10% per day\n\n  TEMPORAL_WAVE_PERIOD: 30, // Price oscillation cycle in days\n  TEMPORAL_AMPLITUDE: 0.15, // ±15% price variation (0.85 to 1.15 multiplier)\n  TEMPORAL_PHASE_OFFSET: 0.15, // System ID phase offset for temporal waves\n\n  TECH_LEVEL_MIDPOINT: 5.0, // Neutral point where tech modifiers equal 1.0\n  TECH_MODIFIER_INTENSITY: 0.08, // Controls tech level price impact strength\n\n  LOCAL_MODIFIER_MIN: 0.25, // Prevents prices below 25% of baseline\n  LOCAL_MODIFIER_MAX: 2.0, // Prevents prices above 200% of baseline\n\n  MARKET_CONDITION_PRUNE_THRESHOLD: 1.0, // Remove insignificant market impacts\n\n  // Technology biases: negative = cheaper at low-tech, positive = cheaper at high-tech\n  // Creates intuitive trade routes (buy grain/ore at frontier, electronics/medicine at core)\n  TECH_BIASES: {\n    grain: -0.6, // Agricultural product\n    ore: -0.8, // Raw material\n    tritium: -0.3, // Fuel\n    parts: 0.5, // Manufactured goods\n    medicine: 0.7, // Advanced medical supplies\n    electronics: 1.0, // High-tech goods\n  },\n};\n\n/**\n * Repair Configuration\n *\n * Configuration for ship repair costs.\n */\nexport const REPAIR_CONFIG = {\n  // Repair costs are linear: ₡5 per 1% restored for any ship system\n  // Example: Repairing hull from 78% to 100% costs ₡110 (22% × ₡5)\n  COST_PER_PERCENT: 5,\n};\n\n/**\n * New game initialization values\n */\nexport const NEW_GAME_DEFAULTS = {\n  STARTING_CREDITS: 500,\n  STARTING_DEBT: 10000,\n  STARTING_CARGO_CAPACITY: 50,\n  STARTING_GRAIN_QUANTITY: 20,\n  STARTING_SHIP_NAME: SHIP_CONFIG.DEFAULT_NAME,\n};\n\n/**\n * Development mode flag\n *\n * Checks for existence of .dev file to enable dev features.\n * The .dev file is gitignored, so it won't be deployed to production.\n * This is more reliable than hostname checks for local development.\n *\n * Note: This is initialized asynchronously - see initDevMode() below.\n */\nexport let DEV_MODE = false;\n\n/**\n * Initialize dev mode by checking for .dev file\n *\n * This must be called before creating the UIManager.\n * The .dev file should exist in the project root for local development\n * and be excluded from version control via .gitignore.\n *\n * @returns {Promise<boolean>} True if dev mode is enabled\n */\nexport async function initDevMode() {\n  try {\n    const response = await fetch('.dev');\n    DEV_MODE = response.ok;\n    return DEV_MODE;\n  } catch (error) {\n    DEV_MODE = false;\n    return false;\n  }\n}\n\n/**\n * Game version for save compatibility\n *\n * Version history:\n * - 1.0.0: Initial release with basic trading\n * - 2.0.0: Added ship condition, price knowledge, events\n * - 2.1.0: Deterministic economy with market conditions\n */\nexport const GAME_VERSION = '2.1.0';\n\n/**\n * localStorage key for save data\n */\nexport const SAVE_KEY = 'trampFreighterSave';\n\n/**\n * Save debouncing interval in milliseconds\n * Prevents excessive localStorage writes (max 1 save per second)\n */\nexport const SAVE_DEBOUNCE_MS = 1000;\n\n/**\n * Visual configuration for starmap rendering\n *\n * Centralized visual constants ensure consistent appearance across the starmap.\n * Connection colors provide player feedback for jump feasibility.\n */\nexport const VISUAL_CONFIG = {\n  starSize: 30,\n  pulseAmplitude: 0.15,\n  pulseSpeed: 2.0,\n  selectionRingSize: 40,\n  selectionRingPulseSpeed: 3.0,\n  selectionColor: 0xffff00,\n  currentSystemColor: 0x00ff88,\n  sectorBoundaryColor: 0x00ff88,\n  defaultStarColor: 0xffffff,\n  sceneBackground: 0x000000,\n  ambientLightColor: 0x404040,\n  directionalLightColor: 0xffffff,\n  connectionColors: {\n    default: 0x00ccff,\n    sufficient: 0x00ff00,\n    warning: 0xffff00,\n    insufficient: 0xff0000,\n  },\n  connectionOpacity: {\n    default: 0.6,\n    active: 0.8,\n  },\n};\n\n/**\n * Label configuration for star system names\n *\n * Distance-based scaling provides depth perception without cluttering the view.\n */\nexport const LABEL_CONFIG = {\n  maxFontSize: 18,\n  minFontSize: 8,\n  maxOpacity: 1.0,\n  minOpacity: 0.1,\n  nearDistance: 100,\n  farDistance: 500,\n};\n\n/**\n * UI notification configuration\n *\n * Controls timing for notification display and animations.\n * Fade duration must match CSS animation timing for smooth transitions.\n */\nexport const NOTIFICATION_CONFIG = {\n  FADE_DURATION: 300, // milliseconds - must match CSS animation\n  DEFAULT_ERROR_DURATION: 3000, // milliseconds\n  DEFAULT_SUCCESS_DURATION: 2000, // milliseconds\n};\n\n/**\n * Jump animation configuration\n *\n * Controls timing and visual properties for the jump animation sequence.\n * Durations are calibrated to provide excitement without tedium.\n */\nexport const ANIMATION_CONFIG = {\n  // Zoom transition durations\n  ZOOM_DURATION: 1.0, // seconds - fixed duration for camera transitions\n\n  // Travel duration range\n  MIN_TRAVEL_DURATION: 1.0, // seconds - minimum for short jumps to ensure visibility\n  MAX_TRAVEL_DURATION: 3.0, // seconds - maximum for long jumps to prevent tedium\n\n  // Distance scaling for travel duration\n  MIN_DISTANCE: 0, // light years - minimum jump distance\n  MAX_DISTANCE: 20, // light years - maximum distance in Sol Sector\n\n  // Ship indicator visual properties\n  SHIP_INDICATOR_SIZE: 8,\n  SHIP_INDICATOR_COLOR: 0xff0000, // Red\n  SHIP_INDICATOR_GLOW_INTENSITY: 1.5,\n  SHIP_INDICATOR_TEXTURE_SIZE: 64, // Canvas texture dimensions (matches star sprites)\n\n  // Reticle visual properties\n  RETICLE_SIZE: 15, // Radius of reticle circle\n  RETICLE_COLOR: 0x00ffff, // Cyan for contrast against red ship\n  RETICLE_SEGMENTS: 32, // Number of segments in reticle circle\n  RETICLE_LINE_WIDTH: 2, // Line width for reticle\n\n  // Camera positioning for side view\n  SIDE_VIEW_DISTANCE_MULTIPLIER: 1.5, // Distance from midpoint as multiple of star separation\n  MIN_SIDE_VIEW_DISTANCE: 100, // Minimum camera distance to prevent clipping\n\n  // Floating-point comparison epsilon\n  VECTOR_EPSILON: 0.0001, // Threshold for detecting parallel vectors in cross product\n\n  // Animation timeout for error recovery\n  ANIMATION_TIMEOUT: 10000, // milliseconds - force completion if animation hangs\n};\n","import {\n  BASE_PRICES,\n  ECONOMY_CONFIG,\n  calculateDistanceFromSol,\n} from './constants.js';\n\n/**\n * TradingSystem - Handles commodity trading, price calculations, and cargo management\n */\nexport class TradingSystem {\n  /**\n   * Calculate price with deterministic modifiers (tech, temporal, local, events)\n   *\n   * Applies the complete deterministic economy formula:\n   * P_final = round(P_base × M_tech × M_temporal × M_local × M_event)\n   *\n   * This replaces the old random-based system with predictable, simulation-based pricing.\n   *\n   * @param {string} goodType - Commodity type\n   * @param {Object} system - Star system with coordinates and ID\n   * @param {number} currentDay - Current game day for temporal modifier\n   * @param {Array} activeEvents - Active economic events\n   * @param {Object} marketConditions - Market saturation data: { [systemId]: { [goodType]: netQuantity } }\n   * @returns {number} Final price in credits (rounded integer)\n   */\n  static calculatePrice(\n    goodType,\n    system,\n    currentDay = 0,\n    activeEvents = [],\n    marketConditions = {}\n  ) {\n    const basePrice = BASE_PRICES[goodType];\n    if (basePrice === undefined) {\n      throw new Error(`Unknown good type: ${goodType}`);\n    }\n\n    if (!system || typeof system !== 'object') {\n      throw new Error('System object required for price calculation');\n    }\n\n    // Calculate all modifiers\n    const techLevel = TradingSystem.calculateTechLevel(system);\n    const techMod = TradingSystem.getTechModifier(goodType, techLevel);\n    const temporalMod = TradingSystem.getTemporalModifier(\n      system.id,\n      currentDay\n    );\n    const localMod = TradingSystem.getLocalModifier(\n      system.id,\n      goodType,\n      marketConditions\n    );\n    const eventMod = TradingSystem.getEventModifier(\n      system.id,\n      goodType,\n      activeEvents\n    );\n\n    // Apply complete formula\n    const price = basePrice * techMod * temporalMod * localMod * eventMod;\n    return Math.round(price);\n  }\n\n  static getEventModifier(systemId, goodType, activeEvents) {\n    if (!Array.isArray(activeEvents)) {\n      return 1.0;\n    }\n\n    const activeEvent = activeEvents.find(\n      (event) => event.systemId === systemId\n    );\n    if (!activeEvent || !activeEvent.modifiers) {\n      return 1.0;\n    }\n\n    return activeEvent.modifiers[goodType] || 1.0;\n  }\n\n  /**\n   * Calculate technology level for a system based on distance from Sol\n   *\n   * Technology level represents the technological advancement of a system,\n   * with Sol (distance 0) having the highest tech level (10.0) and frontier\n   * systems at 21+ light years having the lowest tech level (1.0).\n   *\n   * Formula: TL = 10.0 - (9.0 × min(distance, 21) / 21)\n   *\n   * This creates a linear gradient where:\n   * - Sol (0 LY): TL = 10.0\n   * - Barnard's Star (~6 LY): TL ≈ 7.4\n   * - Frontier (21+ LY): TL = 1.0\n   *\n   * @param {Object} system - Star system with x, y, z coordinates\n   * @returns {number} Technology level between 1.0 and 10.0\n   */\n  static calculateTechLevel(system) {\n    const distance = calculateDistanceFromSol(system);\n    const clampedDistance = Math.min(\n      distance,\n      ECONOMY_CONFIG.MAX_COORD_DISTANCE\n    );\n    const techLevel =\n      ECONOMY_CONFIG.MAX_TECH_LEVEL -\n      ((ECONOMY_CONFIG.MAX_TECH_LEVEL - ECONOMY_CONFIG.MIN_TECH_LEVEL) *\n        clampedDistance) /\n        ECONOMY_CONFIG.MAX_COORD_DISTANCE;\n    return techLevel;\n  }\n\n  /**\n   * Calculate tech modifier for a commodity based on technology level\n   *\n   * Tech modifier creates price differentials based on a commodity's tech bias\n   * and the system's technology level. Commodities with negative bias (raw materials,\n   * agricultural goods) are cheaper at low-tech systems, while commodities with\n   * positive bias (electronics, medicine) are cheaper at high-tech systems.\n   *\n   * Formula: modifier = 1.0 + (bias × (TECH_LEVEL_MIDPOINT - TL) × TECH_MODIFIER_INTENSITY)\n   *\n   * At TL midpoint (5.0), all modifiers are 1.0 (neutral).\n   * At TL 10.0 (Sol), negative bias commodities are expensive, positive bias are cheap.\n   * At TL 1.0 (frontier), negative bias commodities are cheap, positive bias are expensive.\n   *\n   * Examples:\n   * - Electronics (bias +1.0) at Sol (TL 10.0): 1.0 + (1.0 × (5.0 - 10.0) × 0.08) = 0.6 (40% cheaper)\n   * - Electronics (bias +1.0) at frontier (TL 1.0): 1.0 + (1.0 × (5.0 - 1.0) × 0.08) = 1.32 (32% more expensive)\n   * - Ore (bias -0.8) at Sol (TL 10.0): 1.0 + (-0.8 × (5.0 - 10.0) × 0.08) = 1.32 (32% more expensive)\n   * - Ore (bias -0.8) at frontier (TL 1.0): 1.0 + (-0.8 × (5.0 - 1.0) × 0.08) = 0.744 (25.6% cheaper)\n   *\n   * @param {string} goodType - Commodity type (grain, ore, tritium, parts, medicine, electronics)\n   * @param {number} techLevel - Technology level between 1.0 and 10.0\n   * @returns {number} Tech modifier multiplier\n   */\n  static getTechModifier(goodType, techLevel) {\n    if (typeof goodType !== 'string' || !goodType) {\n      throw new Error(\n        `Invalid goodType: expected non-empty string, got ${typeof goodType}`\n      );\n    }\n    if (typeof techLevel !== 'number' || isNaN(techLevel)) {\n      throw new Error(\n        `Invalid techLevel: expected valid number, got ${isNaN(techLevel) ? 'NaN' : typeof techLevel}`\n      );\n    }\n\n    const bias = ECONOMY_CONFIG.TECH_BIASES[goodType];\n    if (bias === undefined) {\n      throw new Error(`Unknown good type: ${goodType}`);\n    }\n\n    const modifier =\n      1.0 +\n      bias *\n        (ECONOMY_CONFIG.TECH_LEVEL_MIDPOINT - techLevel) *\n        ECONOMY_CONFIG.TECH_MODIFIER_INTENSITY;\n    return modifier;\n  }\n\n  /**\n   * Calculate temporal modifier for price drift over time\n   *\n   * Temporal modifier creates smooth, predictable price oscillations using a sine wave.\n   * Each system has a unique phase offset based on its ID, creating different price\n   * cycles across the sector. This allows players to observe trends and plan multi-day\n   * trading strategies.\n   *\n   * Formula: modifier = 1.0 + (amplitude × sin(2π × (day / period) + (systemId × 0.15)))\n   *\n   * The sine wave oscillates prices by ±15% (amplitude = 0.15) over a 30-day period.\n   * The 2π multiplier ensures the wave completes exactly one cycle every 30 days.\n   * System ID offset creates phase differences so systems reach peaks/troughs at different times.\n   *\n   * Examples:\n   * - System 0, Day 0: 1.0 + (0.15 × sin(0 + 0)) = 1.0 (neutral)\n   * - System 0, Day 7.5: 1.0 + (0.15 × sin(π/2)) = 1.15 (15% above baseline, peak)\n   * - System 0, Day 15: 1.0 + (0.15 × sin(π)) = 1.0 (neutral, halfway)\n   * - System 0, Day 22.5: 1.0 + (0.15 × sin(3π/2)) = 0.85 (15% below baseline, trough)\n   * - System 0, Day 30: 1.0 + (0.15 × sin(2π)) = 1.0 (neutral, cycle complete)\n   * - System 5, Day 0: 1.0 + (0.15 × sin(0 + 0.75)) ≈ 1.102 (different phase)\n   *\n   * @param {number} systemId - System identifier for phase offset\n   * @param {number} currentDay - Current game day\n   * @returns {number} Temporal modifier between 0.85 and 1.15\n   */\n  static getTemporalModifier(systemId, currentDay) {\n    if (typeof systemId !== 'number') {\n      throw new Error(\n        `Invalid systemId: expected number, got ${typeof systemId}`\n      );\n    }\n    if (typeof currentDay !== 'number' || isNaN(currentDay) || currentDay < 0) {\n      throw new Error(\n        `Invalid currentDay: expected non-negative number, got ${isNaN(currentDay) ? 'NaN' : currentDay}`\n      );\n    }\n\n    const phase =\n      (2 * Math.PI * currentDay) / ECONOMY_CONFIG.TEMPORAL_WAVE_PERIOD +\n      systemId * ECONOMY_CONFIG.TEMPORAL_PHASE_OFFSET;\n    const modifier = 1.0 + ECONOMY_CONFIG.TEMPORAL_AMPLITUDE * Math.sin(phase);\n    return modifier;\n  }\n\n  /**\n   * Calculate local modifier based on market saturation from player trading\n   *\n   * Local modifier creates dynamic price changes based on player buy/sell activity.\n   * When the player sells goods at a system, a surplus is created that lowers prices.\n   * When the player buys goods, a deficit is created that raises prices.\n   * This prevents infinite exploitation of a single trade route and encourages\n   * route rotation.\n   *\n   * Formula: modifier = clamp(1.0 - (surplus / MARKET_CAPACITY), LOCAL_MODIFIER_MIN, LOCAL_MODIFIER_MAX)\n   *\n   * Market conditions are stored as net quantity:\n   * - Positive value = surplus (player sold goods) → prices decrease\n   * - Negative value = deficit (player bought goods) → prices increase\n   * - Zero or missing = no trading history → neutral modifier (1.0)\n   *\n   * The modifier is clamped between 0.25 and 2.0 to prevent negative prices\n   * or infinite costs. At MARKET_CAPACITY (1000 units), the unclamped modifier\n   * would be 0.0 (surplus) or 2.0 (deficit), but clamping ensures reasonable bounds.\n   *\n   * Examples:\n   * - No trading history: modifier = 1.0 (neutral)\n   * - Surplus of 200: modifier = 1.0 - (200 / 1000) = 0.8 (20% cheaper)\n   * - Surplus of 1000: modifier = clamp(1.0 - 1.0, 0.25, 2.0) = 0.25 (75% cheaper, clamped)\n   * - Deficit of 200: modifier = 1.0 - (-200 / 1000) = 1.2 (20% more expensive)\n   * - Deficit of 1000: modifier = clamp(1.0 - (-1.0), 0.25, 2.0) = 2.0 (100% more expensive, clamped)\n   *\n   * @param {number} systemId - System identifier\n   * @param {string} goodType - Commodity type\n   * @param {Object} marketConditions - Market conditions data structure: { [systemId]: { [goodType]: netQuantity } }\n   * @returns {number} Local modifier between 0.25 and 2.0\n   */\n  static getLocalModifier(systemId, goodType, marketConditions) {\n    if (typeof systemId !== 'number') {\n      throw new Error(\n        `Invalid systemId: expected number, got ${typeof systemId}`\n      );\n    }\n    if (typeof goodType !== 'string' || !goodType) {\n      throw new Error(\n        `Invalid goodType: expected non-empty string, got ${typeof goodType}`\n      );\n    }\n\n    const surplus = marketConditions?.[systemId]?.[goodType] ?? 0;\n    const modifier = 1.0 - surplus / ECONOMY_CONFIG.MARKET_CAPACITY;\n    const clampedModifier = Math.max(\n      ECONOMY_CONFIG.LOCAL_MODIFIER_MIN,\n      Math.min(ECONOMY_CONFIG.LOCAL_MODIFIER_MAX, modifier)\n    );\n    return clampedModifier;\n  }\n\n  static calculateCargoUsed(cargo) {\n    if (!Array.isArray(cargo)) {\n      return 0;\n    }\n\n    return cargo.reduce((total, stack) => {\n      return total + (stack.qty || 0);\n    }, 0);\n  }\n\n  /**\n   * Calculate the value of a single cargo entry\n   *\n   * Returns the total value based on purchase price and quantity.\n   * Value = quantity × buyPrice\n   *\n   * Feature: ship-personality, Property 7: Cargo Manifest Value Calculation\n   * Validates: Requirements 5.3\n   *\n   * @param {Object} cargoEntry - Cargo stack with qty and buyPrice\n   * @returns {number} Total value in credits\n   */\n  static calculateCargoValue(cargoEntry) {\n    if (!cargoEntry || typeof cargoEntry !== 'object') {\n      throw new Error('Invalid cargo entry: expected object');\n    }\n    if (typeof cargoEntry.qty !== 'number') {\n      throw new Error('Invalid cargo entry: qty must be a number');\n    }\n    if (typeof cargoEntry.buyPrice !== 'number') {\n      throw new Error('Invalid cargo entry: buyPrice must be a number');\n    }\n\n    return cargoEntry.qty * cargoEntry.buyPrice;\n  }\n\n  /**\n   * Calculate total capacity usage and total value for cargo manifest\n   *\n   * Computes:\n   * - totalCapacityUsed: Sum of all cargo quantities\n   * - totalValue: Sum of all cargo values (qty × buyPrice for each stack)\n   *\n   * Feature: ship-personality, Property 8: Cargo Manifest Total Calculations\n   * Validates: Requirements 5.4, 5.5\n   *\n   * @param {Array} cargo - Array of cargo stacks\n   * @returns {Object} { totalCapacityUsed: number, totalValue: number }\n   */\n  static calculateCargoTotals(cargo) {\n    if (!Array.isArray(cargo)) {\n      throw new Error('Invalid cargo: expected array');\n    }\n\n    let totalCapacityUsed = 0;\n    let totalValue = 0;\n\n    for (const stack of cargo) {\n      if (typeof stack.qty !== 'number') {\n        throw new Error('Invalid cargo stack: qty must be a number');\n      }\n      totalCapacityUsed += stack.qty;\n      totalValue += TradingSystem.calculateCargoValue(stack);\n    }\n\n    return {\n      totalCapacityUsed,\n      totalValue,\n    };\n  }\n\n  static validatePurchase(credits, cargoSpace, quantity, price) {\n    const totalCost = quantity * price;\n\n    if (totalCost > credits) {\n      return {\n        valid: false,\n        reason: 'Insufficient credits',\n      };\n    }\n\n    if (quantity > cargoSpace) {\n      return {\n        valid: false,\n        reason: 'Not enough cargo space',\n      };\n    }\n\n    return { valid: true };\n  }\n\n  static validateSale(cargo, stackIndex, quantity) {\n    if (!Array.isArray(cargo) || stackIndex < 0 || stackIndex >= cargo.length) {\n      return {\n        valid: false,\n        reason: 'Invalid cargo stack',\n      };\n    }\n\n    const stack = cargo[stackIndex];\n    if (quantity > stack.qty) {\n      return {\n        valid: false,\n        reason: 'Not enough quantity in stack',\n      };\n    }\n\n    return { valid: true };\n  }\n\n  /**\n   * Records a cargo purchase with full metadata\n   *\n   * Creates a new cargo entry with purchase details including:\n   * - good: Commodity type\n   * - qty: Quantity purchased\n   * - buyPrice: Price per unit\n   * - buySystem: System ID where purchased\n   * - buySystemName: System name where purchased\n   * - buyDate: Game day when purchased\n   *\n   * Stack consolidation: Cargo with matching good type and price is consolidated\n   * into a single stack. Metadata (system, date) is preserved from the first\n   * purchase that created the stack.\n   *\n   * Feature: ship-personality, Property 6: Cargo Purchase Metadata Completeness\n   * Validates: Requirements 5.6\n   *\n   * @param {Array} cargo - Current cargo array\n   * @param {string} goodType - Commodity type\n   * @param {number} quantity - Quantity purchased\n   * @param {number} price - Price per unit\n   * @param {number} systemId - System ID where purchased\n   * @param {string} systemName - System name where purchased\n   * @param {number} day - Game day when purchased\n   * @returns {Array} Updated cargo array\n   */\n  static recordCargoPurchase(\n    cargo,\n    goodType,\n    quantity,\n    price,\n    systemId,\n    systemName,\n    day\n  ) {\n    // Stack consolidation: match on good type and price only\n    // Metadata (system, date) is preserved from the first purchase that created the stack\n    const existingStackIndex = cargo.findIndex(\n      (stack) => stack.good === goodType && stack.buyPrice === price\n    );\n\n    if (existingStackIndex !== -1) {\n      // Consolidate with existing stack - preserve original metadata\n      const updatedCargo = [...cargo];\n      updatedCargo[existingStackIndex] = {\n        ...updatedCargo[existingStackIndex],\n        qty: updatedCargo[existingStackIndex].qty + quantity,\n      };\n      return updatedCargo;\n    }\n\n    // Create new stack with complete metadata\n    const newStack = {\n      good: goodType,\n      qty: quantity,\n      buyPrice: price,\n      buySystem: systemId,\n      buySystemName: systemName,\n      buyDate: day,\n    };\n\n    return [...cargo, newStack];\n  }\n\n  /**\n   * Consolidates cargo into existing stack if same good and price, otherwise creates new stack\n   *\n   * @deprecated Use recordCargoPurchase for new code - this method is kept for backward compatibility\n   */\n  static addCargoStack(\n    cargo,\n    goodType,\n    quantity,\n    price,\n    systemId = null,\n    systemName = null,\n    day = null\n  ) {\n    // Stack consolidation: match on good type and price only\n    // Metadata (system, date) is preserved from the first purchase that created the stack\n    const existingStackIndex = cargo.findIndex(\n      (stack) => stack.good === goodType && stack.buyPrice === price\n    );\n\n    if (existingStackIndex !== -1) {\n      // Consolidate with existing stack - preserve original metadata\n      const updatedCargo = [...cargo];\n      updatedCargo[existingStackIndex] = {\n        ...updatedCargo[existingStackIndex],\n        qty: updatedCargo[existingStackIndex].qty + quantity,\n      };\n      return updatedCargo;\n    }\n\n    // Create new stack with metadata\n    const newStack = {\n      good: goodType,\n      qty: quantity,\n      buyPrice: price,\n    };\n\n    if (systemId !== null) {\n      newStack.buySystem = systemId;\n    }\n    if (systemName !== null) {\n      newStack.buySystemName = systemName;\n    }\n    if (day !== null) {\n      newStack.buyDate = day;\n    }\n\n    return [...cargo, newStack];\n  }\n\n  /**\n   * Removes stack entirely if quantity reaches zero\n   */\n  static removeFromCargoStack(cargo, stackIndex, quantity) {\n    const updatedCargo = [...cargo];\n    const stack = updatedCargo[stackIndex];\n    stack.qty -= quantity;\n\n    if (stack.qty <= 0) {\n      updatedCargo.splice(stackIndex, 1);\n    }\n\n    return updatedCargo;\n  }\n}\n","/**\n * Seeded Random Number Generator\n *\n * Uses a Linear Congruential Generator (LCG) with parameters chosen for\n * fast computation and adequate distribution for game price fluctuations.\n * NOT cryptographically secure - designed for deterministic game mechanics.\n */\n\nexport class SeededRandom {\n  /**\n   * @param {string} seed - Seed string for deterministic generation\n   */\n  constructor(seed) {\n    this.hash = this._stringToHash(seed);\n  }\n\n  /**\n   * djb2 hash variant - fast string hashing with good distribution.\n   * Formula: hash = ((hash << 5) - hash) + charCode\n   * @param {string} str - Seed string\n   * @returns {number} Hash value\n   * @private\n   */\n  _stringToHash(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      hash = (hash << 5) - hash + str.charCodeAt(i);\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n    return hash;\n  }\n\n  /**\n   * LCG parameters from Numerical Recipes - adequate period for game use.\n   * Formula: hash = (hash × 9301 + 49297) % 233280\n   * Math.abs needed because hash can be negative from djb2 overflow.\n   * @returns {number} Random value between 0 and 1\n   */\n  next() {\n    this.hash = (this.hash * 9301 + 49297) % 233280;\n    return Math.abs(this.hash) / 233280;\n  }\n\n  /**\n   * @param {number} min - Minimum value (inclusive)\n   * @param {number} max - Maximum value (inclusive)\n   * @returns {number} Random integer\n   */\n  nextInt(min, max) {\n    const range = max - min + 1;\n    return Math.floor(this.next() * range) + min;\n  }\n\n  /**\n   * @param {number} min - Minimum value\n   * @param {number} max - Maximum value\n   * @returns {number} Random float\n   */\n  nextFloat(min, max) {\n    const range = max - min;\n    return this.next() * range + min;\n  }\n}\n","import { SeededRandom } from './utils/seeded-random.js';\nimport {\n  COMMODITY_TYPES,\n  SOL_SYSTEM_ID,\n  ALPHA_CENTAURI_SYSTEM_ID,\n} from './constants.js';\n\n/**\n * EconomicEventsSystem - Manages random economic events that affect commodity prices\n *\n * Events are temporary market conditions that create trading opportunities and challenges.\n * Each event type has specific triggers, duration, and price modifiers.\n */\nexport class EconomicEventsSystem {\n  /**\n   * Event type definitions with triggers, durations, and modifiers\n   */\n  static EVENT_TYPES = {\n    mining_strike: {\n      name: 'Mining Strike',\n      description: 'Workers demand better conditions',\n      duration: [5, 10], // Min/max days\n      modifiers: {\n        ore: 1.5,\n        tritium: 1.3,\n      },\n      chance: 0.05, // 5% per day per eligible system\n      targetSystems: 'mining', // Systems with ore production advantage\n    },\n    medical_emergency: {\n      name: 'Medical Emergency',\n      description: 'Outbreak requires urgent supplies',\n      duration: [3, 5],\n      modifiers: {\n        medicine: 2.0,\n        grain: 0.9,\n        ore: 0.9,\n      },\n      chance: 0.03,\n      targetSystems: 'any',\n    },\n    festival: {\n      name: 'Cultural Festival',\n      description: 'Celebration drives luxury demand',\n      duration: [2, 4],\n      modifiers: {\n        electronics: 1.75,\n        grain: 1.2,\n      },\n      chance: 0.04,\n      targetSystems: 'core', // Sol Sphere systems\n    },\n    supply_glut: {\n      name: 'Supply Glut',\n      description: 'Oversupply crashes prices',\n      duration: [3, 7],\n      modifiers: {\n        // Random good at 0.6 (40% reduction) - determined at event creation\n      },\n      chance: 0.06,\n      targetSystems: 'any',\n    },\n  };\n\n  /**\n   * Core system IDs (Sol and Alpha Centauri)\n   */\n  static CORE_SYSTEM_IDS = [SOL_SYSTEM_ID, ALPHA_CENTAURI_SYSTEM_ID];\n\n  /**\n   * Spectral classes that indicate mining systems (high ore production)\n   */\n  static MINING_SPECTRAL_CLASSES = ['M', 'L', 'T'];\n\n  /**\n   * Update events for new day - trigger new events and remove expired ones\n   *\n   * @param {Object} gameState - Current game state\n   * @param {Array} starData - Star system data\n   * @returns {Array} Updated active events array\n   */\n  static updateEvents(gameState, starData) {\n    if (!gameState || !starData) {\n      return [];\n    }\n\n    const currentDay = gameState.player?.daysElapsed || 0;\n    let activeEvents = gameState.world?.activeEvents || [];\n\n    // Remove expired events\n    activeEvents = EconomicEventsSystem.removeExpiredEvents(\n      activeEvents,\n      currentDay\n    );\n\n    // Try to trigger new events\n    for (const eventTypeKey in EconomicEventsSystem.EVENT_TYPES) {\n      const eventType = EconomicEventsSystem.EVENT_TYPES[eventTypeKey];\n\n      // Check each system for potential event trigger\n      for (const system of starData) {\n        // Skip if system already has an active event\n        if (activeEvents.some((event) => event.systemId === system.id)) {\n          continue;\n        }\n\n        // Check if system is eligible for this event type\n        if (!EconomicEventsSystem.isSystemEligible(system, eventType)) {\n          continue;\n        }\n\n        // Roll for event trigger using seeded random\n        const seed = `event_${eventTypeKey}_${system.id}_${currentDay}`;\n        const rng = new SeededRandom(seed);\n        const roll = rng.next();\n\n        if (roll < eventType.chance) {\n          // Event triggered!\n          const newEvent = EconomicEventsSystem.createEvent(\n            eventTypeKey,\n            system.id,\n            currentDay\n          );\n          activeEvents.push(newEvent);\n\n          // Only one event per system, so break after creating one\n          break;\n        }\n      }\n    }\n\n    return activeEvents;\n  }\n\n  /**\n   * Check if system is eligible for event type based on target criteria\n   *\n   * @param {Object} system - Star system data\n   * @param {Object} eventType - Event type definition\n   * @returns {boolean} True if eligible\n   */\n  static isSystemEligible(system, eventType) {\n    if (!system || !eventType) {\n      return false;\n    }\n\n    const targetSystems = eventType.targetSystems;\n\n    if (targetSystems === 'any') {\n      return true;\n    }\n\n    if (targetSystems === 'core') {\n      return EconomicEventsSystem.CORE_SYSTEM_IDS.includes(system.id);\n    }\n\n    if (targetSystems === 'mining') {\n      const spectralLetter = system.type?.charAt(0).toUpperCase();\n      return EconomicEventsSystem.MINING_SPECTRAL_CLASSES.includes(\n        spectralLetter\n      );\n    }\n\n    return false;\n  }\n\n  /**\n   * Create new event instance with unique ID and randomized duration\n   *\n   * @param {string} eventTypeKey - Event type identifier\n   * @param {number} systemId - Target system ID\n   * @param {number} currentDay - Current game day\n   * @returns {Object} Event instance\n   */\n  static createEvent(eventTypeKey, systemId, currentDay) {\n    const eventType = EconomicEventsSystem.EVENT_TYPES[eventTypeKey];\n\n    if (!eventType) {\n      throw new Error(`Unknown event type: ${eventTypeKey}`);\n    }\n\n    // Generate unique event ID\n    const id = `${eventTypeKey}_${systemId}_${currentDay}`;\n\n    // Randomize duration within range using seeded random\n    const seed = `duration_${id}`;\n    const rng = new SeededRandom(seed);\n    const [minDuration, maxDuration] = eventType.duration;\n    const duration =\n      minDuration + Math.floor(rng.next() * (maxDuration - minDuration + 1));\n\n    // Calculate end day\n    const endDay = currentDay + duration;\n\n    // Handle supply_glut special case - pick random commodity\n    let modifiers = { ...eventType.modifiers };\n    if (eventTypeKey === 'supply_glut') {\n      const commoditySeed = `commodity_${id}`;\n      const commodityRng = new SeededRandom(commoditySeed);\n      const commodityIndex = Math.floor(\n        commodityRng.next() * COMMODITY_TYPES.length\n      );\n      const randomCommodity = COMMODITY_TYPES[commodityIndex];\n      modifiers = { [randomCommodity]: 0.6 };\n    }\n\n    return {\n      id,\n      type: eventTypeKey,\n      systemId,\n      startDay: currentDay,\n      endDay,\n      modifiers,\n    };\n  }\n\n  /**\n   * Remove expired events where currentDay > endDay\n   *\n   * @param {Array} activeEvents - Current active events\n   * @param {number} currentDay - Current game day\n   * @returns {Array} Filtered active events\n   */\n  static removeExpiredEvents(activeEvents, currentDay) {\n    if (!Array.isArray(activeEvents)) {\n      return [];\n    }\n\n    return activeEvents.filter((event) => {\n      return event.endDay >= currentDay;\n    });\n  }\n\n  /**\n   * Get active event for a specific system\n   *\n   * @param {number} systemId - System identifier\n   * @param {Array} activeEvents - Active events list\n   * @returns {Object|null} Active event or null\n   */\n  static getActiveEventForSystem(systemId, activeEvents) {\n    if (!Array.isArray(activeEvents)) {\n      return null;\n    }\n\n    return activeEvents.find((event) => event.systemId === systemId) || null;\n  }\n}\n","import { COMMODITY_TYPES, INTELLIGENCE_CONFIG } from './constants.js';\nimport { TradingSystem } from './game-trading.js';\nimport { SeededRandom } from './utils/seeded-random.js';\n\n/**\n * InformationBroker - Handles market intelligence purchases and rumor generation\n *\n * Provides players with price data for systems they haven't visited recently,\n * creating a strategic layer around information gathering and trading decisions.\n */\nexport class InformationBroker {\n  /**\n   * Calculate intelligence cost for a system based on visit history\n   *\n   * @param {number} systemId - Target system ID\n   * @param {Object} priceKnowledge - Player's price knowledge database\n   * @returns {number} Cost in credits\n   */\n  static getIntelligenceCost(systemId, priceKnowledge) {\n    const knowledge = priceKnowledge[systemId];\n\n    // Never visited\n    if (!knowledge) {\n      return INTELLIGENCE_CONFIG.PRICES.NEVER_VISITED;\n    }\n\n    // Recently visited (within threshold)\n    if (knowledge.lastVisit <= INTELLIGENCE_CONFIG.RECENT_THRESHOLD) {\n      return INTELLIGENCE_CONFIG.PRICES.RECENT_VISIT;\n    }\n\n    // Stale visit (beyond threshold)\n    return INTELLIGENCE_CONFIG.PRICES.STALE_VISIT;\n  }\n\n  /**\n   * Purchase market intelligence for a system\n   *\n   * Deducts credits and updates price knowledge with current prices.\n   * Intelligence data is sometimes unreliable - prices may be manipulated\n   * to show false profit opportunities.\n   *\n   * @param {Object} gameState - Current game state\n   * @param {number} systemId - Target system ID\n   * @param {Array} starData - Star system data\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  static purchaseIntelligence(gameState, systemId, starData) {\n    const priceKnowledge = gameState.world.priceKnowledge || {};\n    const credits = gameState.player.credits;\n\n    // Calculate cost\n    const cost = InformationBroker.getIntelligenceCost(\n      systemId,\n      priceKnowledge\n    );\n\n    // Validate purchase\n    const validation = InformationBroker.validatePurchase(cost, credits);\n    if (!validation.valid) {\n      return { success: false, reason: validation.reason };\n    }\n\n    // Find target system\n    const system = starData.find((s) => s.id === systemId);\n    if (!system) {\n      return { success: false, reason: 'System not found' };\n    }\n\n    // Calculate current prices for the system\n    const currentDay = gameState.player.daysElapsed;\n    const activeEvents = gameState.world.activeEvents || [];\n    const currentPrices = {};\n\n    // Use seeded random for deterministic price manipulation\n    // Seed includes system ID and day to ensure consistency\n    const seed = `intel_${systemId}_${currentDay}`;\n    const rng = new SeededRandom(seed);\n    const marketConditions = gameState.world.marketConditions || {};\n\n    for (const goodType of COMMODITY_TYPES) {\n      let price = TradingSystem.calculatePrice(\n        goodType,\n        system,\n        currentDay,\n        activeEvents,\n        marketConditions\n      );\n\n      // Sometimes the intelligence is unreliable - prices are manipulated\n      // to show false profit opportunities\n      if (rng.next() < INTELLIGENCE_CONFIG.RELIABILITY.MANIPULATION_CHANCE) {\n        const manipulationMultiplier =\n          INTELLIGENCE_CONFIG.RELIABILITY.MIN_MANIPULATION_MULTIPLIER +\n          rng.next() *\n            (INTELLIGENCE_CONFIG.RELIABILITY.MAX_MANIPULATION_MULTIPLIER -\n              INTELLIGENCE_CONFIG.RELIABILITY.MIN_MANIPULATION_MULTIPLIER);\n        price = Math.round(price * manipulationMultiplier);\n      }\n\n      currentPrices[goodType] = price;\n    }\n\n    // Deduct credits\n    gameState.player.credits -= cost;\n\n    // Update price knowledge\n    gameState.world.priceKnowledge[systemId] = {\n      lastVisit: 0, // Intelligence is \"current\"\n      prices: currentPrices,\n    };\n\n    return { success: true, reason: null };\n  }\n\n  /**\n   * Clean up old intelligence data\n   *\n   * Removes market data older than INTELLIGENCE_MAX_AGE days to prevent\n   * stale information from cluttering the player's knowledge base.\n   *\n   * lastVisit represents days since last visit and is incremented automatically\n   * as time passes, so we just check if it exceeds the threshold.\n   *\n   * @param {Object} priceKnowledge - Player's price knowledge database\n   * @returns {number} Number of systems cleaned up\n   */\n  static cleanupOldIntelligence(priceKnowledge) {\n    let cleanedCount = 0;\n\n    for (const systemId in priceKnowledge) {\n      const knowledge = priceKnowledge[systemId];\n\n      if (knowledge.lastVisit > INTELLIGENCE_CONFIG.MAX_AGE) {\n        delete priceKnowledge[systemId];\n        cleanedCount++;\n      }\n    }\n\n    return cleanedCount;\n  }\n\n  /**\n   * Generate a market rumor with hints about prices or events\n   *\n   * Uses seeded random based on current day for deterministic behavior.\n   * This ensures rumors are consistent for the same game state, making\n   * testing reliable while still providing variety across different days.\n   *\n   * @param {Object} gameState - Current game state\n   * @param {Array} starData - Star system data\n   * @returns {string} Rumor text\n   */\n  static generateRumor(gameState, starData) {\n    const currentDay = gameState.player.daysElapsed;\n    const activeEvents = gameState.world.activeEvents || [];\n\n    // Use seeded random for deterministic rumor generation\n    const seed = `rumor_${currentDay}`;\n    const rng = new SeededRandom(seed);\n\n    // If there are active events, 50% chance to hint about one\n    if (activeEvents.length > 0 && rng.next() < 0.5) {\n      const rumorTargetIndex = Math.floor(rng.next() * activeEvents.length);\n      const marketDisruption = activeEvents[rumorTargetIndex];\n      const system = starData.find((s) => s.id === marketDisruption.systemId);\n\n      if (system) {\n        // Get event type name from the event object or use generic description\n        const eventDescriptions = {\n          mining_strike: 'labor troubles',\n          medical_emergency: 'a health crisis',\n          festival: 'celebrations',\n          supply_glut: 'oversupply issues',\n        };\n\n        const description =\n          eventDescriptions[marketDisruption.type] ||\n          'unusual market conditions';\n        return `I heard ${system.name} is experiencing ${description}. Might be worth checking out.`;\n      }\n    }\n\n    // Otherwise, hint about a good price somewhere\n    const rumorCommodityIndex = Math.floor(rng.next() * COMMODITY_TYPES.length);\n    const rumorCommodity = COMMODITY_TYPES[rumorCommodityIndex];\n    const marketConditions = gameState.world.marketConditions || {};\n\n    // Find a system with a good price for this commodity\n    let bestSystem = null;\n    let bestPrice = Infinity;\n\n    for (const system of starData) {\n      const price = TradingSystem.calculatePrice(\n        rumorCommodity,\n        system,\n        currentDay,\n        activeEvents,\n        marketConditions\n      );\n      if (price < bestPrice) {\n        bestPrice = price;\n        bestSystem = system;\n      }\n    }\n\n    if (bestSystem) {\n      return `Word on the street is that ${rumorCommodity} prices are pretty good at ${bestSystem.name} right now.`;\n    }\n\n    // Fallback generic rumor\n    return `The markets are always changing. Keep your eyes open for opportunities.`;\n  }\n\n  /**\n   * Validate intelligence purchase\n   *\n   * @param {number} cost - Intelligence cost\n   * @param {number} credits - Player credits\n   * @returns {Object} { valid: boolean, reason: string }\n   */\n  static validatePurchase(cost, credits) {\n    if (credits < cost) {\n      return {\n        valid: false,\n        reason: 'Insufficient credits for intelligence',\n      };\n    }\n\n    return { valid: true, reason: null };\n  }\n\n  /**\n   * Get all systems with their intelligence costs\n   *\n   * Used for displaying the information broker interface.\n   * Only returns systems connected to the current system via wormholes.\n   *\n   * When Advanced Sensor Array upgrade is installed, includes active economic\n   * events for connected systems.\n   *\n   * @param {Object} priceKnowledge - Player's price knowledge database\n   * @param {Array} starData - Star system data\n   * @param {number} currentSystemId - Current system ID\n   * @param {Object} navigationSystem - NavigationSystem instance for checking connections\n   * @param {Array} activeEvents - Active economic events (optional)\n   * @param {boolean} hasAdvancedSensors - Whether Advanced Sensor Array is installed (optional)\n   * @returns {Array} Array of { systemId, systemName, cost, lastVisit, event? }\n   */\n  static listAvailableIntelligence(\n    priceKnowledge,\n    starData,\n    currentSystemId,\n    navigationSystem,\n    activeEvents = [],\n    hasAdvancedSensors = false\n  ) {\n    // Get systems connected to current system\n    const connectedSystemIds =\n      navigationSystem.getConnectedSystems(currentSystemId);\n\n    // Filter to only connected systems and map to intelligence data\n    return starData\n      .filter((system) => connectedSystemIds.includes(system.id))\n      .map((system) => {\n        const knowledge = priceKnowledge[system.id];\n        const cost = InformationBroker.getIntelligenceCost(\n          system.id,\n          priceKnowledge\n        );\n        const lastVisit = knowledge ? knowledge.lastVisit : null;\n\n        const result = {\n          systemId: system.id,\n          systemName: system.name,\n          cost: cost,\n          lastVisit: lastVisit,\n        };\n\n        // Add event information if Advanced Sensor Array is installed\n        if (hasAdvancedSensors && activeEvents.length > 0) {\n          const systemEvent = activeEvents.find(\n            (event) => event.systemId === system.id\n          );\n          if (systemEvent) {\n            result.event = {\n              name: systemEvent.name,\n              commodity: systemEvent.commodity,\n              modifier: systemEvent.modifier,\n            };\n          }\n        }\n\n        return result;\n      });\n  }\n}\n\n// Re-export constants for testing convenience\nexport { INTELLIGENCE_CONFIG };\n","import { SAVE_KEY, SAVE_DEBOUNCE_MS } from '../constants.js';\n\n/**\n * Save game state to localStorage with debouncing\n *\n * Implements save debouncing to prevent excessive saves (max 1 save per second).\n * This protects against rapid state changes causing performance issues.\n *\n * Creates a new state object with updated timestamp without mutating the input.\n *\n * @param {Object} state - Complete game state to save\n * @param {number} lastSaveTime - Timestamp of last save (milliseconds since epoch)\n * @param {boolean} isTestEnvironment - Whether running in test mode (suppresses console output)\n * @returns {Object} { success: boolean, newLastSaveTime: number }\n */\nexport function saveGame(state, lastSaveTime, isTestEnvironment) {\n  if (!state) {\n    console.error('Cannot save: no game state exists');\n    return { success: false, newLastSaveTime: lastSaveTime };\n  }\n\n  // Debounce: skip save if less than 1 second since last save\n  const now = Date.now();\n  if (now - lastSaveTime < SAVE_DEBOUNCE_MS) {\n    if (!isTestEnvironment) {\n      console.log('Save debounced (too soon since last save)');\n    }\n    return { success: false, newLastSaveTime: lastSaveTime };\n  }\n\n  try {\n    // Create new state object with updated timestamp (avoid mutation)\n    const stateToSave = {\n      ...state,\n      meta: {\n        ...state.meta,\n        timestamp: now,\n      },\n    };\n    const saveData = JSON.stringify(stateToSave);\n    localStorage.setItem(SAVE_KEY, saveData);\n\n    if (!isTestEnvironment) {\n      console.log('Game saved successfully');\n    }\n    return { success: true, newLastSaveTime: now };\n  } catch (error) {\n    console.error('Failed to save game:', error);\n    return { success: false, newLastSaveTime: lastSaveTime };\n  }\n}\n\n/**\n * Load game state from localStorage\n *\n * Returns the raw loaded state without validation or migration.\n * Validation and migration should be handled by the caller.\n *\n * @param {boolean} isTestEnvironment - Whether running in test mode (suppresses console output)\n * @returns {Object|null} Loaded state or null if no save exists or load fails\n */\nexport function loadGame(isTestEnvironment) {\n  try {\n    // Retrieve save data from localStorage\n    const saveData = localStorage.getItem(SAVE_KEY);\n\n    if (!saveData) {\n      if (!isTestEnvironment) {\n        console.log('No saved game found');\n      }\n      return null;\n    }\n\n    const loadedState = JSON.parse(saveData);\n\n    if (!isTestEnvironment) {\n      console.log('Game loaded successfully');\n    }\n\n    return loadedState;\n  } catch (error) {\n    if (!isTestEnvironment) {\n      console.log('Failed to load game:', error);\n    }\n    return null;\n  }\n}\n\n/**\n * Check if saved game exists in localStorage\n *\n * @returns {boolean} True if save data exists\n */\nexport function hasSavedGame() {\n  try {\n    const saveData = localStorage.getItem(SAVE_KEY);\n    return saveData !== null;\n  } catch (error) {\n    console.error('Failed to check for saved game:', error);\n    return false;\n  }\n}\n\n/**\n * Clear saved game from localStorage\n *\n * @param {boolean} isTestEnvironment - Whether running in test mode (suppresses console output)\n * @returns {boolean} True if clear succeeded\n */\nexport function clearSave(isTestEnvironment) {\n  try {\n    localStorage.removeItem(SAVE_KEY);\n    if (!isTestEnvironment) {\n      console.log('Save data cleared');\n    }\n    return true;\n  } catch (error) {\n    console.error('Failed to clear save:', error);\n    return false;\n  }\n}\n","import { GAME_VERSION, SHIP_CONFIG, COMMODITY_TYPES } from '../constants.js';\nimport { TradingSystem } from '../game-trading.js';\n\n/**\n * State Validators Module\n *\n * Handles validation and migration of game save data.\n * Ensures save files are compatible with current game version and have valid structure.\n */\n\n/**\n * Validate and filter ship configuration IDs (quirks or upgrades).\n * Removes unknown IDs and warns about them.\n *\n * @param {Array} configIds - Array of configuration IDs to validate\n * @param {Object} validConfigs - Map of valid IDs (e.g., SHIP_CONFIG.QUIRKS)\n * @param {string} configType - Type of config for warning messages ('quirk' or 'upgrade')\n * @returns {Array} Filtered array containing only valid IDs\n */\nfunction validateShipConfigIds(configIds, validConfigs, configType) {\n  const validatedIds = [];\n  for (const configId of configIds) {\n    if (validConfigs[configId]) {\n      validatedIds.push(configId);\n    } else {\n      console.warn(\n        `Unknown ${configType} ID: ${configId}, removing from save data`\n      );\n    }\n  }\n  return validatedIds;\n}\n\n/**\n * Validate and repair cargo stack structure, ensuring all required fields are present.\n * Used during state loading to handle corrupted or incomplete save data.\n *\n * @param {Array} cargoStacks - Array of cargo stacks to validate\n * @param {number} currentSystemId - System ID to use for missing buySystem\n * @param {Array} systemData - Star system data for system name lookups\n * @param {string} compartmentType - Type of cargo for warning messages ('cargo' or 'hidden cargo')\n */\nfunction validateAndRepairCargoStacks(\n  cargoStacks,\n  currentSystemId,\n  systemData,\n  compartmentType\n) {\n  for (const cargoStack of cargoStacks) {\n    // Ensure all required fields are present\n    if (!cargoStack.good || typeof cargoStack.qty !== 'number') {\n      console.warn(\n        `Invalid ${compartmentType} stack found, skipping:`,\n        cargoStack\n      );\n      continue;\n    }\n    if (typeof cargoStack.buyPrice !== 'number') {\n      console.warn(\n        `${compartmentType} stack missing buyPrice, using 0:`,\n        cargoStack.good\n      );\n      cargoStack.buyPrice = 0;\n    }\n    if (typeof cargoStack.buySystem !== 'number') {\n      console.warn(\n        `${compartmentType} stack missing buySystem, using current system:`,\n        cargoStack.good\n      );\n      cargoStack.buySystem = currentSystemId;\n    }\n    if (typeof cargoStack.buySystemName !== 'string') {\n      const system = systemData.find((s) => s.id === cargoStack.buySystem);\n      cargoStack.buySystemName = system ? system.name : 'Unknown';\n    }\n    if (typeof cargoStack.buyDate !== 'number') {\n      cargoStack.buyDate = 0;\n    }\n  }\n}\n\n/**\n * Normalize cargo stack field names from old versions to current schema.\n * Migrates purchasePrice → buyPrice, purchaseSystem → buySystem, purchaseDay → buyDate.\n * Adds defaults for missing metadata fields.\n *\n * @param {Object} cargoStack - Cargo stack to normalize\n * @param {number} currentSystemId - System ID to use if buySystem is missing\n * @param {Array} systemData - Star system data for system name lookups\n */\nfunction normalizeCargoStack(cargoStack, currentSystemId, systemData) {\n  // Migrate old field names to new ones\n  if (\n    cargoStack.purchasePrice !== undefined &&\n    cargoStack.buyPrice === undefined\n  ) {\n    cargoStack.buyPrice = cargoStack.purchasePrice;\n    delete cargoStack.purchasePrice;\n  }\n  if (\n    cargoStack.purchaseSystem !== undefined &&\n    cargoStack.buySystem === undefined\n  ) {\n    cargoStack.buySystem = cargoStack.purchaseSystem;\n    delete cargoStack.purchaseSystem;\n  }\n  if (\n    cargoStack.purchaseDay !== undefined &&\n    cargoStack.buyDate === undefined\n  ) {\n    cargoStack.buyDate = cargoStack.purchaseDay;\n    delete cargoStack.purchaseDay;\n  }\n\n  // Add defaults for missing fields\n  if (cargoStack.buySystem === undefined) {\n    cargoStack.buySystem = currentSystemId;\n  }\n  if (cargoStack.buySystemName === undefined) {\n    const system = systemData.find((s) => s.id === cargoStack.buySystem);\n    cargoStack.buySystemName = system ? system.name : 'Unknown';\n  }\n  if (cargoStack.buyDate === undefined) {\n    cargoStack.buyDate = 0;\n  }\n}\n\n/**\n * Check if save version is compatible with current game version\n *\n * Supports migration from v1.0.0 to v2.1.0 and v2.0.0 to v2.1.0.\n * Returns true if the save version matches exactly or can be migrated.\n *\n * @param {string} saveVersion - Version from save file\n * @returns {boolean} True if compatible\n */\nexport function isVersionCompatible(saveVersion) {\n  if (!saveVersion) return false;\n\n  // Exact version match\n  if (saveVersion === GAME_VERSION) return true;\n\n  // Support migration from v1.0.0 to v2.1.0\n  if (saveVersion === '1.0.0' && GAME_VERSION === '2.1.0') return true;\n\n  // Support migration from v2.0.0 to v2.1.0\n  if (saveVersion === '2.0.0' && GAME_VERSION === '2.1.0') return true;\n\n  return false;\n}\n\n/**\n * Validate that loaded state has required structure\n *\n * Checks that all required fields exist and have correct types.\n * Optional fields (like ship condition, price knowledge) are allowed to be missing\n * and will be initialized by addStateDefaults if needed.\n *\n * @param {Object} state - State to validate\n * @returns {boolean} True if valid\n */\nexport function validateStateStructure(state) {\n  if (!state) return false;\n\n  // Check player structure\n  if (\n    !state.player ||\n    typeof state.player.credits !== 'number' ||\n    typeof state.player.debt !== 'number' ||\n    typeof state.player.currentSystem !== 'number' ||\n    typeof state.player.daysElapsed !== 'number'\n  ) {\n    return false;\n  }\n\n  // Check ship structure\n  if (\n    !state.ship ||\n    typeof state.ship.name !== 'string' ||\n    typeof state.ship.fuel !== 'number' ||\n    typeof state.ship.cargoCapacity !== 'number' ||\n    !Array.isArray(state.ship.cargo)\n  ) {\n    return false;\n  }\n\n  // Check ship personality fields (optional - will be initialized if missing)\n  if (state.ship.quirks !== undefined && !Array.isArray(state.ship.quirks)) {\n    return false;\n  }\n  if (\n    state.ship.upgrades !== undefined &&\n    !Array.isArray(state.ship.upgrades)\n  ) {\n    return false;\n  }\n  if (\n    state.ship.hiddenCargo !== undefined &&\n    !Array.isArray(state.ship.hiddenCargo)\n  ) {\n    return false;\n  }\n  if (\n    state.ship.hiddenCargoCapacity !== undefined &&\n    typeof state.ship.hiddenCargoCapacity !== 'number'\n  ) {\n    return false;\n  }\n\n  // Check ship condition fields (optional - will be initialized if missing)\n  if (state.ship.hull !== undefined && typeof state.ship.hull !== 'number') {\n    return false;\n  }\n  if (\n    state.ship.engine !== undefined &&\n    typeof state.ship.engine !== 'number'\n  ) {\n    return false;\n  }\n  if (\n    state.ship.lifeSupport !== undefined &&\n    typeof state.ship.lifeSupport !== 'number'\n  ) {\n    return false;\n  }\n\n  // Check cargo stacks\n  for (const stack of state.ship.cargo) {\n    if (!stack.good || typeof stack.qty !== 'number') {\n      return false;\n    }\n\n    // Accept both old and new field names for price\n    const hasPrice =\n      typeof stack.buyPrice === 'number' ||\n      typeof stack.purchasePrice === 'number';\n    if (!hasPrice) {\n      return false;\n    }\n\n    // Purchase metadata is optional - will be initialized if missing\n    // Accept both old and new field names\n    if (stack.buySystem !== undefined && typeof stack.buySystem !== 'number') {\n      return false;\n    }\n    if (\n      stack.purchaseSystem !== undefined &&\n      typeof stack.purchaseSystem !== 'number'\n    ) {\n      return false;\n    }\n    if (\n      stack.buySystemName !== undefined &&\n      typeof stack.buySystemName !== 'string'\n    ) {\n      return false;\n    }\n    if (stack.buyDate !== undefined && typeof stack.buyDate !== 'number') {\n      return false;\n    }\n    if (\n      stack.purchaseDay !== undefined &&\n      typeof stack.purchaseDay !== 'number'\n    ) {\n      return false;\n    }\n  }\n\n  // Check world structure\n  if (!state.world || !Array.isArray(state.world.visitedSystems)) {\n    return false;\n  }\n\n  // priceKnowledge and activeEvents are optional - will be initialized if missing\n  if (state.world.priceKnowledge !== undefined) {\n    if (typeof state.world.priceKnowledge !== 'object') {\n      return false;\n    }\n\n    // Validate each price knowledge entry\n    for (const systemId in state.world.priceKnowledge) {\n      const knowledge = state.world.priceKnowledge[systemId];\n      if (\n        !knowledge ||\n        typeof knowledge.lastVisit !== 'number' ||\n        typeof knowledge.prices !== 'object'\n      ) {\n        return false;\n      }\n    }\n  }\n\n  if (state.world.activeEvents !== undefined) {\n    if (!Array.isArray(state.world.activeEvents)) {\n      return false;\n    }\n  }\n\n  // Check meta structure\n  if (\n    !state.meta ||\n    typeof state.meta.version !== 'string' ||\n    typeof state.meta.timestamp !== 'number'\n  ) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Migrate save data from v1.0.0 to v2.1.0\n *\n * Adds Phase 2 features:\n * - Ship condition (hull, engine, lifeSupport)\n * - Cargo purchase metadata (purchaseSystem, purchaseDay)\n * - Price knowledge database\n * - Active events array\n * - Market conditions (deterministic economy)\n *\n * @param {Object} state - v1.0.0 state\n * @param {Array} systemData - Star system data for lookups\n * @param {boolean} isTestEnvironment - Whether running in test mode\n * @returns {Object} Migrated v2.1.0 state\n */\nexport function migrateFromV1ToV2(state, systemData, isTestEnvironment) {\n  if (!isTestEnvironment) {\n    console.log('Migrating save from v1.0.0 to v2.1.0');\n  }\n\n  // Add ship condition fields (default to maximum)\n  if (state.ship.hull === undefined) {\n    state.ship.hull = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n  if (state.ship.engine === undefined) {\n    state.ship.engine = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n  if (state.ship.lifeSupport === undefined) {\n    state.ship.lifeSupport = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n\n  // Add cargo purchase metadata and migrate field names\n  if (state.ship.cargo && Array.isArray(state.ship.cargo)) {\n    state.ship.cargo.forEach((cargoStack) => {\n      normalizeCargoStack(cargoStack, state.player.currentSystem, systemData);\n    });\n  }\n\n  // Add ship personality fields\n  if (!state.ship.quirks) {\n    state.ship.quirks = [];\n  }\n  if (!state.ship.upgrades) {\n    state.ship.upgrades = [];\n  }\n  if (!state.ship.hiddenCargo) {\n    state.ship.hiddenCargo = [];\n  }\n  if (state.ship.hiddenCargoCapacity === undefined) {\n    state.ship.hiddenCargoCapacity = 0;\n  }\n\n  // Validate quirk IDs and remove unknown ones\n  if (Array.isArray(state.ship.quirks)) {\n    state.ship.quirks = validateShipConfigIds(\n      state.ship.quirks,\n      SHIP_CONFIG.QUIRKS,\n      'quirk'\n    );\n  }\n\n  // Validate upgrade IDs and remove unknown ones\n  if (Array.isArray(state.ship.upgrades)) {\n    state.ship.upgrades = validateShipConfigIds(\n      state.ship.upgrades,\n      SHIP_CONFIG.UPGRADES,\n      'upgrade'\n    );\n  }\n\n  // Add price knowledge database\n  if (!state.world.priceKnowledge) {\n    state.world.priceKnowledge = {};\n\n    // Initialize with current system's prices\n    const currentSystemId = state.player.currentSystem;\n    const currentSystem = systemData.find((s) => s.id === currentSystemId);\n\n    if (!currentSystem) {\n      throw new Error(\n        `Migration failed: current system ID ${currentSystemId} not found in star data`\n      );\n    }\n\n    const currentDay = state.player.daysElapsed;\n    const marketConditions = {}; // No market conditions in v1.0.0\n    const currentPrices = {};\n\n    for (const goodType of COMMODITY_TYPES) {\n      currentPrices[goodType] = TradingSystem.calculatePrice(\n        goodType,\n        currentSystem,\n        currentDay,\n        [], // No events in v1.0.0\n        marketConditions\n      );\n    }\n\n    state.world.priceKnowledge[currentSystemId] = {\n      lastVisit: 0,\n      prices: currentPrices,\n    };\n  }\n\n  // Add active events array\n  if (!state.world.activeEvents) {\n    state.world.activeEvents = [];\n  }\n\n  // Add market conditions (deterministic economy)\n  if (!state.world.marketConditions) {\n    state.world.marketConditions = {};\n  }\n\n  // Update version\n  state.meta.version = GAME_VERSION;\n\n  if (!isTestEnvironment) {\n    console.log('Migration complete');\n  }\n\n  return state;\n}\n\n/**\n * Migrate save data from v2.0.0 to v2.1.0\n *\n * Adds deterministic economy features:\n * - Market conditions tracking for local supply/demand effects\n *\n * @param {Object} state - v2.0.0 state\n * @param {boolean} isTestEnvironment - Whether running in test mode\n * @returns {Object} Migrated v2.1.0 state\n */\nexport function migrateFromV2ToV2_1(state, isTestEnvironment) {\n  if (!isTestEnvironment) {\n    console.log('Migrating save from v2.0.0 to v2.1.0');\n  }\n\n  // Add market conditions (empty object for backward compatibility)\n  if (!state.world.marketConditions) {\n    state.world.marketConditions = {};\n  }\n\n  // Update version\n  state.meta.version = GAME_VERSION;\n\n  if (!isTestEnvironment) {\n    console.log('Migration complete');\n  }\n\n  return state;\n}\n\n/**\n * Add defaults for missing fields in loaded state\n *\n * Handles partial v2.0.0 saves that pass validation but lack some optional fields.\n * Normalizes field names from old versions and adds missing metadata.\n *\n * @param {Object} state - State to normalize\n * @param {Array} systemData - Star system data for lookups\n * @returns {Object} Normalized state\n */\nexport function addStateDefaults(state, systemData) {\n  // Add defaults for missing Phase 2 fields\n  if (state.ship.hull === undefined) {\n    state.ship.hull = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n  if (state.ship.engine === undefined) {\n    state.ship.engine = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n  if (state.ship.lifeSupport === undefined) {\n    state.ship.lifeSupport = SHIP_CONFIG.CONDITION_BOUNDS.MAX;\n  }\n\n  // Normalize cargo stacks\n  if (state.ship.cargo && Array.isArray(state.ship.cargo)) {\n    state.ship.cargo.forEach((cargoStack) => {\n      normalizeCargoStack(cargoStack, state.player.currentSystem, systemData);\n    });\n  }\n\n  // Add ship personality fields if missing\n  if (!state.ship.quirks) {\n    state.ship.quirks = [];\n  }\n  if (!state.ship.upgrades) {\n    state.ship.upgrades = [];\n  }\n  if (!state.ship.hiddenCargo) {\n    state.ship.hiddenCargo = [];\n  }\n  if (state.ship.hiddenCargoCapacity === undefined) {\n    state.ship.hiddenCargoCapacity = 0;\n  }\n\n  // Validate quirk IDs and remove unknown ones\n  if (Array.isArray(state.ship.quirks)) {\n    state.ship.quirks = validateShipConfigIds(\n      state.ship.quirks,\n      SHIP_CONFIG.QUIRKS,\n      'quirk'\n    );\n  }\n\n  // Validate upgrade IDs and remove unknown ones\n  if (Array.isArray(state.ship.upgrades)) {\n    state.ship.upgrades = validateShipConfigIds(\n      state.ship.upgrades,\n      SHIP_CONFIG.UPGRADES,\n      'upgrade'\n    );\n  }\n\n  // Validate cargo structure completeness\n  if (Array.isArray(state.ship.cargo)) {\n    validateAndRepairCargoStacks(\n      state.ship.cargo,\n      state.player.currentSystem,\n      systemData,\n      'Cargo'\n    );\n  }\n\n  // Validate hidden cargo structure completeness\n  if (Array.isArray(state.ship.hiddenCargo)) {\n    validateAndRepairCargoStacks(\n      state.ship.hiddenCargo,\n      state.player.currentSystem,\n      systemData,\n      'Hidden cargo'\n    );\n  }\n\n  // Initialize price knowledge if missing\n  if (!state.world.priceKnowledge) {\n    state.world.priceKnowledge = {};\n\n    // Initialize with current system's prices\n    const currentSystemId = state.player.currentSystem;\n    const currentSystem = systemData.find((s) => s.id === currentSystemId);\n\n    if (!currentSystem) {\n      throw new Error(\n        `Load failed: current system ID ${currentSystemId} not found in star data`\n      );\n    }\n\n    const currentDay = state.player.daysElapsed;\n    const marketConditions = {}; // No market conditions if missing\n    const currentPrices = {};\n\n    for (const goodType of COMMODITY_TYPES) {\n      currentPrices[goodType] = TradingSystem.calculatePrice(\n        goodType,\n        currentSystem,\n        currentDay,\n        [], // No events if missing\n        marketConditions\n      );\n    }\n\n    state.world.priceKnowledge[currentSystemId] = {\n      lastVisit: 0,\n      prices: currentPrices,\n    };\n  }\n\n  // Initialize active events if missing\n  if (!state.world.activeEvents) {\n    state.world.activeEvents = [];\n  }\n\n  // Initialize market conditions if missing\n  if (!state.world.marketConditions) {\n    state.world.marketConditions = {};\n  }\n\n  return state;\n}\n","import {\n  COMMODITY_TYPES,\n  FUEL_PRICING_CONFIG,\n  NAVIGATION_CONFIG,\n  REPAIR_CONFIG,\n  SHIP_CONFIG,\n  calculateDistanceFromSol,\n  SOL_SYSTEM_ID,\n  GAME_VERSION,\n  NEW_GAME_DEFAULTS,\n  ECONOMY_CONFIG,\n} from '../constants.js';\nimport { TradingSystem } from '../game-trading.js';\nimport { EconomicEventsSystem } from '../game-events.js';\nimport { InformationBroker } from '../game-information-broker.js';\nimport {\n  saveGame as saveGameToStorage,\n  loadGame as loadGameFromStorage,\n  hasSavedGame as checkSavedGame,\n  clearSave as clearSaveFromStorage,\n} from './save-load.js';\nimport {\n  isVersionCompatible,\n  validateStateStructure,\n  migrateFromV1ToV2,\n  migrateFromV2ToV2_1,\n  addStateDefaults,\n} from './state-validators.js';\n\n/**\n * Sanitize ship name input\n *\n * Removes HTML tags, trims whitespace, and limits length to prevent display issues.\n * Returns default ship name if input is empty after sanitization.\n *\n * Feature: ship-personality, Property 10: Ship Name Sanitization\n * Validates: Requirements 4.2, 4.3, 10.3, 10.5\n *\n * @param {string} name - User input for ship name\n * @returns {string} Sanitized name or default\n */\nexport function sanitizeShipName(name) {\n  if (!name || name.trim().length === 0) {\n    return SHIP_CONFIG.DEFAULT_NAME;\n  }\n\n  // Remove HTML tags, limit length, then trim (order matters for edge cases)\n  const sanitized = name\n    .replace(/<[^>]*>/g, '')\n    .substring(0, 50)\n    .trim();\n\n  return sanitized || SHIP_CONFIG.DEFAULT_NAME;\n}\n\n/**\n * GameStateManager - Manages all game state with event-driven reactivity\n *\n * Responsibilities:\n * - Initialize new game with default values\n * - Maintain single source of truth for game state\n * - Provide state query methods\n * - Emit events on state mutations for UI reactivity\n * - Support multiple subscribers per event type\n */\nexport class GameStateManager {\n  constructor(starData, wormholeData, navigationSystem = null) {\n    this.starData = starData;\n    this.wormholeData = wormholeData;\n    this.navigationSystem = navigationSystem;\n\n    // Check once during initialization to suppress console noise during test runs\n    this.isTestEnvironment =\n      typeof process !== 'undefined' && process.env?.NODE_ENV === 'test';\n\n    // Supports multiple UI components subscribing to same state changes\n    this.subscribers = {\n      creditsChanged: [],\n      debtChanged: [],\n      fuelChanged: [],\n      cargoChanged: [],\n      locationChanged: [],\n      timeChanged: [],\n      priceKnowledgeChanged: [],\n      activeEventsChanged: [],\n      shipConditionChanged: [],\n      conditionWarning: [],\n      shipNameChanged: [],\n    };\n\n    // Initialize with null state (will be set by initNewGame or loadGame)\n    this.state = null;\n\n    // Track last save time for debouncing\n    this.lastSaveTime = 0;\n  }\n\n  /**\n   * Assigns 2-3 random quirks to a new ship\n   *\n   * Quirks are permanent personality traits that provide both benefits and drawbacks.\n   * Each ship receives a random number of quirks (50% chance for 2, 50% chance for 3).\n   * No duplicate quirks are assigned.\n   *\n   * Feature: ship-personality, Property 1: Quirk Assignment Bounds\n   * Validates: Requirements 1.1, 1.2\n   *\n   * @param {Function} rng - Random number generator (0-1), defaults to Math.random\n   * @returns {string[]} Array of quirk IDs\n   */\n  assignShipQuirks(rng = Math.random) {\n    const quirkIds = Object.keys(SHIP_CONFIG.QUIRKS);\n    const count = rng() < 0.5 ? 2 : 3;\n    const assigned = new Set();\n\n    while (assigned.size < count) {\n      const randomId = quirkIds[Math.floor(rng() * quirkIds.length)];\n      assigned.add(randomId);\n    }\n\n    return Array.from(assigned);\n  }\n\n  /**\n   * Apply quirk modifiers to a base value\n   *\n   * Iterates through all quirks and applies relevant modifiers multiplicatively.\n   * Quirks that don't affect the specified attribute are ignored.\n   *\n   * Example: If two quirks both affect fuelConsumption with modifiers 0.85 and 1.05,\n   * the result is baseValue × 0.85 × 1.05 = baseValue × 0.8925\n   *\n   * Feature: ship-personality, Property 2: Quirk Effect Application\n   * Validates: Requirements 1.4, 6.1, 6.2, 6.3, 6.4, 6.5\n   *\n   * @param {number} baseValue - Starting value before modifiers\n   * @param {string} attribute - Attribute name (e.g., 'fuelConsumption', 'hullDegradation')\n   * @param {string[]} quirks - Array of quirk IDs\n   * @returns {number} Modified value after applying all relevant quirk modifiers\n   */\n  applyQuirkModifiers(baseValue, attribute, quirks) {\n    let modified = baseValue;\n\n    for (const quirkId of quirks) {\n      const quirk = SHIP_CONFIG.QUIRKS[quirkId];\n\n      // If quirk doesn't exist, this is a critical bug - fail loudly\n      if (!quirk) {\n        throw new Error(\n          `Invalid quirk ID: ${quirkId} not found in SHIP_CONFIG.QUIRKS`\n        );\n      }\n\n      // Only apply modifier if this quirk affects the specified attribute\n      if (quirk.effects[attribute]) {\n        modified *= quirk.effects[attribute];\n      }\n    }\n\n    return modified;\n  }\n\n  /**\n   * Get quirk definition by ID\n   *\n   * Returns the quirk definition object from SHIP_CONFIG.QUIRKS constant.\n   * Used by UI to display quirk information.\n   *\n   * @param {string} quirkId - Quirk identifier\n   * @returns {Object|null} Quirk definition or null if not found\n   */\n  getQuirkDefinition(quirkId) {\n    return SHIP_CONFIG.QUIRKS[quirkId] || null;\n  }\n\n  /**\n   * Initialize a new game with default values\n   */\n  initNewGame() {\n    // Get Sol's grain price for initial cargo using dynamic pricing\n    const solSystem = this.starData.find((s) => s.id === SOL_SYSTEM_ID);\n    const currentDay = 0; // Game starts at day 0\n    const activeEvents = []; // No events at game start\n    const marketConditions = {}; // No market conditions at game start\n    const solGrainPrice = TradingSystem.calculatePrice(\n      'grain',\n      solSystem,\n      currentDay,\n      activeEvents,\n      marketConditions\n    );\n\n    // Calculate all Sol prices for price knowledge initialization\n    const solPrices = {};\n    for (const goodType of COMMODITY_TYPES) {\n      solPrices[goodType] = TradingSystem.calculatePrice(\n        goodType,\n        solSystem,\n        currentDay,\n        activeEvents,\n        marketConditions\n      );\n    }\n\n    // Assign random quirks to the ship\n    const shipQuirks = this.assignShipQuirks();\n\n    this.state = {\n      player: {\n        credits: NEW_GAME_DEFAULTS.STARTING_CREDITS,\n        debt: NEW_GAME_DEFAULTS.STARTING_DEBT,\n        currentSystem: SOL_SYSTEM_ID,\n        daysElapsed: 0,\n      },\n      ship: {\n        name: NEW_GAME_DEFAULTS.STARTING_SHIP_NAME,\n        quirks: shipQuirks,\n        upgrades: [],\n        fuel: SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        hull: SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        engine: SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        lifeSupport: SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        cargoCapacity: NEW_GAME_DEFAULTS.STARTING_CARGO_CAPACITY,\n        cargo: [\n          {\n            good: 'grain',\n            qty: NEW_GAME_DEFAULTS.STARTING_GRAIN_QUANTITY,\n            buyPrice: solGrainPrice,\n            buySystem: SOL_SYSTEM_ID,\n            buySystemName: 'Sol',\n            buyDate: 0,\n          },\n        ],\n        hiddenCargo: [],\n        hiddenCargoCapacity: 0,\n      },\n      world: {\n        visitedSystems: [SOL_SYSTEM_ID],\n        priceKnowledge: {\n          [SOL_SYSTEM_ID]: {\n            lastVisit: 0,\n            prices: solPrices,\n          },\n        },\n        activeEvents: [],\n        marketConditions: {},\n      },\n      meta: {\n        version: GAME_VERSION,\n        timestamp: Date.now(),\n      },\n    };\n\n    if (!this.isTestEnvironment) {\n      console.log('New game initialized:', this.state);\n    }\n\n    // Emit all initial state events\n    this.emit('creditsChanged', this.state.player.credits);\n    this.emit('debtChanged', this.state.player.debt);\n    this.emit('fuelChanged', this.state.ship.fuel);\n    this.emit('cargoChanged', this.state.ship.cargo);\n    this.emit('locationChanged', this.state.player.currentSystem);\n    this.emit('timeChanged', this.state.player.daysElapsed);\n    this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n    this.emit('shipConditionChanged', {\n      hull: this.state.ship.hull,\n      engine: this.state.ship.engine,\n      lifeSupport: this.state.ship.lifeSupport,\n    });\n\n    return this.state;\n  }\n\n  // ========================================================================\n  // EVENT SYSTEM\n  // ========================================================================\n\n  /**\n   * Subscribe to state change events\n   * @param {string} eventType - One of: creditsChanged, debtChanged, fuelChanged, cargoChanged, locationChanged, timeChanged, shipConditionChanged, conditionWarning\n   * @param {function} callback - Function to call when event occurs\n   */\n  subscribe(eventType, callback) {\n    if (!this.subscribers[eventType]) {\n      console.warn(`Unknown event type: ${eventType}`);\n      return;\n    }\n\n    this.subscribers[eventType].push(callback);\n    if (!this.isTestEnvironment) {\n      console.log(\n        `Subscribed to ${eventType}, total subscribers: ${this.subscribers[eventType].length}`\n      );\n    }\n  }\n\n  unsubscribe(eventType, callback) {\n    if (!this.subscribers[eventType]) {\n      return;\n    }\n\n    const index = this.subscribers[eventType].indexOf(callback);\n    if (index > -1) {\n      this.subscribers[eventType].splice(index, 1);\n    }\n  }\n\n  emit(eventType, data) {\n    if (!this.subscribers[eventType]) {\n      return;\n    }\n\n    this.subscribers[eventType].forEach((callback) => {\n      try {\n        callback(data);\n      } catch (error) {\n        console.error(`Error in ${eventType} subscriber:`, error);\n      }\n    });\n  }\n\n  // ========================================================================\n  // STATE QUERIES\n  // ========================================================================\n\n  getState() {\n    return this.state;\n  }\n\n  getPlayer() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getPlayer called before game initialization'\n      );\n    }\n    return this.state.player;\n  }\n\n  getShip() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getShip called before game initialization'\n      );\n    }\n    return this.state.ship;\n  }\n\n  getCurrentSystem() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getCurrentSystem called before game initialization'\n      );\n    }\n\n    const systemId = this.state.player.currentSystem;\n    const system = this.starData.find((s) => s.id === systemId);\n\n    if (!system) {\n      throw new Error(\n        `Invalid game state: current system ID ${systemId} not found in star data`\n      );\n    }\n\n    return system;\n  }\n\n  getCargoUsed() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getCargoUsed called before game initialization'\n      );\n    }\n    return this.state.ship.cargo.reduce((total, stack) => total + stack.qty, 0);\n  }\n\n  getCargoRemaining() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getCargoRemaining called before game initialization'\n      );\n    }\n    return this.state.ship.cargoCapacity - this.getCargoUsed();\n  }\n\n  /**\n   * Get current fuel capacity based on installed upgrades\n   *\n   * Fuel capacity is calculated on-demand rather than stored in state\n   * because it's derived from upgrades. Base capacity is 100, Extended\n   * Fuel Tank upgrade increases it to 150.\n   *\n   * @returns {number} Maximum fuel capacity in percentage points\n   */\n  getFuelCapacity() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getFuelCapacity called before game initialization'\n      );\n    }\n\n    const capabilities = this.calculateShipCapabilities();\n    return capabilities.fuelCapacity;\n  }\n\n  isSystemVisited(systemId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: isSystemVisited called before game initialization'\n      );\n    }\n    return this.state.world.visitedSystems.includes(systemId);\n  }\n\n  /**\n   * Get ship condition values\n   * @returns {Object} { hull, engine, lifeSupport }\n   */\n  getShipCondition() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getShipCondition called before game initialization'\n      );\n    }\n\n    return {\n      hull: this.state.ship.hull,\n      engine: this.state.ship.engine,\n      lifeSupport: this.state.ship.lifeSupport,\n    };\n  }\n\n  /**\n   * Check ship condition and return warnings for systems below thresholds\n   *\n   * Evaluates current ship condition against warning thresholds and returns\n   * an array of warning objects for systems that need attention.\n   *\n   * @returns {Array} Array of warning objects: { system: string, message: string, severity: string }\n   */\n  checkConditionWarnings() {\n    const condition = this.getShipCondition();\n    if (!condition) return [];\n\n    const warnings = [];\n\n    // Hull integrity affects cargo safety during jumps\n    if (condition.hull < SHIP_CONFIG.CONDITION_WARNING_THRESHOLDS.HULL) {\n      warnings.push({\n        system: 'hull',\n        message: 'Risk of cargo loss during jumps',\n        severity: 'warning',\n      });\n    }\n\n    // Engine degradation increases fuel consumption and travel time\n    if (condition.engine < SHIP_CONFIG.CONDITION_WARNING_THRESHOLDS.ENGINE) {\n      warnings.push({\n        system: 'engine',\n        message: 'Jump failure risk - immediate repairs recommended',\n        severity: 'warning',\n      });\n    }\n\n    // Life support failure is catastrophic\n    if (\n      condition.lifeSupport <\n      SHIP_CONFIG.CONDITION_WARNING_THRESHOLDS.LIFE_SUPPORT\n    ) {\n      warnings.push({\n        system: 'lifeSupport',\n        message: 'Critical condition - urgent repairs required',\n        severity: 'critical',\n      });\n    }\n\n    return warnings;\n  }\n\n  /**\n   * Get price knowledge database\n   */\n  getPriceKnowledge() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getPriceKnowledge called before game initialization'\n      );\n    }\n    return this.state.world.priceKnowledge || {};\n  }\n\n  /**\n   * Get known prices for a specific system\n   */\n  getKnownPrices(systemId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getKnownPrices called before game initialization'\n      );\n    }\n    if (!this.state.world.priceKnowledge) {\n      throw new Error('Invalid state: priceKnowledge missing from world state');\n    }\n    return this.state.world.priceKnowledge[systemId]?.prices || null;\n  }\n\n  /**\n   * Check if player has price knowledge for a system\n   */\n  hasVisitedSystem(systemId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: hasVisitedSystem called before game initialization'\n      );\n    }\n    if (!this.state.world.priceKnowledge) {\n      throw new Error('Invalid state: priceKnowledge missing from world state');\n    }\n    return this.state.world.priceKnowledge[systemId] !== undefined;\n  }\n\n  // ========================================================================\n  // STATE MUTATIONS\n  // ========================================================================\n\n  updateCredits(newCredits) {\n    this.state.player.credits = newCredits;\n    this.emit('creditsChanged', newCredits);\n  }\n\n  updateDebt(newDebt) {\n    this.state.player.debt = newDebt;\n    this.emit('debtChanged', newDebt);\n  }\n\n  updateFuel(newFuel) {\n    const maxFuel = this.getFuelCapacity();\n\n    if (newFuel < SHIP_CONFIG.CONDITION_BOUNDS.MIN || newFuel > maxFuel) {\n      throw new Error(\n        `Invalid fuel value: ${newFuel}. Fuel must be between ${SHIP_CONFIG.CONDITION_BOUNDS.MIN} and ${maxFuel}.`\n      );\n    }\n\n    this.state.ship.fuel = newFuel;\n    this.emit('fuelChanged', newFuel);\n  }\n\n  updateCargo(newCargo) {\n    this.state.ship.cargo = newCargo;\n    this.emit('cargoChanged', newCargo);\n  }\n\n  updateLocation(newSystemId) {\n    this.state.player.currentSystem = newSystemId;\n\n    // Track exploration progress for future features (price discovery, missions)\n    if (!this.state.world.visitedSystems.includes(newSystemId)) {\n      this.state.world.visitedSystems.push(newSystemId);\n    }\n\n    this.emit('locationChanged', newSystemId);\n  }\n\n  /**\n   * Set credits directly (dev mode only)\n   * @param {number} amount - New credit amount\n   */\n  setCredits(amount) {\n    this.updateCredits(amount);\n  }\n\n  /**\n   * Set debt directly (dev mode only)\n   * @param {number} amount - New debt amount\n   */\n  setDebt(amount) {\n    this.updateDebt(amount);\n  }\n\n  /**\n   * Set fuel directly (dev mode only)\n   * @param {number} amount - New fuel percentage (0-100)\n   */\n  setFuel(amount) {\n    this.updateFuel(amount);\n  }\n\n  updateTime(newDays) {\n    const oldDays = this.state.player.daysElapsed;\n    this.state.player.daysElapsed = newDays;\n\n    // When days advance, update price knowledge and events\n    if (newDays > oldDays) {\n      const daysPassed = newDays - oldDays;\n\n      // Increment staleness for all systems\n      this.incrementPriceKnowledgeStaleness(daysPassed);\n\n      // Clean up old intelligence data\n      InformationBroker.cleanupOldIntelligence(this.state.world.priceKnowledge);\n\n      // Apply market recovery (decay surplus/deficit over time)\n      this.applyMarketRecovery(daysPassed);\n\n      // Update economic events (trigger new events, remove expired ones)\n      this.state.world.activeEvents = EconomicEventsSystem.updateEvents(\n        this.state,\n        this.starData\n      );\n\n      // Recalculate prices with new day number (for daily fluctuations)\n      this.recalculatePricesForKnownSystems();\n\n      // Emit event changes\n      this.emit('activeEventsChanged', this.state.world.activeEvents);\n    }\n\n    this.emit('timeChanged', newDays);\n  }\n\n  /**\n   * Update ship name\n   *\n   * @param {string} newName - New ship name (will be sanitized)\n   */\n  updateShipName(newName) {\n    const sanitized = sanitizeShipName(newName);\n    this.state.ship.name = sanitized;\n    this.emit('shipNameChanged', sanitized);\n  }\n\n  /**\n   * Update ship condition values\n   *\n   * All values are clamped to valid range to prevent invalid states.\n   * Checks for condition warnings and emits them if thresholds are crossed.\n   *\n   * @param {number} hull - Hull integrity percentage\n   * @param {number} engine - Engine condition percentage\n   * @param {number} lifeSupport - Life support condition percentage\n   */\n  updateShipCondition(hull, engine, lifeSupport) {\n    // Clamp all values to valid range\n    this.state.ship.hull = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(SHIP_CONFIG.CONDITION_BOUNDS.MAX, hull)\n    );\n    this.state.ship.engine = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(SHIP_CONFIG.CONDITION_BOUNDS.MAX, engine)\n    );\n    this.state.ship.lifeSupport = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(SHIP_CONFIG.CONDITION_BOUNDS.MAX, lifeSupport)\n    );\n\n    this.emit('shipConditionChanged', {\n      hull: this.state.ship.hull,\n      engine: this.state.ship.engine,\n      lifeSupport: this.state.ship.lifeSupport,\n    });\n\n    // Check for warnings and emit them\n    const warnings = this.checkConditionWarnings();\n    if (warnings.length > 0) {\n      warnings.forEach((warning) => {\n        this.emit('conditionWarning', warning);\n      });\n    }\n  }\n\n  /**\n   * Update market conditions for a system and commodity\n   *\n   * Tracks player trading activity to create local supply/demand effects.\n   * Positive quantityDelta = surplus (player sold), negative = deficit (player bought).\n   *\n   * Uses sparse storage: system and commodity entries are created on-demand during first trade.\n   * This keeps save files small by only tracking systems/commodities with active trading history.\n   *\n   * Feature: deterministic-economy, Requirements 4.1, 4.2, 9.2\n   *\n   * @param {number} systemId - System ID\n   * @param {string} goodType - Commodity type\n   * @param {number} quantityDelta - Quantity change (positive for sell, negative for buy)\n   */\n  updateMarketConditions(systemId, goodType, quantityDelta) {\n    if (!this.state.world.marketConditions) {\n      this.state.world.marketConditions = {};\n    }\n\n    // Create system entry if first trade at that system\n    if (!this.state.world.marketConditions[systemId]) {\n      this.state.world.marketConditions[systemId] = {};\n    }\n\n    // Create commodity entry if first trade of that commodity\n    if (this.state.world.marketConditions[systemId][goodType] === undefined) {\n      this.state.world.marketConditions[systemId][goodType] = 0;\n    }\n\n    // Add quantityDelta to existing value\n    this.state.world.marketConditions[systemId][goodType] += quantityDelta;\n  }\n\n  /**\n   * Apply market recovery to all market conditions\n   *\n   * Markets naturally recover toward equilibrium over time. Each day, surplus and deficit\n   * values decay by 10% (multiply by 0.90). Insignificant values (abs < 1.0) are pruned\n   * to keep save files small.\n   *\n   * Feature: deterministic-economy, Requirements 5.1, 5.2, 5.3, 5.4, 5.5\n   *\n   * @param {number} daysPassed - Number of days elapsed\n   */\n  applyMarketRecovery(daysPassed) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: applyMarketRecovery called before game initialization'\n      );\n    }\n\n    if (!this.state.world.marketConditions) {\n      throw new Error(\n        'Invalid state: marketConditions missing from world state'\n      );\n    }\n\n    const recoveryFactor = Math.pow(\n      ECONOMY_CONFIG.DAILY_RECOVERY_FACTOR,\n      daysPassed\n    );\n\n    // Iterate over all systems\n    for (const systemId in this.state.world.marketConditions) {\n      const systemConditions = this.state.world.marketConditions[systemId];\n\n      // Iterate over all commodities in this system\n      for (const goodType in systemConditions) {\n        // Apply exponential decay\n        systemConditions[goodType] *= recoveryFactor;\n\n        // Prune insignificant entries\n        if (\n          Math.abs(systemConditions[goodType]) <\n          ECONOMY_CONFIG.MARKET_CONDITION_PRUNE_THRESHOLD\n        ) {\n          delete systemConditions[goodType];\n        }\n      }\n\n      // Remove empty system entries\n      if (Object.keys(systemConditions).length === 0) {\n        delete this.state.world.marketConditions[systemId];\n      }\n    }\n  }\n\n  /**\n   * Update price knowledge for a system\n   *\n   * @param {number} systemId - System ID\n   * @param {Object} prices - Price object with all commodity prices\n   * @param {number} lastVisit - Days since last visit (0 = current)\n   */\n  updatePriceKnowledge(systemId, prices, lastVisit = 0) {\n    if (!this.state.world.priceKnowledge) {\n      this.state.world.priceKnowledge = {};\n    }\n\n    this.state.world.priceKnowledge[systemId] = {\n      lastVisit: lastVisit,\n      prices: { ...prices },\n    };\n\n    this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n  }\n\n  /**\n   * Increment lastVisit counter for all systems in price knowledge\n   *\n   * Called automatically when time advances\n   *\n   * @param {number} days - Number of days to increment (default 1)\n   */\n  incrementPriceKnowledgeStaleness(days = 1) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: incrementPriceKnowledgeStaleness called before game initialization'\n      );\n    }\n    if (!this.state.world.priceKnowledge) {\n      throw new Error('Invalid state: priceKnowledge missing from world state');\n    }\n\n    for (const systemId in this.state.world.priceKnowledge) {\n      this.state.world.priceKnowledge[systemId].lastVisit += days;\n    }\n\n    this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n  }\n\n  /**\n   * Recalculate prices for all systems in price knowledge with current day's fluctuations\n   *\n   * Called automatically when day advances to update all known prices with new daily\n   * fluctuations and active event modifiers.\n   */\n  recalculatePricesForKnownSystems() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: recalculatePricesForKnownSystems called before game initialization'\n      );\n    }\n    if (!this.state.world.priceKnowledge) return;\n\n    const currentDay = this.state.player.daysElapsed;\n    const activeEvents = this.state.world.activeEvents;\n    if (!activeEvents) {\n      throw new Error('Invalid state: activeEvents missing from world state');\n    }\n    const marketConditions = this.state.world.marketConditions;\n    if (!marketConditions) {\n      throw new Error(\n        'Invalid state: marketConditions missing from world state'\n      );\n    }\n\n    // Recalculate prices for each system in price knowledge\n    for (const systemIdStr in this.state.world.priceKnowledge) {\n      const systemId = parseInt(systemIdStr);\n      const system = this.starData.find((s) => s.id === systemId);\n\n      if (system) {\n        const newPrices = {};\n\n        // Calculate new prices for all commodities\n        for (const goodType of COMMODITY_TYPES) {\n          newPrices[goodType] = TradingSystem.calculatePrice(\n            goodType,\n            system,\n            currentDay,\n            activeEvents,\n            marketConditions\n          );\n        }\n\n        // Update prices while preserving lastVisit\n        this.state.world.priceKnowledge[systemId].prices = newPrices;\n      }\n    }\n\n    this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n  }\n\n  // ========================================================================\n  // ECONOMIC EVENTS SYSTEM\n  // ========================================================================\n\n  /**\n   * Get active events array\n   */\n  getActiveEvents() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: getActiveEvents called before game initialization'\n      );\n    }\n    return this.state.world.activeEvents || [];\n  }\n\n  /**\n   * Update active events (typically called on day change)\n   *\n   * This method should be called by external event system logic\n   *\n   * @param {Array} newEvents - Updated events array\n   */\n  updateActiveEvents(newEvents) {\n    if (!this.state.world.activeEvents) {\n      this.state.world.activeEvents = [];\n    }\n\n    this.state.world.activeEvents = newEvents;\n    this.emit('activeEventsChanged', newEvents);\n  }\n\n  /**\n   * Get active event for a specific system\n   *\n   * @param {number} systemId - System identifier\n   * @returns {Object|null} Active event or null\n   */\n  getActiveEventForSystem(systemId) {\n    const activeEvents = this.getActiveEvents();\n    return activeEvents.find((event) => event.systemId === systemId) || null;\n  }\n\n  /**\n   * Get event type definition by event type key\n   * @param {string} eventTypeKey - Event type identifier\n   * @returns {Object|null} Event type definition or null\n   */\n  getEventType(eventTypeKey) {\n    return EconomicEventsSystem.EVENT_TYPES[eventTypeKey] || null;\n  }\n\n  // ========================================================================\n  // INFORMATION BROKER SYSTEM\n  // ========================================================================\n\n  /**\n   * Get intelligence cost for a system\n   *\n   * @param {number} systemId - Target system ID\n   * @returns {number} Cost in credits\n   */\n  getIntelligenceCost(systemId) {\n    const priceKnowledge = this.getPriceKnowledge();\n    return InformationBroker.getIntelligenceCost(systemId, priceKnowledge);\n  }\n\n  /**\n   * Purchase market intelligence for a system\n   *\n   * @param {number} systemId - Target system ID\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  purchaseIntelligence(systemId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: purchaseIntelligence called before game initialization'\n      );\n    }\n\n    const result = InformationBroker.purchaseIntelligence(\n      this.state,\n      systemId,\n      this.starData\n    );\n\n    if (result.success) {\n      // Emit state change events\n      this.emit('creditsChanged', this.state.player.credits);\n      this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n\n      // Persist immediately - intelligence purchase modifies credits and price knowledge\n      this.saveGame();\n    }\n\n    return result;\n  }\n\n  /**\n   * Generate a market rumor\n   *\n   * @returns {string} Rumor text\n   */\n  generateRumor() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: generateRumor called before game initialization'\n      );\n    }\n\n    return InformationBroker.generateRumor(this.state, this.starData);\n  }\n\n  /**\n   * Get list of systems connected to current system with intelligence costs\n   *\n   * When Advanced Sensor Array upgrade is installed, includes active economic\n   * events for connected systems.\n   *\n   * @returns {Array} Array of { systemId, systemName, cost, lastVisit, event? }\n   */\n  listAvailableIntelligence() {\n    const priceKnowledge = this.getPriceKnowledge();\n    const currentSystemId = this.state.player.currentSystem;\n    const activeEvents = this.getActiveEvents();\n    const hasAdvancedSensors =\n      this.state.ship.upgrades.includes('advanced_sensors');\n\n    return InformationBroker.listAvailableIntelligence(\n      priceKnowledge,\n      this.starData,\n      currentSystemId,\n      this.navigationSystem,\n      activeEvents,\n      hasAdvancedSensors\n    );\n  }\n\n  // ========================================================================\n  // TRADING OPERATIONS\n  // ========================================================================\n\n  /**\n   * Execute a purchase transaction\n   */\n  buyGood(goodType, quantity, price) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: buyGood called before game initialization'\n      );\n    }\n\n    const credits = this.state.player.credits;\n    const cargoSpace = this.getCargoRemaining();\n    const totalCost = quantity * price;\n\n    // Validate purchase constraints\n    if (totalCost > credits) {\n      return { success: false, reason: 'Insufficient credits' };\n    }\n\n    if (quantity > cargoSpace) {\n      return { success: false, reason: 'Not enough cargo space' };\n    }\n\n    this.updateCredits(credits - totalCost);\n\n    // Pass current system and day for purchase metadata\n    const currentSystemId = this.state.player.currentSystem;\n    const currentSystem = this.getCurrentSystem();\n    const currentSystemName = currentSystem.name;\n    const currentDay = this.state.player.daysElapsed;\n\n    const newCargo = TradingSystem.recordCargoPurchase(\n      this.state.ship.cargo,\n      goodType,\n      quantity,\n      price,\n      currentSystemId,\n      currentSystemName,\n      currentDay\n    );\n    this.updateCargo(newCargo);\n\n    // Update market conditions: negative quantity creates deficit (raises prices)\n    // Feature: deterministic-economy, Requirements 4.1, 4.2\n    this.updateMarketConditions(currentSystemId, goodType, -quantity);\n\n    // Persist immediately - trade transactions modify credits and cargo\n    this.saveGame();\n\n    return { success: true };\n  }\n\n  /**\n   * Execute a sale transaction from a specific cargo stack\n   */\n  sellGood(stackIndex, quantity, salePrice) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: sellGood called before game initialization'\n      );\n    }\n\n    const cargo = this.state.ship.cargo;\n\n    // Validate sale constraints\n    if (stackIndex < 0 || stackIndex >= cargo.length) {\n      return { success: false, reason: 'Invalid cargo stack' };\n    }\n\n    const stack = cargo[stackIndex];\n\n    if (quantity <= 0) {\n      return { success: false, reason: 'Quantity must be positive' };\n    }\n\n    if (quantity > stack.qty) {\n      return { success: false, reason: 'Not enough quantity in stack' };\n    }\n    const totalRevenue = quantity * salePrice;\n    const profitMargin = salePrice - stack.buyPrice;\n\n    this.updateCredits(this.state.player.credits + totalRevenue);\n\n    // Remove quantity from stack; remove stack if empty\n    stack.qty -= quantity;\n    if (stack.qty <= 0) {\n      cargo.splice(stackIndex, 1);\n    }\n    this.updateCargo(cargo);\n\n    // Update market conditions: positive quantity creates surplus (lowers prices)\n    // Feature: deterministic-economy, Requirements 4.1, 4.2\n    const currentSystemId = this.state.player.currentSystem;\n    this.updateMarketConditions(currentSystemId, stack.good, quantity);\n\n    // Persist immediately - trade transactions modify credits and cargo\n    this.saveGame();\n\n    return {\n      success: true,\n      profitMargin: profitMargin,\n    };\n  }\n\n  // ========================================================================\n  // REFUEL SYSTEM\n  // ========================================================================\n\n  /**\n   * Calculate fuel price based on system distance from Sol\n   *\n   * @param {number} systemId - System ID to check\n   * @returns {number} Fuel price per percentage point\n   */\n  getFuelPrice(systemId) {\n    if (FUEL_PRICING_CONFIG.CORE_SYSTEMS.IDS.includes(systemId)) {\n      return FUEL_PRICING_CONFIG.CORE_SYSTEMS.PRICE_PER_PERCENT;\n    }\n\n    const system = this.starData.find((s) => s.id === systemId);\n    if (!system) {\n      return FUEL_PRICING_CONFIG.INNER_SYSTEMS.PRICE_PER_PERCENT;\n    }\n\n    const distanceFromSol = calculateDistanceFromSol(system);\n\n    if (\n      distanceFromSol < FUEL_PRICING_CONFIG.INNER_SYSTEMS.DISTANCE_THRESHOLD\n    ) {\n      return FUEL_PRICING_CONFIG.INNER_SYSTEMS.PRICE_PER_PERCENT;\n    }\n\n    if (\n      distanceFromSol < FUEL_PRICING_CONFIG.MID_RANGE_SYSTEMS.DISTANCE_THRESHOLD\n    ) {\n      return FUEL_PRICING_CONFIG.MID_RANGE_SYSTEMS.PRICE_PER_PERCENT;\n    }\n\n    return FUEL_PRICING_CONFIG.OUTER_SYSTEMS.PRICE_PER_PERCENT;\n  }\n\n  /**\n   * Validate refuel transaction\n   *\n   * @param {number} currentFuel - Current fuel percentage\n   * @param {number} amount - Amount to refuel (percentage points)\n   * @param {number} credits - Player's current credits\n   * @param {number} pricePerPercent - Fuel price per percentage point\n   * @returns {Object} { valid: boolean, reason: string, cost: number }\n   */\n  validateRefuel(currentFuel, amount, credits, pricePerPercent) {\n    const totalCost = amount * pricePerPercent;\n    const maxFuel = this.getFuelCapacity();\n\n    if (amount <= 0) {\n      return {\n        valid: false,\n        reason: 'Refuel amount must be positive',\n        cost: totalCost,\n      };\n    }\n\n    // Use epsilon for floating point comparison\n    if (\n      currentFuel + amount >\n      maxFuel + NAVIGATION_CONFIG.FUEL_CAPACITY_EPSILON\n    ) {\n      return {\n        valid: false,\n        reason: `Cannot refuel beyond ${maxFuel}% capacity`,\n        cost: totalCost,\n      };\n    }\n\n    if (totalCost > credits) {\n      return {\n        valid: false,\n        reason: 'Insufficient credits for refuel',\n        cost: totalCost,\n      };\n    }\n\n    return {\n      valid: true,\n      reason: null,\n      cost: totalCost,\n    };\n  }\n\n  /**\n   * Execute refuel transaction\n   *\n   * @param {number} amount - Amount to refuel (percentage points)\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  refuel(amount) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: refuel called before game initialization'\n      );\n    }\n\n    const currentFuel = this.state.ship.fuel;\n    const credits = this.state.player.credits;\n    const systemId = this.state.player.currentSystem;\n    const pricePerPercent = this.getFuelPrice(systemId);\n\n    const validation = this.validateRefuel(\n      currentFuel,\n      amount,\n      credits,\n      pricePerPercent\n    );\n\n    if (!validation.valid) {\n      return { success: false, reason: validation.reason };\n    }\n\n    this.updateCredits(credits - validation.cost);\n    this.updateFuel(currentFuel + amount);\n\n    // Persist immediately - refuel modifies credits and fuel\n    this.saveGame();\n\n    return { success: true, reason: null };\n  }\n\n  // ========================================================================\n  // SHIP REPAIR SYSTEM\n  // ========================================================================\n\n  /**\n   * Calculate repair cost for a ship system\n   *\n   * Cost is ₡5 per 1% restored. If system is already at maximum condition, cost is 0.\n   *\n   * @param {string} systemType - One of: 'hull', 'engine', 'lifeSupport'\n   * @param {number} amount - Percentage points to restore\n   * @param {number} currentCondition - Current condition percentage\n   * @returns {number} Cost in credits\n   */\n  getRepairCost(systemType, amount, currentCondition) {\n    // If already at max, no cost\n    if (currentCondition >= SHIP_CONFIG.CONDITION_BOUNDS.MAX) {\n      return 0;\n    }\n\n    // Calculate cost at ₡5 per 1%\n    return amount * REPAIR_CONFIG.COST_PER_PERCENT;\n  }\n\n  /**\n   * Execute repair transaction for a ship system\n   *\n   * @param {string} systemType - One of: 'hull', 'engine', 'lifeSupport'\n   * @param {number} amount - Percentage points to restore\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  repairShipSystem(systemType, amount) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: repairShipSystem called before game initialization'\n      );\n    }\n\n    // Validate system type\n    const validSystems = ['hull', 'engine', 'lifeSupport'];\n    if (!validSystems.includes(systemType)) {\n      return { success: false, reason: 'Invalid system type' };\n    }\n\n    const currentCondition = this.state.ship[systemType];\n    const credits = this.state.player.credits;\n    const cost = this.getRepairCost(systemType, amount, currentCondition);\n\n    // Validation order matters for user experience:\n    // 1. Check for positive amount (basic input validation)\n    // 2. Check if system already at max (no repair needed)\n    // 3. Check credits (player can fix by earning money)\n    // 4. Check if would exceed max (player can fix by reducing amount)\n\n    if (amount <= 0) {\n      return { success: false, reason: 'Repair amount must be positive' };\n    }\n\n    if (currentCondition >= SHIP_CONFIG.CONDITION_BOUNDS.MAX) {\n      return { success: false, reason: 'System already at maximum condition' };\n    }\n\n    if (cost > credits) {\n      return { success: false, reason: 'Insufficient credits for repair' };\n    }\n\n    if (currentCondition + amount > SHIP_CONFIG.CONDITION_BOUNDS.MAX) {\n      return {\n        success: false,\n        reason: 'Repair would exceed maximum condition',\n      };\n    }\n\n    // Deduct credits\n    this.updateCredits(credits - cost);\n\n    // Increase condition (clamped by updateShipCondition)\n    const newConditions = {\n      hull: this.state.ship.hull,\n      engine: this.state.ship.engine,\n      lifeSupport: this.state.ship.lifeSupport,\n    };\n\n    newConditions[systemType] = currentCondition + amount;\n\n    this.updateShipCondition(\n      newConditions.hull,\n      newConditions.engine,\n      newConditions.lifeSupport\n    );\n\n    // Persist immediately - repair modifies credits and ship condition\n    this.saveGame();\n\n    return { success: true, reason: null };\n  }\n\n  // ========================================================================\n  // UPGRADE SYSTEM\n  // ========================================================================\n\n  /**\n   * Validate upgrade purchase\n   *\n   * Checks if an upgrade can be purchased by verifying:\n   * 1. Upgrade is not already installed\n   * 2. Player has sufficient credits\n   *\n   * Feature: ship-personality, Property 11: Upgrade Purchase Validation\n   * Validates: Requirements 2.5, 8.5\n   *\n   * @param {string} upgradeId - Upgrade identifier from SHIP_UPGRADES\n   * @returns {Object} { valid: boolean, reason: string }\n   */\n  validateUpgradePurchase(upgradeId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: validateUpgradePurchase called before game initialization'\n      );\n    }\n\n    const upgrade = SHIP_CONFIG.UPGRADES[upgradeId];\n    if (!upgrade) {\n      return { valid: false, reason: 'Unknown upgrade' };\n    }\n\n    // Check if already purchased\n    if (this.state.ship.upgrades.includes(upgradeId)) {\n      return { valid: false, reason: 'Upgrade already installed' };\n    }\n\n    // Check credits\n    if (this.state.player.credits < upgrade.cost) {\n      return {\n        valid: false,\n        reason: `Insufficient credits (need ₡${upgrade.cost})`,\n      };\n    }\n\n    return { valid: true, reason: '' };\n  }\n\n  /**\n   * Purchase and install a ship upgrade\n   *\n   * Validates the purchase, deducts credits, adds upgrade to ship, and applies\n   * upgrade effects to ship capabilities. All upgrades are permanent and cannot\n   * be removed once purchased.\n   *\n   * Feature: ship-personality, Property 3: Upgrade Purchase Transaction\n   * Validates: Requirements 2.4, 2.5\n   *\n   * @param {string} upgradeId - Upgrade identifier from SHIP_UPGRADES\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  purchaseUpgrade(upgradeId) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: purchaseUpgrade called before game initialization'\n      );\n    }\n\n    // Validate purchase\n    const validation = this.validateUpgradePurchase(upgradeId);\n    if (!validation.valid) {\n      return { success: false, reason: validation.reason };\n    }\n\n    const upgrade = SHIP_CONFIG.UPGRADES[upgradeId];\n\n    // Deduct credits\n    this.updateCredits(this.state.player.credits - upgrade.cost);\n\n    // Add upgrade to ship\n    this.state.ship.upgrades.push(upgradeId);\n\n    // Apply upgrade effects to ship capabilities\n    const capabilities = this.calculateShipCapabilities();\n\n    // Update ship state with new capabilities\n    this.state.ship.cargoCapacity = capabilities.cargoCapacity;\n    this.state.ship.hiddenCargoCapacity = capabilities.hiddenCargoCapacity;\n\n    // Note: Fuel capacity is calculated on-demand via getFuelCapacity()\n    // Note: Rate modifiers (fuelConsumption, hullDegradation, lifeSupportDrain)\n    // are applied during calculations via calculateShipCapabilities(), not stored\n\n    // Persist immediately - upgrade purchase modifies credits and ship state\n    this.saveGame();\n\n    return { success: true, reason: '' };\n  }\n\n  /**\n   * Calculate ship capabilities based on installed upgrades\n   *\n   * Starts with base capabilities and applies all upgrade effects.\n   * Capacities use absolute values, rates use multipliers.\n   *\n   * Feature: ship-personality, Property 4: Upgrade Effect Application\n   * Validates: Requirements 2.6, 7.1-7.9\n   *\n   * @returns {Object} Ship capabilities with all upgrades applied\n   */\n  calculateShipCapabilities() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: calculateShipCapabilities called before game initialization'\n      );\n    }\n\n    const capabilities = {\n      fuelCapacity: SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n      cargoCapacity: NEW_GAME_DEFAULTS.STARTING_CARGO_CAPACITY,\n      fuelConsumption: 1.0,\n      hullDegradation: 1.0,\n      lifeSupportDrain: 1.0,\n      hiddenCargoCapacity: 0,\n      eventVisibility: 0,\n    };\n\n    // Apply upgrade effects\n    for (const upgradeId of this.state.ship.upgrades) {\n      const upgrade = SHIP_CONFIG.UPGRADES[upgradeId];\n\n      // If upgrade doesn't exist, this is a critical bug - fail loudly\n      if (!upgrade) {\n        throw new Error(\n          `Invalid upgrade ID: ${upgradeId} not found in SHIP_UPGRADES`\n        );\n      }\n\n      for (const [attr, value] of Object.entries(upgrade.effects)) {\n        if (attr.endsWith('Capacity')) {\n          // Absolute values for capacities\n          capabilities[attr] = value;\n        } else {\n          // Multipliers for rates\n          capabilities[attr] *= value;\n        }\n      }\n    }\n\n    return capabilities;\n  }\n\n  // ========================================================================\n  // HIDDEN CARGO SYSTEM\n  // ========================================================================\n\n  /**\n   * Add cargo to a cargo array, stacking with existing cargo if possible\n   *\n   * Stacks cargo with matching good type and buyPrice. If no match is found,\n   * creates a new stack. Preserves purchase metadata from the source stack.\n   *\n   * @param {Array} cargoArray - Target cargo array (regular or hidden)\n   * @param {Object} sourceStack - Source cargo stack with metadata\n   * @param {number} qty - Quantity to add\n   * @private\n   */\n  _addToCargoArray(cargoArray, sourceStack, qty) {\n    // Find existing stack with matching good and buyPrice\n    const existingIndex = cargoArray.findIndex(\n      (c) => c.good === sourceStack.good && c.buyPrice === sourceStack.buyPrice\n    );\n\n    if (existingIndex >= 0) {\n      // Stack with existing cargo\n      cargoArray[existingIndex].qty += qty;\n    } else {\n      // Create new stack with metadata from source\n      cargoArray.push({\n        good: sourceStack.good,\n        qty: qty,\n        buyPrice: sourceStack.buyPrice,\n        buySystem: sourceStack.buySystem,\n        buySystemName: sourceStack.buySystemName,\n        buyDate: sourceStack.buyDate,\n      });\n    }\n  }\n\n  /**\n   * Move cargo from regular compartment to hidden compartment\n   *\n   * Validates that Smuggler's Panels is installed, cargo exists with sufficient\n   * quantity, and hidden cargo capacity is available. Transfers cargo between\n   * compartments while preserving purchase metadata.\n   *\n   * Feature: ship-personality, Property 12: Hidden Cargo Transfer Validation\n   * Validates: Requirements 3.1, 3.3\n   *\n   * @param {string} good - Commodity type\n   * @param {number} qty - Quantity to move\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  moveToHiddenCargo(good, qty) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: moveToHiddenCargo called before game initialization'\n      );\n    }\n\n    const ship = this.state.ship;\n\n    // Check if smuggler's panels installed\n    if (!ship.upgrades.includes('smuggler_panels')) {\n      return { success: false, reason: 'No hidden cargo compartment' };\n    }\n\n    // Find cargo stack\n    const cargoIndex = ship.cargo.findIndex((c) => c.good === good);\n    if (cargoIndex === -1) {\n      return { success: false, reason: 'Cargo not found' };\n    }\n\n    const cargoStack = ship.cargo[cargoIndex];\n    if (cargoStack.qty < qty) {\n      return { success: false, reason: 'Insufficient quantity' };\n    }\n\n    // Check hidden cargo capacity\n    const hiddenUsed = ship.hiddenCargo.reduce((sum, c) => sum + c.qty, 0);\n    const hiddenAvailable = ship.hiddenCargoCapacity - hiddenUsed;\n    if (qty > hiddenAvailable) {\n      return {\n        success: false,\n        reason: `Hidden cargo full (${hiddenAvailable} units available)`,\n      };\n    }\n\n    // Remove from regular cargo\n    cargoStack.qty -= qty;\n    if (cargoStack.qty === 0) {\n      ship.cargo.splice(cargoIndex, 1);\n    }\n\n    // Add to hidden cargo (stacks with matching good and buyPrice)\n    this._addToCargoArray(ship.hiddenCargo, cargoStack, qty);\n\n    // Emit cargo change event\n    this.updateCargo(ship.cargo);\n\n    // Persist immediately - cargo transfer modifies ship state\n    this.saveGame();\n\n    return { success: true, reason: '' };\n  }\n\n  /**\n   * Move cargo from hidden compartment to regular compartment\n   *\n   * Validates that cargo exists in hidden compartment and regular cargo\n   * capacity is available. Transfers cargo between compartments while\n   * preserving purchase metadata.\n   *\n   * Feature: ship-personality, Property 12: Hidden Cargo Transfer Validation\n   * Validates: Requirements 3.4\n   *\n   * @param {string} good - Commodity type\n   * @param {number} qty - Quantity to move\n   * @returns {Object} { success: boolean, reason: string }\n   */\n  moveToRegularCargo(good, qty) {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: moveToRegularCargo called before game initialization'\n      );\n    }\n\n    const ship = this.state.ship;\n\n    // Find hidden cargo stack\n    const hiddenIndex = ship.hiddenCargo.findIndex((c) => c.good === good);\n    if (hiddenIndex === -1) {\n      return {\n        success: false,\n        reason: 'Cargo not found in hidden compartment',\n      };\n    }\n\n    const hiddenStack = ship.hiddenCargo[hiddenIndex];\n    if (hiddenStack.qty < qty) {\n      return { success: false, reason: 'Insufficient quantity' };\n    }\n\n    // Check regular cargo capacity\n    const cargoUsed = ship.cargo.reduce((sum, c) => sum + c.qty, 0);\n    const cargoAvailable = ship.cargoCapacity - cargoUsed;\n    if (qty > cargoAvailable) {\n      return {\n        success: false,\n        reason: `Cargo hold full (${cargoAvailable} units available)`,\n      };\n    }\n\n    // Remove from hidden cargo\n    hiddenStack.qty -= qty;\n    if (hiddenStack.qty === 0) {\n      ship.hiddenCargo.splice(hiddenIndex, 1);\n    }\n\n    // Add to regular cargo (stacks with matching good and buyPrice)\n    this._addToCargoArray(ship.cargo, hiddenStack, qty);\n\n    // Emit cargo change event\n    this.updateCargo(ship.cargo);\n\n    // Persist immediately - cargo transfer modifies ship state\n    this.saveGame();\n\n    return { success: true, reason: '' };\n  }\n\n  // ========================================================================\n  // DOCK/UNDOCK OPERATIONS\n  // ========================================================================\n\n  /**\n   * Dock at current system's station to access trading and refueling\n   *\n   * Updates price knowledge on dock:\n   * - First visit: Records current prices with lastVisit = daysElapsed\n   * - Subsequent visits: Updates prices and resets lastVisit to 0\n   */\n  dock() {\n    if (!this.state) {\n      throw new Error('Invalid state: dock called before game initialization');\n    }\n\n    const currentSystemId = this.state.player.currentSystem;\n    const currentSystem = this.starData.find((s) => s.id === currentSystemId);\n\n    if (!currentSystem) {\n      throw new Error(\n        `Invalid game state: current system ID ${currentSystemId} not found in star data`\n      );\n    }\n\n    // Calculate current prices for all commodities using dynamic pricing\n    const currentDay = this.state.player.daysElapsed;\n    const activeEvents = this.state.world.activeEvents;\n    if (!activeEvents) {\n      throw new Error('Invalid state: activeEvents missing from world state');\n    }\n    const marketConditions = this.state.world.marketConditions;\n    if (!marketConditions) {\n      throw new Error(\n        'Invalid state: marketConditions missing from world state'\n      );\n    }\n    const currentPrices = {};\n\n    for (const goodType of COMMODITY_TYPES) {\n      currentPrices[goodType] = TradingSystem.calculatePrice(\n        goodType,\n        currentSystem,\n        currentDay,\n        activeEvents,\n        marketConditions\n      );\n    }\n\n    // Update price knowledge (resets lastVisit to 0)\n    this.updatePriceKnowledge(currentSystemId, currentPrices, 0);\n\n    // Persist state transition - prevents loss if player closes browser while docked\n    this.saveGame();\n\n    return { success: true };\n  }\n\n  /**\n   * Undock from current system's station to resume navigation\n   *\n   * Currently a state transition marker for auto-save\n   * Future: Will close station UI, enable jumps, track undocked state.\n   */\n  undock() {\n    if (!this.state) {\n      throw new Error(\n        'Invalid state: undock called before game initialization'\n      );\n    }\n\n    // Persist state transition - prevents loss if player closes browser while undocked\n    this.saveGame();\n\n    return { success: true };\n  }\n\n  // ========================================================================\n  // SAVE/LOAD SYSTEM\n  // ========================================================================\n\n  /**\n   * Save game state to localStorage with debouncing\n   *\n   * Implements save debouncing to prevent excessive saves (max 1 save per second).\n   * This protects against rapid state changes causing performance issues.\n   */\n  saveGame() {\n    const result = saveGameToStorage(\n      this.state,\n      this.lastSaveTime,\n      this.isTestEnvironment\n    );\n\n    if (result.success) {\n      this.lastSaveTime = result.newLastSaveTime;\n    }\n\n    return result.success;\n  }\n\n  /**\n   * Load game state from localStorage\n   *\n   * Supports migration from v1.0.0 to v2.0.0\n   */\n  loadGame() {\n    try {\n      // Load raw state from localStorage\n      let loadedState = loadGameFromStorage(this.isTestEnvironment);\n\n      if (!loadedState) {\n        return null;\n      }\n\n      // Check version compatibility\n      if (!isVersionCompatible(loadedState.meta?.version)) {\n        if (!this.isTestEnvironment) {\n          console.log('Save version incompatible, starting new game');\n        }\n        return null;\n      }\n\n      // Migrate from v1.0.0 to v2.1.0 if needed\n      if (loadedState.meta?.version === '1.0.0' && GAME_VERSION === '2.1.0') {\n        loadedState = migrateFromV1ToV2(\n          loadedState,\n          this.starData,\n          this.isTestEnvironment\n        );\n      }\n\n      // Migrate from v2.0.0 to v2.1.0 if needed\n      if (loadedState.meta?.version === '2.0.0' && GAME_VERSION === '2.1.0') {\n        loadedState = migrateFromV2ToV2_1(loadedState, this.isTestEnvironment);\n      }\n\n      // Validate state structure\n      if (!validateStateStructure(loadedState)) {\n        if (!this.isTestEnvironment) {\n          console.log('Save data corrupted, starting new game');\n        }\n        return null;\n      }\n\n      // Add defaults for missing fields\n      loadedState = addStateDefaults(loadedState, this.starData);\n\n      this.state = loadedState;\n\n      // Emit all state events to update UI\n      this.emit('creditsChanged', this.state.player.credits);\n      this.emit('debtChanged', this.state.player.debt);\n      this.emit('fuelChanged', this.state.ship.fuel);\n      this.emit('cargoChanged', this.state.ship.cargo);\n      this.emit('locationChanged', this.state.player.currentSystem);\n      this.emit('timeChanged', this.state.player.daysElapsed);\n      this.emit('priceKnowledgeChanged', this.state.world.priceKnowledge);\n      this.emit('activeEventsChanged', this.state.world.activeEvents);\n      this.emit('shipConditionChanged', {\n        hull: this.state.ship.hull,\n        engine: this.state.ship.engine,\n        lifeSupport: this.state.ship.lifeSupport,\n      });\n\n      return this.state;\n    } catch (error) {\n      if (!this.isTestEnvironment) {\n        console.log('Failed to load game:', error);\n      }\n      return null;\n    }\n  }\n\n  /**\n   * Check if saved game exists\n   */\n  hasSavedGame() {\n    return checkSavedGame();\n  }\n\n  clearSave() {\n    return clearSaveFromStorage(this.isTestEnvironment);\n  }\n}\n","// Star System Data\n// Each star system has: id, x/y/z coordinates, name, spectral type, wormhole count (wh), station count (st), reachable flag (r)\nexport const STAR_DATA = [\n  { id: 0, x: 0, y: 0, z: 0, name: 'Sol', type: 'G2', wh: 8, st: 6, r: 1 },\n  {\n    id: 1,\n    x: -23.1,\n    y: -19.18,\n    z: -53.76,\n    name: 'Alpha Centauri A',\n    type: 'G2',\n    wh: 6,\n    st: 9,\n    r: 1,\n  },\n  {\n    id: 2,\n    x: -23.1,\n    y: -19.18,\n    z: -53.76,\n    name: 'Alpha Centauri B',\n    type: 'K0',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 3,\n    x: -21.56,\n    y: -16.38,\n    z: -52.5,\n    name: 'Proxima Centauri C',\n    type: 'M5.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 4,\n    x: -0.98,\n    y: -82.88,\n    z: 6.86,\n    name: \"Barnard's Star\",\n    type: 'M5',\n    wh: 3,\n    st: 1,\n    r: 1,\n  },\n  {\n    id: 5,\n    x: -104.16,\n    y: 29.82,\n    z: 13.3,\n    name: 'Wolf 359',\n    type: 'M6',\n    wh: 4,\n    st: 6,\n    r: 1,\n  },\n  {\n    id: 6,\n    x: -91.28,\n    y: 23.1,\n    z: 68.32,\n    name: 'Lalande 21185',\n    type: 'M2',\n    wh: 1,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 7,\n    x: -22.54,\n    y: 113.12,\n    z: -34.58,\n    name: 'Sirius A',\n    type: 'A1',\n    wh: 4,\n    st: 3,\n    r: 1,\n  },\n  {\n    id: 8,\n    x: -22.54,\n    y: 113.12,\n    z: -34.58,\n    name: 'Sirius B',\n    type: 'DA2',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 9,\n    x: 105.56,\n    y: 48.72,\n    z: -37.66,\n    name: 'L 726-8 A',\n    type: 'M5.5',\n    wh: 5,\n    st: 2,\n    r: 1,\n  },\n  {\n    id: 10,\n    x: 105.56,\n    y: 48.72,\n    z: -37.66,\n    name: 'L 726-8 B',\n    type: 'M5.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 11,\n    x: 26.46,\n    y: -121.24,\n    z: -54.88,\n    name: 'Ross 154',\n    type: 'M4.5',\n    wh: 4,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 12,\n    x: 103.32,\n    y: -8.54,\n    z: 100.8,\n    name: 'Ross 248',\n    type: 'M6',\n    wh: 1,\n    st: 2,\n    r: 1,\n  },\n  {\n    id: 13,\n    x: 87.22,\n    y: 115.92,\n    z: -24.22,\n    name: 'Epsilon Eridani',\n    type: 'K2',\n    wh: 4,\n    st: 5,\n    r: 1,\n  },\n  {\n    id: 14,\n    x: 118.3,\n    y: -28.84,\n    z: -87.92,\n    name: 'Lacaille 9352',\n    type: 'M2',\n    wh: 2,\n    st: 5,\n    r: 1,\n  },\n  {\n    id: 15,\n    x: -152.18,\n    y: 8.54,\n    z: 2.1,\n    name: 'Ross 128',\n    type: 'M4.5',\n    wh: 3,\n    st: 9,\n    r: 1,\n  },\n  {\n    id: 16,\n    x: 140.14,\n    y: -52.36,\n    z: -40.88,\n    name: 'L 789-6 A',\n    type: 'M5.5',\n    wh: 2,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 17,\n    x: 140.14,\n    y: -52.36,\n    z: -40.88,\n    name: 'L 789-6 B',\n    type: 'M5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 18,\n    x: 140.14,\n    y: -52.36,\n    z: -40.88,\n    name: 'L 789-6 C',\n    type: 'M7',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 19,\n    x: -66.64,\n    y: 144.48,\n    z: 14.56,\n    name: 'Procyon A',\n    type: 'F5',\n    wh: 1,\n    st: 7,\n    r: 1,\n  },\n  {\n    id: 20,\n    x: -66.64,\n    y: 144.48,\n    z: 14.56,\n    name: 'Procyon B',\n    type: 'DA',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 21,\n    x: 90.44,\n    y: -85.68,\n    z: 99.96,\n    name: '61 Cygni A',\n    type: 'K5',\n    wh: 2,\n    st: 5,\n    r: 0,\n  },\n  {\n    id: 22,\n    x: 90.44,\n    y: -85.68,\n    z: 99.96,\n    name: '61 Cygni B',\n    type: 'K7',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 23,\n    x: 14.98,\n    y: -80.78,\n    z: 140.14,\n    name: 'Struve 2398 A',\n    type: 'M4',\n    wh: 3,\n    st: 3,\n    r: 1,\n  },\n  {\n    id: 24,\n    x: 14.98,\n    y: -80.78,\n    z: 140.14,\n    name: 'Struve 2398 B',\n    type: 'M5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 25,\n    x: 116.76,\n    y: 9.24,\n    z: 113.26,\n    name: 'Groombridge 34 A',\n    type: 'M2',\n    wh: 3,\n    st: 5,\n    r: 0,\n  },\n  {\n    id: 26,\n    x: 116.76,\n    y: 9.24,\n    z: 113.26,\n    name: 'Groombridge 34 B',\n    type: 'M6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 27,\n    x: -89.6,\n    y: 117.6,\n    z: 74.62,\n    name: 'G51-15',\n    type: 'M6.5',\n    wh: 3,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 28,\n    x: 79.24,\n    y: -44.24,\n    z: -138.6,\n    name: 'Epsilon Indi A',\n    type: 'K4',\n    wh: 3,\n    st: 1,\n    r: 0,\n  },\n  {\n    id: 29,\n    x: 79.38,\n    y: -43.96,\n    z: -138.6,\n    name: 'Epsilon Indi B',\n    type: 'T1',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 30,\n    x: 79.38,\n    y: -43.96,\n    z: -138.6,\n    name: 'Epsilon Indi C',\n    type: 'T6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 31,\n    x: 143.92,\n    y: 70.28,\n    z: -45.78,\n    name: 'Tau Ceti',\n    type: 'G8',\n    wh: 3,\n    st: 2,\n    r: 1,\n  },\n  {\n    id: 32,\n    x: 70.7,\n    y: 97.44,\n    z: -118.44,\n    name: 'L 372-58',\n    type: 'M5.5',\n    wh: 3,\n    st: 1,\n    r: 1,\n  },\n  {\n    id: 33,\n    x: 154.28,\n    y: 50.26,\n    z: -49.56,\n    name: 'L 725-32',\n    type: 'M5',\n    wh: 1,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 34,\n    x: -64.12,\n    y: 160.44,\n    z: 15.82,\n    name: \"Luyten's Star\",\n    type: 'M3.5',\n    wh: 2,\n    st: 5,\n    r: 1,\n  },\n  {\n    id: 35,\n    x: 122.78,\n    y: 115.5,\n    z: 51.24,\n    name: 'SO 0253+1652',\n    type: 'M6.5',\n    wh: 3,\n    st: 3,\n    r: 1,\n  },\n  {\n    id: 36,\n    x: 26.74,\n    y: 123.62,\n    z: -126.56,\n    name: \"Kapteyn's Star\",\n    type: 'M1',\n    wh: 2,\n    st: 2,\n    r: 1,\n  },\n  {\n    id: 37,\n    x: 15.4,\n    y: -77.42,\n    z: -161.56,\n    name: 'SCR 1845-6357 A',\n    type: 'M8.5',\n    wh: 3,\n    st: 1,\n    r: 0,\n  },\n  {\n    id: 38,\n    x: 15.4,\n    y: -77.42,\n    z: -161.56,\n    name: 'SCR 1845-6357 B',\n    type: 'T5.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 39,\n    x: 106.26,\n    y: -91.56,\n    z: -113.12,\n    name: 'Lacaille 8760',\n    type: 'M0',\n    wh: 1,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 40,\n    x: 90.02,\n    y: -38.22,\n    z: 154.7,\n    name: 'Kruger 60 A',\n    type: 'M3',\n    wh: 2,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 41,\n    x: 90.02,\n    y: -38.22,\n    z: 154.7,\n    name: 'Kruger 60 B',\n    type: 'M6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 42,\n    x: -134.4,\n    y: 43.68,\n    z: -118.3,\n    name: 'DENIS 1048-39',\n    type: 'M9',\n    wh: 1,\n    st: 13,\n    r: 1,\n  },\n  {\n    id: 43,\n    x: -23.8,\n    y: 186.34,\n    z: -9.24,\n    name: 'Ross 614 A',\n    type: 'M4.5',\n    wh: 0,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 44,\n    x: -23.8,\n    y: 186.34,\n    z: -9.24,\n    name: 'Ross 614 B',\n    type: 'M7',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 45,\n    x: -72.66,\n    y: -175.56,\n    z: -42.7,\n    name: 'Wolf 1061',\n    type: 'M3.5',\n    wh: 1,\n    st: 5,\n    r: 1,\n  },\n  {\n    id: 46,\n    x: -192.22,\n    y: -27.86,\n    z: 30.8,\n    name: 'Wolf 424 A',\n    type: 'M5.5',\n    wh: 3,\n    st: 9,\n    r: 1,\n  },\n  {\n    id: 47,\n    x: -192.22,\n    y: -27.86,\n    z: 30.8,\n    name: 'Wolf 424 B',\n    type: 'M7',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 48,\n    x: 158.2,\n    y: 3.5,\n    z: -120.82,\n    name: 'CD-37 15492',\n    type: 'M4',\n    wh: 1,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 49,\n    x: 195.72,\n    y: 42.56,\n    z: 18.9,\n    name: \"van Maanen's Star\",\n    type: 'DZ7',\n    wh: 1,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 50,\n    x: 172.06,\n    y: 99.4,\n    z: 46.06,\n    name: 'L 1159-16',\n    type: 'M8',\n    wh: 1,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 51,\n    x: -93.1,\n    y: 32.06,\n    z: -179.06,\n    name: 'L 143-23',\n    type: 'M5.5',\n    wh: 2,\n    st: 10,\n    r: 1,\n  },\n  {\n    id: 52,\n    x: -192.64,\n    y: 62.58,\n    z: -40.6,\n    name: 'LP 731-58',\n    type: 'M6.5',\n    wh: 2,\n    st: 14,\n    r: 1,\n  },\n  {\n    id: 53,\n    x: -7.98,\n    y: -75.88,\n    z: 192.22,\n    name: 'BD+68 946',\n    type: 'M3.5',\n    wh: 2,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 54,\n    x: -19.6,\n    y: -140.14,\n    z: -151.34,\n    name: 'CD-46 11540',\n    type: 'M3',\n    wh: 1,\n    st: 6,\n    r: 0,\n  },\n  {\n    id: 55,\n    x: -89.6,\n    y: 5.88,\n    z: -190.96,\n    name: 'L 145-141',\n    type: 'DQ6',\n    wh: 2,\n    st: 10,\n    r: 1,\n  },\n  {\n    id: 56,\n    x: 212.66,\n    y: 5.74,\n    z: -28.14,\n    name: 'G158-27',\n    type: 'M5.5',\n    wh: 2,\n    st: 6,\n    r: 1,\n  },\n  {\n    id: 57,\n    x: 199.36,\n    y: -59.92,\n    z: -52.92,\n    name: 'Ross 780',\n    type: 'M5',\n    wh: 2,\n    st: 6,\n    r: 1,\n  },\n  {\n    id: 58,\n    x: 72.94,\n    y: -135.52,\n    z: 150.78,\n    name: 'G208-44 A',\n    type: 'M5.5',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 59,\n    x: 72.94,\n    y: -135.52,\n    z: 150.78,\n    name: 'G208-44 B',\n    type: 'M6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 60,\n    x: 72.94,\n    y: -135.52,\n    z: 150.78,\n    name: 'G208-44 C',\n    type: 'M8',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 61,\n    x: -155.4,\n    y: 37.94,\n    z: 152.04,\n    name: 'Lalande 21258 A',\n    type: 'M2',\n    wh: 2,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 62,\n    x: -155.4,\n    y: 37.94,\n    z: 151.9,\n    name: 'Lalande 21258 B',\n    type: 'M6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 63,\n    x: -128.66,\n    y: 66.22,\n    z: 168.98,\n    name: 'Groombridge 1618',\n    type: 'K7',\n    wh: 2,\n    st: 9,\n    r: 1,\n  },\n  {\n    id: 64,\n    x: 110.32,\n    y: 105.56,\n    z: -163.8,\n    name: 'DENIS 0255-47',\n    type: 'L8',\n    wh: 1,\n    st: 3,\n    r: 1,\n  },\n  {\n    id: 65,\n    x: -190.54,\n    y: 89.74,\n    z: 76.16,\n    name: 'BD+20 2465',\n    type: 'M4.5',\n    wh: 2,\n    st: 10,\n    r: 1,\n  },\n  {\n    id: 66,\n    x: 118.44,\n    y: -88.34,\n    z: -170.1,\n    name: 'L 354-89',\n    type: 'M1',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 67,\n    x: 106.54,\n    y: 150.92,\n    z: -131.46,\n    name: 'LP 944-20',\n    type: 'M9',\n    wh: 1,\n    st: 4,\n    r: 1,\n  },\n  {\n    id: 68,\n    x: -16.52,\n    y: -163.94,\n    z: -160.86,\n    name: 'CD-44 11909',\n    type: 'M3.5',\n    wh: 2,\n    st: 6,\n    r: 0,\n  },\n  {\n    id: 69,\n    x: 100.94,\n    y: 204.68,\n    z: -30.66,\n    name: 'Omicron² Eridani A',\n    type: 'K1',\n    wh: 1,\n    st: 10,\n    r: 0,\n  },\n  {\n    id: 70,\n    x: 100.94,\n    y: 204.68,\n    z: -30.66,\n    name: 'Omicron² Eridani B',\n    type: 'DA4',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 71,\n    x: 100.94,\n    y: 204.68,\n    z: -30.66,\n    name: 'Omicron² Eridani C',\n    type: 'M4.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 72,\n    x: 156.38,\n    y: -52.22,\n    z: 161.14,\n    name: 'BD+43 4305',\n    type: 'M4.5',\n    wh: 1,\n    st: 2,\n    r: 0,\n  },\n  {\n    id: 73,\n    x: 5.18,\n    y: -231.98,\n    z: 10.08,\n    name: '70 Ophiuchi A',\n    type: 'K0',\n    wh: 2,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 74,\n    x: 5.18,\n    y: -231.98,\n    z: 10.08,\n    name: '70 Ophiuchi B',\n    type: 'K5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 75,\n    x: 107.24,\n    y: -205.66,\n    z: 36.12,\n    name: 'Altair',\n    type: 'A7',\n    wh: 1,\n    st: 9,\n    r: 1,\n  },\n  {\n    id: 76,\n    x: -157.5,\n    y: 160.16,\n    z: 80.78,\n    name: 'G9-38 A',\n    type: 'M5.5',\n    wh: 1,\n    st: 7,\n    r: 1,\n  },\n  {\n    id: 77,\n    x: -157.5,\n    y: 160.16,\n    z: 80.78,\n    name: 'G9-38 B',\n    type: 'M5.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 78,\n    x: 232.12,\n    y: 15.26,\n    z: -67.34,\n    name: 'L 722-22 A',\n    type: 'M4',\n    wh: 1,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 79,\n    x: 232.12,\n    y: 15.26,\n    z: -67.34,\n    name: 'L 722-22 B',\n    type: 'M6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 80,\n    x: 0,\n    y: 244.86,\n    z: 11.48,\n    name: 'G99-49',\n    type: 'M4',\n    wh: 1,\n    st: 3,\n    r: 0,\n  },\n  {\n    id: 81,\n    x: -48.3,\n    y: 2.66,\n    z: 241.5,\n    name: 'G254-29',\n    type: 'M4',\n    wh: 1,\n    st: 6,\n    r: 0,\n  },\n  {\n    id: 82,\n    x: -214.9,\n    y: -106.12,\n    z: 63.7,\n    name: 'Lalande 25372',\n    type: 'M4',\n    wh: 1,\n    st: 10,\n    r: 1,\n  },\n  {\n    id: 83,\n    x: 62.16,\n    y: 240.1,\n    z: -30.24,\n    name: 'LP 656-38',\n    type: 'M3.5',\n    wh: 1,\n    st: 4,\n    r: 0,\n  },\n  {\n    id: 84,\n    x: 163.66,\n    y: -175.28,\n    z: -73.22,\n    name: 'LP 816-60',\n    type: 'M5',\n    wh: 1,\n    st: 6,\n    r: 0,\n  },\n  {\n    id: 85,\n    x: 49.14,\n    y: 120.12,\n    z: 215.74,\n    name: 'Stein 2051 A',\n    type: 'M4',\n    wh: 1,\n    st: 8,\n    r: 0,\n  },\n  {\n    id: 86,\n    x: 49.14,\n    y: 120.12,\n    z: 215.74,\n    name: 'Stein 2051 B',\n    type: 'DC5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 87,\n    x: -49.28,\n    y: 204.68,\n    z: 138.18,\n    name: 'Wolf 294',\n    type: 'M4',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 88,\n    x: 33.04,\n    y: -214.48,\n    z: 140.84,\n    name: '2MASS 1835+32',\n    type: 'M8.5',\n    wh: 1,\n    st: 11,\n    r: 0,\n  },\n  {\n    id: 89,\n    x: 32.62,\n    y: 257.18,\n    z: -16.66,\n    name: 'Wolf 1453',\n    type: 'M1.5',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 90,\n    x: 114.24,\n    y: 231.7,\n    z: -43.54,\n    name: '2MASS 0415-09',\n    type: 'T8.5',\n    wh: 1,\n    st: 10,\n    r: 0,\n  },\n  {\n    id: 91,\n    x: 35.84,\n    y: -84.28,\n    z: 246.96,\n    name: 'Sigma Draconis',\n    type: 'K0',\n    wh: 1,\n    st: 11,\n    r: 1,\n  },\n  {\n    id: 92,\n    x: -10.78,\n    y: 244.44,\n    z: -98.14,\n    name: 'L 668-21 A',\n    type: 'M1',\n    wh: 1,\n    st: 8,\n    r: 1,\n  },\n  {\n    id: 93,\n    x: -10.78,\n    y: 244.44,\n    z: -98.14,\n    name: 'L 668-21 B',\n    type: 'T6',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 94,\n    x: 20.16,\n    y: 257.32,\n    z: 57.12,\n    name: 'Ross 47',\n    type: 'M4',\n    wh: 1,\n    st: 11,\n    r: 0,\n  },\n  {\n    id: 95,\n    x: -8.68,\n    y: -142.94,\n    z: -223.3,\n    name: 'L 205-128',\n    type: 'M3.5',\n    wh: 0,\n    st: 4,\n    r: 0,\n  },\n  {\n    id: 96,\n    x: 87.08,\n    y: -252.56,\n    z: 24.22,\n    name: 'Wolf 1055 A',\n    type: 'M3.5',\n    wh: 0,\n    st: 5,\n    r: 0,\n  },\n  {\n    id: 97,\n    x: 88.06,\n    y: -252.28,\n    z: 24.08,\n    name: 'Wolf 1055 B',\n    type: 'M8',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 98,\n    x: -136.22,\n    y: 209.58,\n    z: -98.7,\n    name: 'L 674-15',\n    type: 'M4',\n    wh: 1,\n    st: 8,\n    r: 0,\n  },\n  {\n    id: 99,\n    x: -179.76,\n    y: -175.28,\n    z: -98.42,\n    name: 'Lalande 27173 A',\n    type: 'K5',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 100,\n    x: -179.76,\n    y: -175.28,\n    z: -98.42,\n    name: 'Lalande 27173 B',\n    type: 'M1',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 101,\n    x: -179.76,\n    y: -175.28,\n    z: -98.42,\n    name: 'Lalande 27173 C',\n    type: 'M3',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 102,\n    x: -179.9,\n    y: -175.28,\n    z: -98.28,\n    name: 'Lalande 27173 D',\n    type: 'T8',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 103,\n    x: 64.82,\n    y: -177.8,\n    z: -192.92,\n    name: 'L 347-14',\n    type: 'M4.5',\n    wh: 1,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 104,\n    x: -118.72,\n    y: 242.9,\n    z: 16.8,\n    name: 'Ross 882',\n    type: 'M4.5',\n    wh: 0,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 105,\n    x: -122.5,\n    y: -162.54,\n    z: -178.78,\n    name: 'CD-40 9712',\n    type: 'M3',\n    wh: 1,\n    st: 10,\n    r: 1,\n  },\n  {\n    id: 106,\n    x: 141.54,\n    y: 30.8,\n    z: 230.16,\n    name: 'Eta Cassiopeiae A',\n    type: 'G0',\n    wh: 0,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 107,\n    x: 141.54,\n    y: 30.8,\n    z: 230.16,\n    name: 'Eta Cassiopeiae B',\n    type: 'K7',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 108,\n    x: 272.02,\n    y: -13.02,\n    z: 11.48,\n    name: 'Lalande 46650',\n    type: 'M2',\n    wh: 0,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 109,\n    x: -47.6,\n    y: -239.68,\n    z: -122.36,\n    name: '36 Ophiuchi A',\n    type: 'K1',\n    wh: 1,\n    st: 7,\n    r: 0,\n  },\n  {\n    id: 110,\n    x: -47.6,\n    y: -239.68,\n    z: -122.36,\n    name: '36 Ophiuchi B',\n    type: 'K1',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 111,\n    x: -46.48,\n    y: -239.4,\n    z: -121.8,\n    name: '36 Ophiuchi C',\n    type: 'K5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 112,\n    x: 120.82,\n    y: -187.74,\n    z: -162.82,\n    name: 'CD-36 13940 A',\n    type: 'K3',\n    wh: 0,\n    st: 9,\n    r: 0,\n  },\n  {\n    id: 113,\n    x: 120.82,\n    y: -187.74,\n    z: -162.82,\n    name: 'CD-36 13940 B',\n    type: 'M3.5',\n    wh: 0,\n    st: 0,\n    r: 0,\n  },\n  {\n    id: 114,\n    x: 130.48,\n    y: 154.42,\n    z: -189,\n    name: '82 Eridani',\n    type: 'G5',\n    wh: 0,\n    st: 6,\n    r: 0,\n  },\n  {\n    id: 115,\n    x: 59.78,\n    y: -95.48,\n    z: -255.08,\n    name: 'Delta Pavonis',\n    type: 'G5',\n    wh: 0,\n    st: 8,\n    r: 0,\n  },\n  {\n    id: 116,\n    x: -213.36,\n    y: -169.82,\n    z: -60.48,\n    name: 'Wolf 1481',\n    type: 'M3',\n    wh: 0,\n    st: 9,\n    r: 0,\n  },\n];\n","// Wormhole Connection Data\n// Each connection is a pair of star system IDs [fromId, toId]\nexport const WORMHOLE_DATA = [\n  [0, 1],\n  [0, 4],\n  [0, 7],\n  [0, 9],\n  [0, 11],\n  [0, 12],\n  [0, 16],\n  [0, 19],\n  [1, 13],\n  [4, 23],\n  [4, 73],\n  [5, 6],\n  [5, 7],\n  [5, 27],\n  [5, 65],\n  [7, 34],\n  [7, 36],\n  [9, 13],\n  [9, 14],\n  [9, 31],\n  [9, 33],\n  [11, 1],\n  [11, 39],\n  [11, 45],\n  [13, 35],\n  [14, 48],\n  [15, 1],\n  [15, 42],\n  [15, 46],\n  [16, 57],\n  [21, 25],\n  [21, 58],\n  [23, 53],\n  [23, 91],\n  [25, 40],\n  [25, 72],\n  [27, 34],\n  [27, 65],\n  [28, 37],\n  [28, 54],\n  [28, 66],\n  [31, 13],\n  [31, 56],\n  [32, 36],\n  [32, 64],\n  [32, 67],\n  [35, 92],\n  [37, 68],\n  [37, 103],\n  [40, 81],\n  [46, 52],\n  [46, 82],\n  [49, 56],\n  [50, 35],\n  [51, 1],\n  [51, 55],\n  [52, 76],\n  [53, 63],\n  [55, 105],\n  [57, 78],\n  [61, 85],\n  [61, 87],\n  [63, 1],\n  [68, 109],\n  [69, 90],\n  [73, 75],\n  [80, 89],\n  [83, 94],\n  [84, 88],\n  [98, 99],\n];\n","import { NAVIGATION_CONFIG, SHIP_CONFIG } from './constants.js';\n\n/**\n * NavigationSystem - Handles distance calculations and jump mechanics\n *\n * Responsibilities:\n * - Calculate distances between star systems\n * - Calculate jump time and fuel costs\n * - Validate wormhole connections\n * - Execute jump operations\n */\nexport class NavigationSystem {\n  constructor(starData, wormholeData) {\n    this.starData = starData;\n    this.wormholeData = wormholeData;\n  }\n\n  // ========================================================================\n  // DISTANCE CALCULATIONS\n  // ========================================================================\n\n  /**\n   * Calculate distance from Sol to a star system\n   * Formula: hypot(x, y, z) * NAVIGATION_CONFIG.LY_PER_UNIT\n   *\n   * @param {Object} star - Star system object with x, y, z coordinates\n   * @returns {number} Distance in light years\n   */\n  calculateDistanceFromSol(star) {\n    const r = Math.hypot(star.x, star.y, star.z);\n    return r * NAVIGATION_CONFIG.LY_PER_UNIT;\n  }\n\n  /**\n   * Calculate distance between two star systems\n   * Formula: hypot(x₁-x₂, y₁-y₂, z₁-z₂) * LY_PER_UNIT\n   *\n   * @param {Object} star1 - First star system with x, y, z coordinates\n   * @param {Object} star2 - Second star system with x, y, z coordinates\n   * @returns {number} Distance in light years\n   */\n  calculateDistanceBetween(star1, star2) {\n    const r = Math.hypot(\n      star1.x - star2.x,\n      star1.y - star2.y,\n      star1.z - star2.z\n    );\n    return r * NAVIGATION_CONFIG.LY_PER_UNIT;\n  }\n\n  // ========================================================================\n  // JUMP CALCULATIONS\n  // ========================================================================\n\n  /**\n   * Calculate jump time based on distance\n   * Formula: max(1, ceil(distance × 0.5))\n   *\n   * @param {number} distance - Distance in light years\n   * @returns {number} Jump time in days\n   */\n  calculateJumpTime(distance) {\n    return Math.max(1, Math.ceil(distance * 0.5));\n  }\n\n  /**\n   * Calculate fuel cost for a jump\n   * Formula: 10 + (distance × 2)\n   *\n   * @param {number} distance - Distance in light years\n   * @returns {number} Fuel cost as percentage\n   */\n  calculateFuelCost(distance) {\n    return 10 + distance * 2;\n  }\n\n  /**\n   * Calculate fuel cost with engine condition penalty, quirk modifiers, and upgrade effects\n   *\n   * When engine condition falls below SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.THRESHOLD,\n   * fuel consumption increases by SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.FUEL_PENALTY_MULTIPLIER\n   * due to reduced propulsion efficiency.\n   *\n   * Quirk modifiers and upgrade effects are applied multiplicatively after engine condition penalty.\n   * For example, with hot_thruster (+5%), fuel_sipper (-15%), and efficient_drive (-20%):\n   * finalCost = baseCost × enginePenalty × 1.05 × 0.85 × 0.8\n   *\n   * @param {number} distance - Distance in light years\n   * @param {number} engineCondition - Engine condition percentage (0-100)\n   * @param {Function} applyQuirkModifiers - Function to apply quirk modifiers (optional)\n   * @param {string[]} quirks - Array of quirk IDs (optional)\n   * @param {number} upgradeModifier - Upgrade fuel consumption modifier (default 1.0)\n   * @returns {number} Fuel cost as percentage\n   */\n  calculateFuelCostWithCondition(\n    distance,\n    engineCondition,\n    applyQuirkModifiers = null,\n    quirks = [],\n    upgradeModifier = 1.0\n  ) {\n    let cost = this.calculateFuelCost(distance);\n\n    // Apply engine condition penalty\n    if (engineCondition < SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.THRESHOLD) {\n      cost *= SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.FUEL_PENALTY_MULTIPLIER;\n    }\n\n    // Apply quirk modifiers if provided\n    if (applyQuirkModifiers && quirks.length > 0) {\n      cost = applyQuirkModifiers(cost, 'fuelConsumption', quirks);\n    }\n\n    // Apply upgrade modifier\n    cost *= upgradeModifier;\n\n    return cost;\n  }\n\n  /**\n   * Calculate jump time with engine condition penalty\n   *\n   * When engine condition falls below SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.THRESHOLD,\n   * jump time increases by SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.TIME_PENALTY_DAYS\n   * due to slower wormhole transit.\n   *\n   * @param {number} distance - Distance in light years\n   * @param {number} engineCondition - Engine condition percentage (0-100)\n   * @returns {number} Jump time in days\n   */\n  calculateJumpTimeWithCondition(distance, engineCondition) {\n    const baseTime = this.calculateJumpTime(distance);\n\n    if (engineCondition < SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.THRESHOLD) {\n      return (\n        baseTime + SHIP_CONFIG.ENGINE_CONDITION_PENALTIES.TIME_PENALTY_DAYS\n      );\n    }\n\n    return baseTime;\n  }\n\n  // ========================================================================\n  // SHIP CONDITION DEGRADATION\n  // ========================================================================\n\n  /**\n   * Apply ship degradation from a jump with quirk modifiers and upgrade effects\n   *\n   * Formula:\n   * - Hull: current - (SHIP_CONFIG.DEGRADATION.HULL_PER_JUMP × quirkModifiers × upgradeModifiers)\n   * - Engine: current - SHIP_CONFIG.DEGRADATION.ENGINE_PER_JUMP\n   * - Life Support: current - (SHIP_CONFIG.DEGRADATION.LIFE_SUPPORT_PER_DAY × jumpDays × quirkModifiers × upgradeModifiers)\n   * All values clamped to [SHIP_CONFIG.CONDITION_BOUNDS.MIN, SHIP_CONFIG.CONDITION_BOUNDS.MAX]\n   *\n   * Degradation rates reflect wear from wormhole transit:\n   * - Hull: Space debris and micro-meteorites\n   * - Engine: Stress from wormhole field interaction\n   * - Life Support: Consumables and filter degradation over time\n   *\n   * Quirk modifiers and upgrade effects are applied multiplicatively to base degradation rates.\n   * For example, leaky_seals (1.5×) and reinforced_hull (0.5×) combine to 0.75× hull degradation.\n   *\n   * Mutates the ship object in place for performance.\n   *\n   * @param {Object} ship - Ship state with hull, engine, lifeSupport fields\n   * @param {number} jumpDays - Jump duration in days\n   * @param {Function} applyQuirkModifiers - Function to apply quirk modifiers (optional)\n   * @param {string[]} quirks - Array of quirk IDs (optional)\n   * @param {number} hullUpgradeModifier - Upgrade hull degradation modifier (default 1.0)\n   * @param {number} lifeSupportUpgradeModifier - Upgrade life support drain modifier (default 1.0)\n   * @returns {Object} The same ship object with updated condition values\n   */\n  static applyJumpDegradation(\n    ship,\n    jumpDays,\n    applyQuirkModifiers = null,\n    quirks = [],\n    hullUpgradeModifier = 1.0,\n    lifeSupportUpgradeModifier = 1.0\n  ) {\n    // Calculate base degradation amounts\n    let hullDegradation = SHIP_CONFIG.DEGRADATION.HULL_PER_JUMP;\n    const engineDegradation = SHIP_CONFIG.DEGRADATION.ENGINE_PER_JUMP;\n    let lifeSupportDegradation =\n      SHIP_CONFIG.DEGRADATION.LIFE_SUPPORT_PER_DAY * jumpDays;\n\n    // Apply quirk modifiers if provided\n    if (applyQuirkModifiers && quirks.length > 0) {\n      hullDegradation = applyQuirkModifiers(\n        hullDegradation,\n        'hullDegradation',\n        quirks\n      );\n      lifeSupportDegradation = applyQuirkModifiers(\n        lifeSupportDegradation,\n        'lifeSupportDrain',\n        quirks\n      );\n    }\n\n    // Apply upgrade modifiers\n    hullDegradation *= hullUpgradeModifier;\n    lifeSupportDegradation *= lifeSupportUpgradeModifier;\n\n    // Apply degradation and clamp to valid range\n    ship.hull = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(SHIP_CONFIG.CONDITION_BOUNDS.MAX, ship.hull - hullDegradation)\n    );\n\n    ship.engine = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(\n        SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        ship.engine - engineDegradation\n      )\n    );\n\n    ship.lifeSupport = Math.max(\n      SHIP_CONFIG.CONDITION_BOUNDS.MIN,\n      Math.min(\n        SHIP_CONFIG.CONDITION_BOUNDS.MAX,\n        ship.lifeSupport - lifeSupportDegradation\n      )\n    );\n\n    return ship;\n  }\n\n  // ========================================================================\n  // CONNECTION VALIDATION\n  // ========================================================================\n\n  /**\n   * Check if two systems are connected by a wormhole\n   *\n   * @param {number} systemId1 - First system ID\n   * @param {number} systemId2 - Second system ID\n   * @returns {boolean} True if systems are connected\n   */\n  areSystemsConnected(systemId1, systemId2) {\n    return this.wormholeData.some(\n      (connection) =>\n        (connection[0] === systemId1 && connection[1] === systemId2) ||\n        (connection[0] === systemId2 && connection[1] === systemId1)\n    );\n  }\n\n  /**\n   * Get all systems connected to a given system\n   *\n   * @param {number} systemId - System ID to check\n   * @returns {number[]} Array of connected system IDs\n   */\n  getConnectedSystems(systemId) {\n    const connected = [];\n\n    for (const connection of this.wormholeData) {\n      if (connection[0] === systemId) {\n        connected.push(connection[1]);\n      } else if (connection[1] === systemId) {\n        connected.push(connection[0]);\n      }\n    }\n\n    return connected;\n  }\n\n  // ========================================================================\n  // JUMP VALIDATION AND EXECUTION\n  // ========================================================================\n\n  /**\n   * Validate if a jump is possible\n   *\n   * @param {number} currentSystemId - Current system ID\n   * @param {number} targetSystemId - Target system ID\n   * @param {number} currentFuel - Current fuel percentage\n   * @param {number} engineCondition - Engine condition percentage (0-100), optional for backward compatibility\n   * @param {Function} applyQuirkModifiers - Function to apply quirk modifiers (optional)\n   * @param {string[]} quirks - Array of quirk IDs (optional)\n   * @param {number} upgradeModifier - Upgrade fuel consumption modifier (default 1.0)\n   * @returns {Object} { valid: boolean, error: string|null, fuelCost: number, distance: number, jumpTime: number }\n   */\n  validateJump(\n    currentSystemId,\n    targetSystemId,\n    currentFuel,\n    engineCondition = 100,\n    applyQuirkModifiers = null,\n    quirks = [],\n    upgradeModifier = 1.0\n  ) {\n    // Check wormhole connection\n    if (!this.areSystemsConnected(currentSystemId, targetSystemId)) {\n      return {\n        valid: false,\n        error: 'No wormhole connection to target system',\n        fuelCost: 0,\n        distance: 0,\n        jumpTime: 0,\n      };\n    }\n\n    // Get star systems\n    const currentStar = this.starData.find((s) => s.id === currentSystemId);\n    const targetStar = this.starData.find((s) => s.id === targetSystemId);\n\n    if (!currentStar || !targetStar) {\n      return {\n        valid: false,\n        error: 'Invalid system ID',\n        fuelCost: 0,\n        distance: 0,\n        jumpTime: 0,\n      };\n    }\n\n    // Calculate jump parameters with engine condition, quirk modifiers, and upgrade effects\n    const distance = this.calculateDistanceBetween(currentStar, targetStar);\n    const fuelCost = this.calculateFuelCostWithCondition(\n      distance,\n      engineCondition,\n      applyQuirkModifiers,\n      quirks,\n      upgradeModifier\n    );\n    const jumpTime = this.calculateJumpTimeWithCondition(\n      distance,\n      engineCondition\n    );\n\n    // Check fuel availability\n    if (currentFuel < fuelCost) {\n      return {\n        valid: false,\n        error: 'Insufficient fuel for jump',\n        fuelCost,\n        distance,\n        jumpTime,\n      };\n    }\n\n    return {\n      valid: true,\n      error: null,\n      fuelCost,\n      distance,\n      jumpTime,\n    };\n  }\n\n  /**\n   * Execute a jump (updates game state and triggers animation)\n   *\n   * @param {Object} gameStateManager - GameStateManager instance\n   * @param {number} targetSystemId - Target system ID\n   * @param {Object} animationSystem - Optional JumpAnimationSystem instance\n   * @param {Object} uiManager - Optional UIManager instance for hiding/showing panels during animation\n   * @returns {Promise<Object>} { success: boolean, error: string|null }\n   */\n  async executeJump(\n    gameStateManager,\n    targetSystemId,\n    animationSystem = null,\n    uiManager = null\n  ) {\n    const state = gameStateManager.getState();\n\n    if (!state) {\n      return { success: false, error: 'No game state' };\n    }\n\n    const currentSystemId = state.player.currentSystem;\n    const currentFuel = state.ship.fuel;\n    const engineCondition = state.ship.engine;\n    const quirks = state.ship.quirks || [];\n\n    // Calculate ship capabilities (includes upgrade effects)\n    const capabilities = gameStateManager.calculateShipCapabilities();\n\n    // Validate jump with engine condition, quirk modifiers, and upgrade effects\n    const validation = this.validateJump(\n      currentSystemId,\n      targetSystemId,\n      currentFuel,\n      engineCondition,\n      gameStateManager.applyQuirkModifiers.bind(gameStateManager),\n      quirks,\n      capabilities.fuelConsumption\n    );\n\n    if (!validation.valid) {\n      return { success: false, error: validation.error };\n    }\n\n    // Execute jump: update fuel, time, and location BEFORE animation\n    // This ensures progress is saved even if animation is interrupted\n    gameStateManager.updateFuel(currentFuel - validation.fuelCost);\n    gameStateManager.updateTime(state.player.daysElapsed + validation.jumpTime);\n    gameStateManager.updateLocation(targetSystemId);\n\n    // Apply ship condition degradation from jump with quirk modifiers and upgrade effects\n    const degradedShip = NavigationSystem.applyJumpDegradation(\n      state.ship,\n      validation.jumpTime,\n      gameStateManager.applyQuirkModifiers.bind(gameStateManager),\n      quirks,\n      capabilities.hullDegradation,\n      capabilities.lifeSupportDrain\n    );\n    gameStateManager.updateShipCondition(\n      degradedShip.hull,\n      degradedShip.engine,\n      degradedShip.lifeSupport\n    );\n\n    // Auto-save after jump (before animation)\n    gameStateManager.saveGame();\n\n    // Hide UI panels before animation if UI manager is provided\n    let stationWasVisible = false;\n    let tradeWasVisible = false;\n    let refuelWasVisible = false;\n    let infoBrokerWasVisible = false;\n\n    if (uiManager && animationSystem) {\n      // Store panel visibility state\n      if (uiManager.isStationVisible && uiManager.isStationVisible()) {\n        stationWasVisible = true;\n        uiManager.hideStationInterface();\n      }\n\n      if (uiManager.isTradeVisible && uiManager.isTradeVisible()) {\n        tradeWasVisible = true;\n        uiManager.hideTradePanel();\n      }\n\n      if (uiManager.isRefuelVisible && uiManager.isRefuelVisible()) {\n        refuelWasVisible = true;\n        uiManager.hideRefuelPanel();\n      }\n\n      if (uiManager.isInfoBrokerVisible && uiManager.isInfoBrokerVisible()) {\n        infoBrokerWasVisible = true;\n        uiManager.hideInfoBrokerPanel();\n      }\n    }\n\n    // Play animation if animation system is provided\n    if (animationSystem) {\n      try {\n        await animationSystem.playJumpAnimation(\n          currentSystemId,\n          targetSystemId\n        );\n      } finally {\n        // Restore UI panels after animation completes (or fails)\n        if (uiManager) {\n          if (stationWasVisible) uiManager.showStationInterface();\n          if (tradeWasVisible) uiManager.showTradePanel();\n          if (refuelWasVisible) uiManager.showRefuelPanel();\n          if (infoBrokerWasVisible) uiManager.showInfoBrokerPanel();\n        }\n      }\n    }\n\n    return { success: true, error: null };\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\nimport { GameProvider } from './context/GameContext';\nimport { GameStateManager } from './game/state/game-state-manager';\nimport { loadGame } from './game/state/save-load';\nimport { STAR_DATA } from './game/data/star-data';\nimport { WORMHOLE_DATA } from './game/data/wormhole-data';\nimport { NavigationSystem } from './game/game-navigation';\n\n// Import global CSS\nimport '../css/base.css';\nimport '../css/hud.css';\nimport '../css/modals.css';\nimport '../css/starmap-scene.css';\nimport '../css/system-event-info.css';\n\n// Import panel CSS\nimport '../css/panel/trade.css';\nimport '../css/panel/refuel.css';\nimport '../css/panel/repair.css';\nimport '../css/panel/upgrades.css';\nimport '../css/panel/info-broker.css';\nimport '../css/panel/cargo-manifest.css';\nimport '../css/panel/ship-status.css';\nimport '../css/panel/dev-admin.css';\n\n/**\n * Initialize GameStateManager with either saved game or new game.\n *\n * React Migration Spec: Requirements 32.1, 32.2, 32.3, 32.4, 32.5\n *\n * @returns {GameStateManager} Initialized game state manager\n * @throws {Error} If initialization fails\n */\nfunction initializeGameStateManager() {\n  // Create navigation system\n  const navigationSystem = new NavigationSystem(STAR_DATA, WORMHOLE_DATA);\n\n  // Create GameStateManager instance\n  const gameStateManager = new GameStateManager(\n    STAR_DATA,\n    WORMHOLE_DATA,\n    navigationSystem\n  );\n\n  // Try to load saved game\n  const savedGame = loadGame(false); // false = not test environment\n\n  if (savedGame) {\n    // Restore from saved game\n    gameStateManager.state = savedGame;\n    console.log('Game loaded from save');\n  } else {\n    // Initialize new game\n    gameStateManager.initNewGame();\n    console.log('New game initialized');\n  }\n\n  return gameStateManager;\n}\n\n/**\n * Render error UI when initialization fails.\n *\n * React Migration Spec: Requirements 23.5, 32.5, 36.4\n *\n * @param {Error} error - The error that occurred\n */\nfunction renderErrorUI(error) {\n  console.error('Failed to initialize game:', error);\n\n  ReactDOM.createRoot(document.getElementById('root')).render(\n    <div\n      style={{\n        padding: '40px',\n        fontFamily: 'sans-serif',\n        maxWidth: '600px',\n        margin: '0 auto',\n      }}\n    >\n      <h1>Failed to Load Game</h1>\n      <p>\n        The game failed to initialize. This could be due to corrupted save data\n        or a browser compatibility issue.\n      </p>\n      <p style={{ color: '#c00', fontFamily: 'monospace', fontSize: '14px' }}>\n        {error.message}\n      </p>\n      <button\n        onClick={() => {\n          if (\n            confirm(\n              'This will delete your saved game and start fresh. Continue?'\n            )\n          ) {\n            localStorage.clear();\n            window.location.reload();\n          }\n        }}\n        style={{\n          padding: '10px 20px',\n          fontSize: '16px',\n          cursor: 'pointer',\n          marginRight: '10px',\n        }}\n      >\n        Clear Save and Restart\n      </button>\n      <button\n        onClick={() => window.location.reload()}\n        style={{ padding: '10px 20px', fontSize: '16px', cursor: 'pointer' }}\n      >\n        Retry\n      </button>\n    </div>\n  );\n}\n\n// Initialize GameStateManager\nlet gameStateManager;\ntry {\n  gameStateManager = initializeGameStateManager();\n} catch (error) {\n  renderErrorUI(error);\n  throw error; // Re-throw to prevent further execution\n}\n\n// Render application\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <GameProvider gameStateManager={gameStateManager}>\n      <App />\n    </GameProvider>\n  </React.StrictMode>\n);\n"],"names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","ErrorBoundary","React","props","__publicField","error","errorInfo","jsxs","jsx","VIEW_MODES","App","viewMode","setViewMode","useState","activePanel","setActivePanel","handleDock","handleUndock","handleOpenPanel","panelName","handleClosePanel","GameContext","createContext","GameProvider","gameStateManager","children","SOL_SYSTEM_ID","ALPHA_CENTAURI_SYSTEM_ID","COMMODITY_TYPES","BASE_PRICES","INTELLIGENCE_CONFIG","FUEL_PRICING_CONFIG","NAVIGATION_CONFIG","calculateDistanceFromSol","system","SHIP_CONFIG","ECONOMY_CONFIG","REPAIR_CONFIG","NEW_GAME_DEFAULTS","GAME_VERSION","SAVE_KEY","SAVE_DEBOUNCE_MS","TradingSystem","goodType","currentDay","activeEvents","marketConditions","basePrice","techLevel","techMod","temporalMod","localMod","eventMod","price","systemId","activeEvent","event","distance","clampedDistance","bias","phase","modifier","_a","cargo","total","stack","cargoEntry","totalCapacityUsed","totalValue","credits","cargoSpace","quantity","stackIndex","systemName","day","existingStackIndex","updatedCargo","newStack","SeededRandom","seed","str","hash","min","max","range","_EconomicEventsSystem","gameState","starData","_b","eventTypeKey","eventType","newEvent","targetSystems","spectralLetter","id","rng","minDuration","maxDuration","duration","endDay","modifiers","commoditySeed","commodityRng","commodityIndex","EconomicEventsSystem","InformationBroker","priceKnowledge","knowledge","cost","validation","s","currentPrices","manipulationMultiplier","cleanedCount","rumorTargetIndex","marketDisruption","description","rumorCommodityIndex","rumorCommodity","bestSystem","bestPrice","currentSystemId","navigationSystem","hasAdvancedSensors","connectedSystemIds","lastVisit","result","systemEvent","saveGame","state","lastSaveTime","isTestEnvironment","now","stateToSave","saveData","loadGame","loadedState","hasSavedGame","clearSave","validateShipConfigIds","configIds","validConfigs","configType","validatedIds","configId","validateAndRepairCargoStacks","cargoStacks","systemData","compartmentType","cargoStack","normalizeCargoStack","isVersionCompatible","saveVersion","validateStateStructure","migrateFromV1ToV2","currentSystem","migrateFromV2ToV2_1","addStateDefaults","sanitizeShipName","name","GameStateManager","wormholeData","quirkIds","count","assigned","randomId","baseValue","attribute","quirks","modified","quirkId","quirk","solSystem","solGrainPrice","solPrices","shipQuirks","callback","index","data","condition","warnings","newCredits","newDebt","newFuel","maxFuel","newCargo","newSystemId","amount","newDays","oldDays","daysPassed","newName","sanitized","hull","engine","lifeSupport","warning","quantityDelta","recoveryFactor","systemConditions","prices","days","systemIdStr","newPrices","newEvents","totalCost","currentSystemName","salePrice","totalRevenue","profitMargin","distanceFromSol","currentFuel","pricePerPercent","systemType","currentCondition","newConditions","upgradeId","upgrade","capabilities","attr","value","cargoArray","sourceStack","qty","existingIndex","good","ship","cargoIndex","hiddenUsed","sum","hiddenAvailable","hiddenIndex","hiddenStack","cargoUsed","cargoAvailable","saveGameToStorage","loadGameFromStorage","_c","checkSavedGame","clearSaveFromStorage","STAR_DATA","WORMHOLE_DATA","NavigationSystem","star","star1","star2","engineCondition","applyQuirkModifiers","upgradeModifier","baseTime","jumpDays","hullUpgradeModifier","lifeSupportUpgradeModifier","hullDegradation","engineDegradation","lifeSupportDegradation","systemId1","systemId2","connection","connected","targetSystemId","currentStar","targetStar","fuelCost","jumpTime","animationSystem","uiManager","degradedShip","stationWasVisible","tradeWasVisible","refuelWasVisible","infoBrokerWasVisible","initializeGameStateManager","savedGame","renderErrorUI","ReactDOM"],"mappings":"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B,EACE,iBAAkB,CAChB,IAAK,EACL,IAAK,GACT,EACE,6BAA8B,CAC5B,KAAM,GACN,OAAQ,GACR,aAAc,EAClB,EACE,2BAA4B,CAC1B,UAAW,GACX,wBAAyB,IACzB,kBAAmB,CACvB,EACE,OAAQ,CACN,YAAa,CACX,KAAM,oBACN,YAAa,oDACb,QAAS,CACP,YAAa,IACb,UAAW,GACnB,EACM,OAAQ,mDACd,EACI,aAAc,CACZ,KAAM,eACN,YAAa,2DACb,QAAS,CACP,gBAAiB,IACzB,EACM,OAAQ,qDACd,EACI,kBAAmB,CACjB,KAAM,oBACN,YACE,+DACF,QAAS,CACP,iBAAkB,KAClB,YAAa,GACrB,EACM,OAAQ,gDACd,EACI,iBAAkB,CAChB,KAAM,mBACN,YAAa,sCACb,QAAS,CACP,iBAAkB,EAC1B,EACM,OAAQ,mCACd,EACI,WAAY,CACV,KAAM,aACN,YAAa,+CACb,QAAS,CACP,kBAAmB,GAC3B,EACM,OAAQ,wBACd,EACI,YAAa,CACX,KAAM,cACN,YAAa,uDACb,QAAS,CACP,gBAAiB,GACzB,EACM,OAAQ,6DACd,EACI,YAAa,CACX,KAAM,cACN,YAAa,mDACb,QAAS,CACP,gBAAiB,GACzB,EACM,OAAQ,wDACd,EACI,cAAe,CACb,KAAM,uBACN,YAAa,gDACb,QAAS,CACP,WAAY,IACpB,EACM,OAAQ,4CACd,CACA,EACE,SAAU,CACR,cAAe,CACb,KAAM,qBACN,KAAM,IACN,YAAa,iCACb,QAAS,CACP,aAAc,GACtB,EACM,SAAU,iDAChB,EACI,gBAAiB,CACf,KAAM,0BACN,KAAM,IACN,YAAa,kCACb,QAAS,CACP,gBAAiB,GACjB,cAAe,EACvB,EACM,SAAU,qCAChB,EACI,gBAAiB,CACf,KAAM,yBACN,KAAM,IACN,YAAa,kCACb,QAAS,CACP,gBAAiB,EACzB,EACM,SAAU,sCAChB,EACI,cAAe,CACb,KAAM,sBACN,KAAM,IACN,YAAa,kCACb,QAAS,CACP,cAAe,EACvB,EACM,SAAU,oCAChB,EACI,gBAAiB,CACf,KAAM,oBACN,KAAM,KACN,YAAa,sCA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L,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,EAAG,EAAE,EACN,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,CAAC,EAC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","x_google_ignoreList":[0,1,2]}